(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{6954:function(e,t,i){"use strict";function n(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(i.length?" "+i.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function r(e){return!!e&&!!e[W]}function s(e){return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var i=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return i===Object||"function"==typeof i&&Function.toString.call(i)===$}(e)||Array.isArray(e)||!!e[H]||!!e.constructor[H]||h(e)||p(e))}function o(e,t,i){void 0===i&&(i=!1),0===a(e)?(i?Object.keys:q)(e).forEach((function(n){i&&"symbol"==typeof n||t(n,e[n],e)})):e.forEach((function(i,n){return t(n,i,e)}))}function a(e){var t=e[W];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:h(e)?2:p(e)?3:0}function l(e,t){return 2===a(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){return 2===a(e)?e.get(t):e[t]}function d(e,t,i){var n=a(e);2===n?e.set(t,i):3===n?(e.delete(t),e.add(i)):e[t]=i}function u(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function h(e){return j&&e instanceof Map}function p(e){return V&&e instanceof Set}function f(e){return e.o||e.t}function v(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=J(e);delete t[W];for(var i=q(t),n=0;n<i.length;n++){var r=i[n],s=t[r];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[r]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[r]})}return Object.create(Object.getPrototypeOf(e),t)}function g(e,t){return void 0===t&&(t=!1),y(e)||r(e)||!s(e)||(a(e)>1&&(e.set=e.add=e.clear=e.delete=m),Object.freeze(e),t&&o(e,(function(e,t){return g(t,!0)}),!0)),e}function m(){n(2)}function y(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function T(e){var t=z[e];return t||n(18,e),t}function E(){return F}function S(e,t){t&&(T("Patches"),e.u=[],e.s=[],e.v=t)}function b(e){k(e),e.p.forEach(C),e.p=null}function k(e){e===F&&(F=e.l)}function P(e){return F={p:[],l:F,h:e,m:!0,_:0}}function C(e){var t=e[W];0===t.i||1===t.i?t.j():t.O=!0}function w(e,t){t._=t.p.length;var i=t.p[0],r=void 0!==e&&e!==i;return t.h.g||T("ES5").S(t,e,r),r?(i[W].P&&(b(t),n(4)),s(e)&&(e=R(t,e),t.l||A(t,e)),t.u&&T("Patches").M(i[W],e,t.u,t.s)):e=R(t,i,[]),b(t),t.u&&t.v(t.u,t.s),e!==K?e:void 0}function R(e,t,i){if(y(t))return t;var n=t[W];if(!n)return o(t,(function(r,s){return I(e,n,t,r,s,i)}),!0),t;if(n.A!==e)return t;if(!n.P)return A(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var r=4===n.i||5===n.i?n.o=v(n.k):n.o;o(3===n.i?new Set(r):r,(function(t,s){return I(e,n,r,t,s,i)})),A(e,r,!1),i&&e.u&&T("Patches").R(n,i,e.u,e.s)}return n.o}function I(e,t,i,n,o,a){if(r(o)){var c=R(e,o,a&&t&&3!==t.i&&!l(t.D,n)?a.concat(n):void 0);if(d(i,n,c),!r(c))return;e.m=!1}if(s(o)&&!y(o)){if(!e.h.F&&e._<1)return;R(e,o),t&&t.A.l||A(e,o)}}function A(e,t,i){void 0===i&&(i=!1),e.h.F&&e.m&&g(t,i)}function _(e,t){var i=e[W];return(i?f(i):e)[t]}function D(e,t){if(t in e)for(var i=Object.getPrototypeOf(e);i;){var n=Object.getOwnPropertyDescriptor(i,t);if(n)return n;i=Object.getPrototypeOf(i)}}function O(e){e.P||(e.P=!0,e.l&&O(e.l))}function M(e){e.o||(e.o=v(e.t))}function N(e,t,i){var n=h(t)?T("MapSet").N(t,i):p(t)?T("MapSet").T(t,i):e.g?function(e,t){var i=Array.isArray(e),n={i:i?1:0,A:t?t.A:E(),P:!1,I:!1,D:{},l:t,t:e,k:null,o:null,j:null,C:!1},r=n,s=Y;i&&(r=[n],s=Q);var o=Proxy.revocable(r,s),a=o.revoke,l=o.proxy;return n.k=l,n.j=a,l}(t,i):T("ES5").J(t,i);return(i?i.A:E()).p.push(n),n}function L(e){return r(e)||n(22,e),function e(t){if(!s(t))return t;var i,n=t[W],r=a(t);if(n){if(!n.P&&(n.i<4||!T("ES5").K(n)))return n.t;n.I=!0,i=x(t,r),n.I=!1}else i=x(t,r);return o(i,(function(t,r){n&&c(n.t,t)===r||d(i,t,e(r))})),3===r?new Set(i):i}(e)}function x(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return v(e)}i.d(t,{pE:function(){return yi},wk:function(){return le},LJ:function(){return Je},vX:function(){return rt},SF:function(){return ht},xf:function(){return ei},ln:function(){return ze},uX:function(){return st},VP:function(){return lt},m$:function(){return at},um:function(){return ot},xn:function(){return Kt},YC:function(){return Ht},ud:function(){return dt},Nz:function(){return qe},UP:function(){return Xe},Gb:function(){return gt},Nm:function(){return Lt},pk:function(){return ct},BK:function(){return Ye},E4:function(){return Xt},lj:function(){return Zt},Pz:function(){return pt},K6:function(){return Vt},f0:function(){return Gt},M:function(){return xt},zK:function(){return $e}});var U,F,G="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),j="undefined"!=typeof Map,V="undefined"!=typeof Set,B="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,K=G?Symbol.for("immer-nothing"):((U={})["immer-nothing"]=!0,U),H=G?Symbol.for("immer-draftable"):"__$immer_draftable",W=G?Symbol.for("immer-state"):"__$immer_state",$=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),q="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,J=Object.getOwnPropertyDescriptors||function(e){var t={};return q(e).forEach((function(i){t[i]=Object.getOwnPropertyDescriptor(e,i)})),t},z={},Y={get:function(e,t){if(t===W)return e;var i=f(e);if(!l(i,t))return function(e,t,i){var n,r=D(t,i);return r?"value"in r?r.value:null===(n=r.get)||void 0===n?void 0:n.call(e.k):void 0}(e,i,t);var n=i[t];return e.I||!s(n)?n:n===_(e.t,t)?(M(e),e.o[t]=N(e.A.h,n,e)):n},has:function(e,t){return t in f(e)},ownKeys:function(e){return Reflect.ownKeys(f(e))},set:function(e,t,i){var n=D(f(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,i),!0;if(!e.P){var r=_(f(e),t),s=null==r?void 0:r[W];if(s&&s.t===i)return e.o[t]=i,e.D[t]=!1,!0;if(u(i,r)&&(void 0!==i||l(e.t,t)))return!0;M(e),O(e)}return e.o[t]===i&&"number"!=typeof i&&(void 0!==i||t in e.o)||(e.o[t]=i,e.D[t]=!0,!0)},deleteProperty:function(e,t){return void 0!==_(e.t,t)||t in e.t?(e.D[t]=!1,M(e),O(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var i=f(e),n=Reflect.getOwnPropertyDescriptor(i,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:i[t]}:n},defineProperty:function(){n(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){n(12)}},Q={};o(Y,(function(e,t){Q[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Q.deleteProperty=function(e,t){return Y.deleteProperty.call(this,e[0],t)},Q.set=function(e,t,i){return Y.set.call(this,e[0],t,i,e[0])};var X=new(function(){function e(e){var t=this;this.g=B,this.F=!0,this.produce=function(e,i,r){if("function"==typeof e&&"function"!=typeof i){var o=i;i=e;var a=t;return function(e){var t=this;void 0===e&&(e=o);for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return a.produce(e,(function(e){var n;return(n=i).call.apply(n,[t,e].concat(r))}))}}var l;if("function"!=typeof i&&n(6),void 0!==r&&"function"!=typeof r&&n(7),s(e)){var c=P(t),d=N(t,e,void 0),u=!0;try{l=i(d),u=!1}finally{u?b(c):k(c)}return"undefined"!=typeof Promise&&l instanceof Promise?l.then((function(e){return S(c,r),w(e,c)}),(function(e){throw b(c),e})):(S(c,r),w(l,c))}if(!e||"object"!=typeof e){if((l=i(e))===K)return;return void 0===l&&(l=e),t.F&&g(l,!0),l}n(21,e)},this.produceWithPatches=function(e,i){return"function"==typeof e?function(i){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return t.produceWithPatches(i,(function(t){return e.apply(void 0,[t].concat(r))}))}:[t.produce(e,i,(function(e,t){n=e,r=t})),n,r];var n,r},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){s(e)||n(8),r(e)&&(e=L(e));var t=P(this),i=N(this,e,void 0);return i[W].C=!0,k(t),i},t.finishDraft=function(e,t){var i=(e&&e[W]).A;return S(i,t),w(void 0,i)},t.setAutoFreeze=function(e){this.F=e},t.setUseProxies=function(e){e&&!B&&n(20),this.g=e},t.applyPatches=function(e,t){var i;for(i=t.length-1;i>=0;i--){var n=t[i];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}i>-1&&(t=t.slice(i+1));var s=T("Patches").$;return r(e)?s(e,t):this.produce(e,(function(e){return s(e,t)}))},e}()),Z=X.produce,ee=(X.produceWithPatches.bind(X),X.setAutoFreeze.bind(X),X.setUseProxies.bind(X),X.applyPatches.bind(X),X.createDraft.bind(X),X.finishDraft.bind(X),Z);var te=function(e){let t;const i=new Set,n=(e,n)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=n?r:Object.assign({},t,r),i.forEach((i=>i(t,e)))}},r=()=>t,s={setState:n,getState:r,subscribe:(e,n,s)=>n||s?((e,n=r,s=Object.is)=>{let o=n(t);function a(){const i=n(t);if(!s(o,i)){const t=o;e(o=i,t)}}return i.add(a),()=>i.delete(a)})(e,n,s):(i.add(e),()=>i.delete(e)),destroy:()=>i.clear()};return t=e(n,r,s),s};var ie=function(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let n=0;n<i.length;n++)if(!Object.prototype.hasOwnProperty.call(t,i[n])||!Object.is(e[i[n]],t[i[n]]))return!1;return!0},ne=i(828);function re(e,t){return e===t}function se(e,t,i){if(null===t||null===i||t.length!==i.length)return!1;for(var n=t.length,r=0;r<n;r++)if(!e(t[r],i[r]))return!1;return!0}function oe(e){var t=Array.isArray(e[0])?e[0]:e;if(!t.every((function(e){return"function"===typeof e}))){var i=t.map((function(e){return typeof e})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+i+"]")}return t}var ae=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var s=0,o=n.pop(),a=oe(n),l=e.apply(void 0,[function(){return s++,o.apply(null,arguments)}].concat(i)),c=e((function(){for(var e=[],t=a.length,i=0;i<t;i++)e.push(a[i].apply(null,arguments));return l.apply(null,e)}));return c.resultFunc=o,c.dependencies=a,c.recomputations=function(){return s},c.resetRecomputations=function(){return s=0},c}}((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re,i=null,n=null;return function(){return se(t,i,arguments)||(n=e.apply(null,arguments)),i=arguments,n}}));var le,ce=i(6387),de=Object.defineProperty,ue=Object.defineProperties,he=Object.getOwnPropertyDescriptors,pe=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable,ge=(e,t,i)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,me=(e,t)=>{for(var i in t||(t={}))fe.call(t,i)&&ge(e,i,t[i]);if(pe)for(var i of pe(t))ve.call(t,i)&&ge(e,i,t[i]);return e},ye=(e,t)=>ue(e,he(t)),Te=(e,t,i)=>new Promise(((n,r)=>{var s=e=>{try{a(i.next(e))}catch(d){r(d)}},o=e=>{try{a(i.throw(e))}catch(d){r(d)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,o);a((i=i.apply(e,t)).next())}));!function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"}(le||(le={}));var Ee,Se,be,ke,Pe=()=>({room:{id:"",isConnected:!1,name:"",peers:[],shareableLink:"",localPeer:"",hasWaitingRoom:!1,roomState:le.Disconnected,recording:{browser:{running:!1},server:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}),Ce=()=>({peerStats:{},trackStats:{},localPeer:{id:""}});!function(e){e.CHAT="chat"}(Ee||(Ee={})),function(e){e.INFO="info",e.ERROR="error",e.CRITICAL="critical"}(Se||(Se={})),function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.ROLE_CHANGE_REQUEST="ROLE_CHANGE_REQUEST",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"}(be||(be={})),function(e){e.audio="audio",e.video="video"}(ke||(ke={}));var we=(e,t)=>{let i=Oe(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];Ie(i,r)?Object.assign(i,r):Ae(i,r)?delete e[n]:_e(i,r)&&(e[n]=r)}},Re=(e,t)=>{e.plugins&&De(e.plugins,t.plugins)&&(t.plugins=e.plugins),e.layerDefinitions&&De(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},Ie=(e,t)=>e&&t,Ae=(e,t)=>e&&!t,_e=(e,t)=>!e&&t,De=(e,t)=>{if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Oe=(e,t)=>{let i=new Set;for(let n of e)i.add(n);for(let n of t)i.add(n);return Array.from(i)},Me=class{static convertPeer(e){var t,i,n;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(i=e.videoTrack)?void 0:i.trackId,audioTrack:null==(n=e.audioTrack)?void 0:n.trackId,auxiliaryTracks:e.auxiliaryTracks.map((e=>e.trackId)),customerUserId:e.customerUserId,customerDescription:e.metadata,metadata:e.metadata}}static convertTrack(e,t){let i={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(i,e),i}static enrichTrack(e,t){let i=t.getMediaTrackSettings();"screen"===e.source&&"video"===e.type&&(e.displaySurface=i.displaySurface),e.height=i.height,e.width=i.width,t instanceof ne.OL&&(e.volume=t.getVolume()||0),Me.updateDeviceID(e,t),Me.enrichVideoTrack(e,t),Me.enrichPluginsDetails(e,t)}static updateDeviceID(e,t){var i;t instanceof ne.QX||t instanceof ne.Nl?e.deviceID=t.settings.deviceId:e.deviceID=null==(i=t.getMediaTrackSettings())?void 0:i.deviceId}static enrichVideoTrack(e,t){t instanceof ne.CE&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,De(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}static enrichPluginsDetails(e,t){(t instanceof ne.QX||t instanceof ne.Nl)&&(De(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}static convertRoom(e){var t,i;let{recording:n,rtmp:r,hls:s}=Me.convertRecordingStreamingState(null==e?void 0:e.recording,null==e?void 0:e.rtmp,null==e?void 0:e.hls);return{id:e.id,name:e.name,localPeer:null!=(i=null==(t=e.localPeer)?void 0:t.peerId)?i:"",hasWaitingRoom:e.hasWaitingRoom,shareableLink:e.shareableLink,recording:n,rtmp:r,hls:s,sessionId:e.sessionId,startedAt:e.startedAt,peerCount:e.peerCount}}static convertMessage(e){var t,i,n;return{sender:e.sender.peerId,senderName:e.sender.name,senderRole:null==(t=e.sender.role)?void 0:t.name,senderUserId:e.sender.customerUserId,recipientPeer:null==(i=e.recipientPeer)?void 0:i.peerId,recipientRoles:null==(n=e.recipientRoles)?void 0:n.map((e=>e.name)),time:e.time,type:e.type,message:e.message}}static convertRoles(e){let t={};return e&&e.forEach((e=>{t[e.name]=e})),t}static convertRoleChangeRequest(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}static convertException(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}static convertDeviceChangeUpdate(e){let t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}static convertPlaylist(e){return{audio:this.getConvertedPlaylistType(e,ke.audio),video:this.getConvertedPlaylistType(e,ke.video)}}static convertPlaylistItem(e,t){let i=t.type,n=e.getCurrentSelection(i),r=e.isPlaying(i),s=t.url===(null==n?void 0:n.url);return ye(me({},t),{type:t.type,selected:s,playing:s&&r})}static getConvertedPlaylistType(e,t){let i={},n=e.getCurrentSelection(t),r=e.getCurrentProgress(t),s=e.getVolume(t),o=e.getList(t),a=e.getCurrentIndex(t);return e.getList(t).forEach((t=>{i[t.id]=Me.convertPlaylistItem(e,t)})),{list:i,selection:{id:null==n?void 0:n.id,hasPrevious:a>0,hasNext:a<o.length-1},progress:r,volume:s,currentTime:e.getCurrentTime(t),playbackRate:e.getPlaybackRate(t)}}static convertRecordingStreamingState(e,t,i){var n,r,s,o,a,l,c;return{recording:{browser:{running:!!(null==(n=null==e?void 0:e.browser)?void 0:n.running),startedAt:null==(r=null==e?void 0:e.browser)?void 0:r.startedAt,error:null==(s=null==e?void 0:e.browser)?void 0:s.error},server:{running:!!(null==(o=null==e?void 0:e.server)?void 0:o.running),startedAt:null==(a=null==e?void 0:e.server)?void 0:a.startedAt,error:null==(l=null==e?void 0:e.server)?void 0:l.error}},rtmp:{running:!!(null==t?void 0:t.running),startedAt:null==t?void 0:t.startedAt,error:null==t?void 0:t.error},hls:{variants:(null==(c=null==i?void 0:i.variants)?void 0:c.map((e=>e)))||[],running:!!(null==i?void 0:i.running),error:null==i?void 0:i.error}}}};function Ne(e,t,i=Ue){let n,r;if(t)for(let s of t.auxiliaryTracks){let t=e[s];i(t)&&(r=Le(t)?t:r,n=xe(t)?t:n)}return{video:n,audio:r}}function Le(e){return e&&"audio"===e.type}function xe(e){return e&&"video"===e.type}function Ue(e){return e&&"screen"===e.source}function Fe(e){return e&&"audioplaylist"===e.source}function Ge(e){return e&&"videoplaylist"===e.source}function je(e){return Boolean(null==e?void 0:e.degraded)}function Ve(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}var Be=e=>e.room,Ke=e=>e.peers,He=e=>e.messages.byID,We=e=>e.messages.allIDs,$e=e=>e.tracks,qe=e=>e.settings,Je=e=>e.devices,ze=ae([Be],(e=>e&&e.isConnected)),Ye=(ae(Be,(e=>e.peers.length)),ae([Be,Ke],((e,t)=>e.peers.map((e=>t[e]))))),Qe=ae($e,(e=>Object.values(e))),Xe=ae(Be,Ke,((e,t)=>t[e.localPeer])),Ze=ae(Be,(e=>e.localPeer)),et=ae(Xe,(e=>null==e?void 0:e.audioTrack)),tt=ae(Xe,(e=>null==e?void 0:e.videoTrack)),it=ae(Xe,(e=>null==e?void 0:e.auxiliaryTracks)),nt=ae([et,tt,it],((e,t,i)=>{let n=[...i];return e&&n.unshift(e),t&&n.unshift(t),n})),rt=(ae(Ye,(e=>e.filter((e=>!e.isLocal)))),ae(Ke,(e=>e.speakers),((e,t)=>{let i=Object.entries(t).sort(((e,t)=>{var i,n;let r=(null==(i=e[1])?void 0:i.audioLevel)||0;return((null==(n=t[1])?void 0:n.audioLevel)||0)>r?1:-1}));if(i.length>0&&i[0][1].audioLevel&&i[0][1].audioLevel>0){let t=i[0][1].peerID;if(t in e)return e[t]}return null}))),st=e=>{let t=Xe(e);return Ve(e,null==t?void 0:t.audioTrack)},ot=e=>{let t=Xe(e);return Ve(e,null==t?void 0:t.videoTrack)},at=e=>{let t=Xe(e);return function(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}(e,null==t?void 0:t.videoTrack)},lt=ae(Xe,$e,((e,t)=>{let{video:i,audio:n}=Ne(t,e);return!(!i&&!n)})),ct=ae(Ke,$e,((e,t)=>{let i;for(let n in e){let r=e[n],{video:s,audio:o}=Ne(t,r);if(s)return r;o&&!i&&(i=r)}return i})),dt=ae(ct,(e=>!!e)),ut=(ae(Ke,$e,((e,t)=>{for(let i in e){let n=e[i],{audio:r,video:s}=Ne(t,n);if(!s&&r)return n}})),ae(Ke,$e,((e,t)=>{let i=[],n=[];for(let r in e){let s=e[r],{video:o,audio:a}=Ne(t,s);o?i.push(s):a&&n.push(s)}return i.concat(n)})),ae(Ke,$e,((e,t)=>{for(let i in t){let n=t[i];if(Ge(n)&&xe(n)&&n.peerId)return e[n.peerId]}})),ae(Ke,$e,((e,t)=>{for(let i in t){let n=t[i];if(Fe(n)&&n.peerId)return e[n.peerId]}})),ae(Qe,(e=>e.filter(je))),ae(We,(e=>e.length))),ht=(ae(He,(e=>Object.values(e).filter((e=>!e.read)).length)),ae(We,He,((e,t)=>{let i=[];return e.forEach((e=>{i.push(t[e])})),i}))),pt=ae([Be],(e=>e&&e.roomState)),ft=(ae(pt,(e=>e===le.Preview)),ae(Be,(e=>e.roomState!==le.Disconnected))),vt=e=>e.roles,gt=(ae([vt],(e=>Object.keys(e))),ae([Xe,vt],((e,t)=>(null==e?void 0:e.roleName)?t[e.roleName]:null))),mt=(ae([gt],(e=>{var t;return!!(null==(t=null==e?void 0:e.subscribeParams)?void 0:t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0})),ae(gt,(e=>null==e?void 0:e.permissions))),yt=(ae(Be,(e=>e.recording)),ae(Be,(e=>e.rtmp)),ae(Be,(e=>e.hls)),ae(Be,(e=>e.sessionId)),ae(Be,(e=>e.startedAt)),(e=ke.audio)=>t=>t.playlist[e].list),Tt=(e=ke.audio)=>t=>t.playlist[e].selection,Et=(e=ke.audio)=>t=>t.playlist[e].progress,St=(e=ke.audio)=>t=>t.playlist[e].currentTime,bt=(e=ke.audio)=>t=>t.playlist[e].playbackRate,kt=(e=ke.audio)=>t=>t.playlist[e].volume,Pt=(e=ke.audio)=>ae(yt(e),(e=>Object.values(e))),Ct=(e=ke.audio)=>ae(yt(e),Tt(e),((e,t)=>{if(t.id)return e[t.id]})),wt={selection:Tt(ke.audio),progress:Et(ke.audio),currentTime:St(ke.audio),playbackRate:bt(ke.audio),volume:kt(ke.audio),list:Pt(ke.audio),selectedItem:Ct(ke.audio)},Rt={selection:Tt(ke.video),progress:Et(ke.video),currentTime:St(ke.video),playbackRate:bt(ke.video),volume:kt(ke.video),list:Pt(ke.video),selectedItem:Ct(ke.video)};function It(e){return t=>i=>e(i,t)}var At="HMS-Store:",_t=class{static v(e,...t){this.log(ne.QH.VERBOSE,e,...t)}static d(...e){this.log(ne.QH.DEBUG,...e)}static i(...e){this.log(ne.QH.INFO,...e)}static w(...e){this.log(ne.QH.WARN,...e)}static e(...e){this.log(ne.QH.ERROR,...e)}static time(e){this.log(ne.QH.TIME,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(ne.QH.TIMEEND,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,...t){if(!(this.level.valueOf()>e.valueOf()))switch(e){case ne.QH.VERBOSE:console.log(At,...t);break;case ne.QH.DEBUG:console.debug(At,...t);break;case ne.QH.INFO:console.info(At,...t);break;case ne.QH.WARN:console.warn(At,...t);break;case ne.QH.ERROR:console.error(At,...t);break;case ne.QH.TIME:performance.mark(t[1]);break;case ne.QH.TIMEEND:{let e=t[0],i=t[1];try{let t=performance.measure(i,i);this.log(ne.QH.DEBUG,e,i,null==t?void 0:t.duration),performance.clearMarks(i),performance.clearMeasures(i)}catch(o){this.log(ne.QH.DEBUG,e,i,o)}break}}}};_t.level=ne.QH.VERBOSE;var Dt=(e,t)=>t,Ot=(e,t)=>t,Mt=ae([Ke,Dt],((e,t)=>t?e[t]:null)),Nt=ae([$e,(e,t)=>t],((e,t)=>t?e[t]:null)),Lt=It(Mt),xt=(It(ae(Mt,(e=>null==e?void 0:e.name))),It(Nt)),Ut=(It(((e,t)=>{let i=Mt(e,t);if(i&&i.videoTrack&&""!==i.videoTrack)return e.tracks[i.videoTrack]})),It(((e,t)=>{let i=Mt(e,t);if(i&&i.audioTrack&&""!==i.audioTrack)return e.tracks[i.audioTrack]}))),Ft=(It(((e,t)=>{let i=Mt(e,t);return(null==i?void 0:i.auxiliaryTracks.map((t=>e.tracks[t])))||[]})),(e,t)=>t?e.speakers[t]:null),Gt=It(ae(Ft,(e=>(null==e?void 0:e.audioLevel)||0))),jt=(It(ae(((e,t)=>{let i=Ut(t)(e);return Ft(e,null==i?void 0:i.id)}),(e=>(null==e?void 0:e.audioLevel)||0))),It(((e,t)=>{let i=Mt(e,t);if(i){let t=null==i?void 0:i.auxiliaryTracks.find((t=>Le(e.tracks[t])));return t?e.tracks[t]:void 0}})),It(ae($e,Mt,((e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find((t=>{let i=e[t];return Ge(i)&&xe(i)}));return i?e[i]:void 0}))),It(ae($e,Mt,((e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find((t=>{let i=e[t];return Ge(i)&&Le(i)}));return i?e[i]:void 0}))),It(ae($e,Mt,((e,t)=>{let i=null==t?void 0:t.auxiliaryTracks.find((t=>{let i=e[t];return Fe(i)&&Le(i)}));return i?e[i]:void 0}))),It(ae($e,Mt,((e,t)=>Ne(e,t))))),Vt=e=>ae(jt(e),(e=>e.video)),Bt=e=>ae(jt(e),(e=>e.audio)),Kt=It(((e,t)=>{let i=Mt(e,t);return Ve(e,null==i?void 0:i.audioTrack)})),Ht=It(((e,t)=>{let i=Mt(e,t);return Ve(e,null==i?void 0:i.videoTrack)})),Wt=It(((e,t)=>{if(t&&e.tracks[t])return 0===e.tracks[t].volume})),$t=(It(((e,t)=>{let i=Mt(e,t);return Wt(null==i?void 0:i.audioTrack)(e)})),It(((e,t)=>{let i=Bt(t)(e);return Wt(null==i?void 0:i.id)(e)})),It(((e,t)=>{let i=Nt(e,t);if(i)return"audio"!==i.type?void _t.w("Please pass audio track here"):i.volume}))),qt=(It(((e,t)=>{let i=Mt(e,t);return $t(null==i?void 0:i.audioTrack)(e)})),It(((e,t)=>{let i=Bt(t)(e);return $t(null==i?void 0:i.id)(e)})),It(((e,t)=>{let i=Nt(e,t);if(i)return"video"!==i.type?void _t.w("Please pass video track here"):i.layer})),ae([ht,Ze,Dt],((e,t,i)=>{if(i)return e.filter((e=>{var n;return!(!e.recipientPeer&&!(null==(n=e.recipientRoles)?void 0:n.length)||![t,i].includes(e.sender))&&[t,i].includes(e.recipientPeer)}))}))),Jt=ae([ht,Ot],((e,t)=>{if(t)return e.filter((e=>{var i,n;return!!(null==(i=e.recipientRoles)?void 0:i.length)&&(null==(n=e.recipientRoles)?void 0:n.includes(t))}))})),zt=ae(ht,(e=>e.filter((e=>{var t;return!e.recipientPeer&&!(null==(t=e.recipientRoles)?void 0:t.length)})))),Yt=ae([Jt,Ot],(e=>e?e.filter((e=>!e.read)).length:0)),Qt=ae([qt,Dt],(e=>e?e.filter((e=>!e.read)).length:0)),Xt=(ae(zt,(e=>e.filter((e=>!e.read)).length)),It(qt),It(Jt),It(Yt),It(Qt),e=>ae([Ye],(t=>t.filter((t=>t.roleName===e))))),Zt=(ae([Ke,$e],((e,t)=>Object.values(e).map((e=>{var i;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(i=t[e.audioTrack])?void 0:i.enabled)}})))),ae([e=>e.roleChangeRequests[0]||null,Ke,vt],((e,t,i)=>e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:i[e.roleName],token:e.token}:null))),ei=ae([gt],(e=>{var t;let i=!1,n=!1,r=!1;return(null==(t=null==e?void 0:e.publishParams)?void 0:t.allowed)&&(i=e.publishParams.allowed.includes("video"),n=e.publishParams.allowed.includes("audio"),r=e.publishParams.allowed.includes("screen")),{video:i,audio:n,screen:r}}));ae([tt,$e],((e,t)=>{let i=null;return e&&(i=t[e]),(null==i?void 0:i.plugins)||[]})),ae([et,$e],((e,t)=>{let i=null;return e&&(i=t[e]),(null==i?void 0:i.plugins)||[]}));var ti=class{constructor(e,t,i,n){this.playlistManager=e,this.syncPlaylistState=i,this.store=n,this.type=t}play(e){return Te(this,null,(function*(){e?yield this.playlistManager.setEnabled(!0,{id:e,type:this.type}):_t.w("Please pass id to play")}))}pause(){return Te(this,null,(function*(){let e=this.type===ke.audio?wt:Rt,t=this.store.getState(e.selection);t.id?yield this.playlistManager.setEnabled(!1,{id:t.id,type:this.type}):_t.w("No item is currently playing to pause")}))}playNext(){return Te(this,null,(function*(){yield this.playlistManager.playNext(this.type)}))}playPrevious(){return Te(this,null,(function*(){yield this.playlistManager.playPrevious(this.type)}))}seek(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState(`seekOn${this.type}Playlist`)}seekTo(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState(`seekToOn${this.type}Playlist`)}setVolume(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState(`setVolumeOn${this.type}Playlist`)}setList(e){this.playlistManager.setList(e),this.syncPlaylistState(`setListOn${this.type}Playlist`)}stop(){return Te(this,null,(function*(){yield this.playlistManager.stop(this.type),this.syncPlaylistState(`stop${this.type}Playlist`)}))}setIsAutoplayOn(e){this.playlistManager.setIsAutoplayOn(this.type,e)}setPlaybackRate(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState(`set${this.type}PlaybackRate`)}},ii={[ne.iS.PEER_JOINED]:be.PEER_JOINED,[ne.iS.PEER_LEFT]:be.PEER_LEFT,[ne.iS.ROLE_UPDATED]:be.ROLE_UPDATED,[ne.iS.AUDIO_TOGGLED]:"PEER_AUDIO_UPDATED",[ne.iS.VIDEO_TOGGLED]:"PEER_VIDEO_UPDATED",[ne.iS.NAME_UPDATED]:be.NAME_UPDATED,[ne.iS.METADATA_UPDATED]:be.METADATA_UPDATED},ni={[ne.HK.TRACK_ADDED]:be.TRACK_ADDED,[ne.HK.TRACK_REMOVED]:be.TRACK_REMOVED,[ne.HK.TRACK_MUTED]:be.TRACK_MUTED,[ne.HK.TRACK_UNMUTED]:be.TRACK_UNMUTED,[ne.HK.TRACK_DEGRADED]:be.TRACK_DEGRADED,[ne.HK.TRACK_RESTORED]:be.TRACK_RESTORED},ri={[ne.iS.PEER_JOINED]:"peerJoined",[ne.iS.PEER_LEFT]:"peerLeft",[ne.iS.NAME_UPDATED]:"peerNameUpdated",[ne.iS.METADATA_UPDATED]:"peerMetadataUpdated"},si="hmsNotification",oi=e=>ne.jU?`${e} ${document.title}`:e,ai=(e,t,i)=>{var n;let r=li(i,t),s=null==(n=e.getWebrtcInternals())?void 0:n.onStatsChange((e=>ci(t,e,i)));return()=>{r(),s&&s()}},li=(e,t)=>{let i,n,r;return e.getState(Ze)?t.namedSetState((t=>{t.localPeer.id=e.getState(Ze)}),"localpeer-id"):i=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.id=e}),"localpeer-id")}),Ze),e.getState(tt)?t.namedSetState((t=>{t.localPeer.videoTrack=e.getState(tt)}),"localpeer-videotrack-id"):n=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.videoTrack=e}),"localpeer-videotrack-id")}),tt),e.getState(et)?t.namedSetState((t=>{t.localPeer.videoTrack=e.getState(et)}),"localpeer-audiotrack-id"):r=e.subscribe((e=>{e&&t.namedSetState((t=>{t.localPeer.videoTrack=e}),"localpeer-audiotrack-id")}),et),()=>{null==i||i(),null==n||n(),null==r||r()}},ci=(e,t,i)=>{let n=i.getState($e);e.namedSetState((e=>{let r={},s=Object.keys(n);for(let i of s){let e=t.getTrackStats(i);e&&(r[i]=e)}we(e.trackStats,r);let o={[i.getState(Ze)]:t.getLocalPeerStats()};we(e.peerStats,o)}),"webrtc-stats")},di=(e,t="resetState")=>{e.namedSetState((e=>{Object.assign(e,{peerStats:{},trackStats:{},localPeer:{id:""}})}),t)},ui=e=>e.trackStats,hi=e=>e.peerStats,pi=ae([hi,e=>e.localPeer.id],((e,t)=>e[t])),fi=(ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent})),ae(pi,(e=>{var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived})),ae([hi,(e,t)=>t],((e,t)=>t?e[t]:void 0))),vi=ae([ui,(e,t)=>t],((e,t)=>t?e[t]:void 0)),gi=(It(fi),It(vi),It(ae(vi,(e=>null==e?void 0:e.bitrate))),It(ae(vi,(e=>null==e?void 0:e.bytesReceived))),It(ae(vi,(e=>null==e?void 0:e.framesPerSecond))),It(ae(vi,(e=>null==e?void 0:e.jitter))),It(ae(vi,(e=>null==e?void 0:e.packetsLost))),ae([ui,e=>e.localPeer.audioTrack],((e,t)=>t?e[t]:void 0))),mi=ae([ui,e=>e.localPeer.videoTrack],((e,t)=>t?e[t]:void 0)),yi=(ae(gi,(e=>null==e?void 0:e.bitrate)),ae(mi,(e=>null==e?void 0:e.bitrate)),ae(gi,(e=>null==e?void 0:e.bytesSent)),ae(mi,(e=>null==e?void 0:e.bytesSent)),ae(mi,(e=>null==e?void 0:e.framesPerSecond)),ae(mi,(e=>null==e?void 0:e.qualityLimitationReason)),class{constructor(e,t,i){this.getStats=()=>(this.stats||(this.stats=new class{constructor(e,t){this.hmsStore=e,this.sdk=t,this.store=yi.createNewHMSStore(oi("HMSStatsStore"),Ce),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=()=>new Promise((e=>{var t,i;"Connected"===this.hmsStore.getState(pt)?e(null==(i=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:i.getPublishPeerConnection()):this.hmsStore.subscribe((t=>{var i,n;"Connected"===t&&e(null==(n=null==(i=this.sdk)?void 0:i.getWebrtcInternals())?void 0:n.getPublishPeerConnection())}),pt)})),this.getSubscribePeerConnection=()=>new Promise((e=>{var t,i;"Connected"===this.hmsStore.getState(pt)?e(null==(i=null==(t=this.sdk)?void 0:t.getWebrtcInternals())?void 0:i.getSubscribePeerConnection()):this.hmsStore.subscribe((t=>{var i,n;"Connected"===t&&e(null==(n=null==(i=this.sdk)?void 0:i.getWebrtcInternals())?void 0:n.getSubscribePeerConnection())}),pt)})),this.sdk&&((e,t,i)=>{let n;i.getState(pt)===le.Connected&&(n=ai(e,t,i)),i.subscribe((r=>{[le.Connected,le.Reconnecting].includes(r)?n||(n=ai(e,t,i)):n&&(di(t),n())}),pt)})(this.sdk,this.store,this.hmsStore)}}(this.store,this.sdk)),this.stats),this.store=e||yi.createNewHMSStore(oi("HMSStore"),Pe),this.notifications=i||new class{constructor(e){this.id=0,this.onNotification=e=>(this.eventEmitter.addListener(si,e),()=>{this.eventEmitter.removeListener(si,e)}),this.store=e,this.eventEmitter=new ce.EventEmitter2}sendPlaylistTrackEnded(e){let t=this.createNotification(be.PLAYLIST_TRACK_ENDED,e,Se.INFO);this.emitEvent(t)}sendDeviceChange(e){var t;let i=this.createNotification(be.DEVICE_CHANGE_UPDATE,e,e.error?Se.ERROR:Se.INFO,`Selected ${e.type} device - ${null==(t=e.selection)?void 0:t.label}`);this.emitEvent(i)}sendLeaveRoom(e){var t;let i=null==(t=e.requestedBy)?void 0:t.name,n=this.createNotification(e.roomEnded||!i?be.ROOM_ENDED:be.REMOVED_FROM_ROOM,e,Se.INFO,`${e.roomEnded?"Room ended":"Removed from room"} ${i?`by ${i}`:""}`);this.emitEvent(n)}sendPeerList(e){let t=this.createNotification(be.PEER_LIST,e,Se.INFO);this.emitEvent(t)}sendPeerUpdate(e,t){let i=this.store.getState(Lt(null==t?void 0:t.id))||t,n=ii[e];if(n){let e=this.createNotification(n,i,Se.INFO);this.emitEvent(e)}}sendTrackUpdate(e,t){let i=this.store.getState(xt(t)),n=ni[e];if(n){let e=this.createNotification(n,i,Se.INFO);this.emitEvent(e)}}sendMessageReceived(e){let t=this.createNotification(be.NEW_MESSAGE,e,Se.INFO);this.emitEvent(t)}sendError(e){let t=this.createNotification(be.ERROR,e,Se.ERROR);this.emitEvent(t)}sendReconnecting(e){let t=this.createNotification(be.RECONNECTING,e,Se.ERROR);this.emitEvent(t)}sendReconnected(){let e=this.createNotification(be.RECONNECTED,null,Se.INFO);this.emitEvent(e)}sendChangeTrackStateRequest(e){let t=this.createNotification(be.CHANGE_TRACK_STATE_REQUEST,e,Se.INFO);this.emitEvent(t)}sendChangeMultiTrackStateRequest(e){let t=this.createNotification(be.CHANGE_MULTI_TRACK_STATE_REQUEST,e,Se.INFO);this.emitEvent(t)}emitEvent(e){this.eventEmitter.emit(si,e)}createNotification(e,t,i,n=""){return this.id++,{id:this.id,type:e,message:n,data:t,severity:i}}}(this.store),t?this.actions=t:(this.sdk=new ne.pZ,this.actions=new class{constructor(e,t,i){this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.setProgress=({type:e,progress:t})=>{this.setState((i=>{i.playlist[e].progress=t,i.playlist[e].currentTime=this.sdk.getPlaylistManager().getCurrentTime(e)}),"playlistProgress")},this.syncPlaylistState=e=>{this.setState((e=>{Object.assign(e.playlist,Me.convertPlaylist(this.sdk.getPlaylistManager()))}),e)},this.sendPeerUpdateNotification=(e,t)=>{let i=this.store.getState(Lt(t.peerId)),n="peerUpdate";n=ri[e],this.syncRoomState(n),i||(i=this.store.getState(Lt(t.peerId))),this.hmsNotifications.sendPeerUpdate(e,i)},this.setState=(e,t)=>this.store.namedSetState(e,t),this.store=e,this.sdk=t,this.hmsNotifications=i}unblockAudio(){return Te(this,null,(function*(){yield this.sdk.getAudioOutput().unblockAutoplay()}))}setVolume(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}setAudioOutputDevice(e){this.sdk.getAudioOutput().setDevice(e)&&this.setState((t=>{t.settings.audioOutputDeviceId=e}),"setAudioOutputDevice")}setPreferredLayer(e,t){let i=this.hmsSDKTracks[e];i?i instanceof ne.CE?(i.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):_t.w(`track ${e} is not an video track`):this.logPossibleInconsistency(`track ${e} not present, unable to set preffer layer`)}preview(e){return Te(this,null,(function*(){if(this.isRoomJoinCalled)return void this.logPossibleInconsistency("attempting to call preview after join was called");let t=this.store.getState(pt);if(t!==le.Preview&&t!==le.Connecting)try{this.setState((e=>{e.room.roomState=le.Connecting}),"connecting"),yield this.sdkPreviewWithListeners(e)}catch(i){throw _t.e("Cannot show preview. Failed to connect to room - ",i),i}else this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting")}))}join(e){if(this.isRoomJoinCalled)this.logPossibleInconsistency("room join is called again");else try{this.sdkJoinWithListeners(e),this.isRoomJoinCalled=!0,this.setState((e=>{e.room.roomState=le.Connecting}),"join")}catch(t){throw this.isRoomJoinCalled=!1,_t.e("Failed to connect to room - ",t),t}}leave(){return Te(this,null,(function*(){if(!this.store.getState(ft))return void this.logPossibleInconsistency("room leave is called when no room is connected");let e=this.store.getState(pt);return this.setState((e=>{e.room.roomState=le.Disconnecting}),"leaving"),this.sdk.leave().then((()=>{this.resetState("leave"),_t.i("left room")})).catch((t=>{_t.e("error in leaving room - ",t),this.setState((t=>{t.room.roomState=e}),"revertLeave")}))}))}setScreenShareEnabled(e,t){return Te(this,null,(function*(){e?yield this.startScreenShare(t):yield this.stopScreenShare()}))}addTrack(e,t="regular"){return Te(this,null,(function*(){yield this.sdk.addTrack(e,t),this.syncRoomState("addTrack")}))}removeTrack(e){return Te(this,null,(function*(){yield this.sdk.removeTrack(e),this.syncRoomState("removeTrack")}))}setLocalAudioEnabled(e){return Te(this,null,(function*(){let t=this.store.getState(et);t&&(yield this.setEnabledTrack(t,e))}))}setLocalVideoEnabled(e){return Te(this,null,(function*(){let t=this.store.getState(tt);t&&(yield this.setEnabledTrack(t,e))}))}setEnabledTrack(e,t){return Te(this,null,(function*(){var i;if((null==(i=this.store.getState().tracks[e])?void 0:i.enabled)===t)return void this.logPossibleInconsistency(`local track[${e}] enabled state - ${t}`);this.setState((i=>{i.tracks[e]?i.tracks[e].displayEnabled=t:this.logPossibleInconsistency("track id not found for setEnabled")}),"displayEnabled");try{yield this.setEnabledSDKTrack(e,t),this.syncRoomState("setEnabled")}catch(c){throw this.setState((i=>{i.tracks[e].displayEnabled=!t}),"rollbackDisplayEnabled"),this.hmsNotifications.sendError(Me.convertException(c)),c}let n=t?ne.HK.TRACK_UNMUTED:ne.HK.TRACK_MUTED;this.hmsNotifications.sendTrackUpdate(n,e)}))}setAudioSettings(e){return Te(this,null,(function*(){let t=this.store.getState(et);t&&(yield this.setSDKLocalAudioTrackSettings(t,e),this.syncRoomState("setAudioSettings"))}))}setVideoSettings(e){return Te(this,null,(function*(){let t=this.store.getState(tt);t&&(yield this.setSDKLocalVideoTrackSettings(t,e),this.syncRoomState("setVideoSettings"))}))}sendMessage(e){this.sendBroadcastMessage(e)}sendBroadcastMessage(e,t){return Te(this,null,(function*(){let i=yield this.sdk.sendBroadcastMessage(e,t);this.updateMessageInStore(i,{message:e,type:t})}))}sendGroupMessage(e,t,i){return Te(this,null,(function*(){let n=this.store.getState(vt),r=t.map((e=>n[e])),s=yield this.sdk.sendGroupMessage(e,r,i);this.updateMessageInStore(s,{message:e,recipientRoles:t,type:i})}))}sendDirectMessage(e,t,i){return Te(this,null,(function*(){let n=this.hmsSDKPeers[t],r=yield this.sdk.sendDirectMessage(e,n,i);this.updateMessageInStore(r,{message:e,recipientPeer:n.peerId,type:i})}))}updateMessageInStore(e,t){if(!e)throw _t.w("sendMessage","Failed to send message",t),Error(`sendMessage Failed - ${JSON.stringify(t)}`);let i=Me.convertMessage(e);return i.read=!0,i.senderName="You",this.onHMSMessage(i),i}setMessageRead(e,t){this.setState((i=>{t?i.messages.byID[t]?i.messages.byID[t].read=e:this.logPossibleInconsistency("no message with id is found"):i.messages.allIDs.forEach((t=>{i.messages.byID[t].read=e}))}),"setMessageRead")}attachVideo(e,t){return Te(this,null,(function*(){if(this.localAndVideoUnmuting(e))return new Promise((i=>{let n=this.store.subscribe((r=>Te(this,null,(function*(){r&&(yield this.attachVideoInternal(e,t),n(),i())}))),ot)}));yield this.attachVideoInternal(e,t)}))}detachVideo(e,t){return Te(this,null,(function*(){let i=this.hmsSDKTracks[e];i&&"video"===i.type?(yield i.removeSink(t),this.updateVideoLayer(e,"detachVideo")):this.logPossibleInconsistency("no video track found to remove sink")}))}addPluginToVideoTrack(e,t){return Te(this,null,(function*(){return this.addRemoveVideoPlugin(e,"add",t)}))}addPluginToAudioTrack(e){return Te(this,null,(function*(){return this.addRemoveAudioPlugin(e,"add")}))}removePluginFromVideoTrack(e){return Te(this,null,(function*(){return this.addRemoveVideoPlugin(e,"remove")}))}removePluginFromAudioTrack(e){return Te(this,null,(function*(){return this.addRemoveAudioPlugin(e,"remove")}))}changeRole(e,t,i=!1){return Te(this,null,(function*(){let n=this.hmsSDKPeers[e];n?yield this.sdk.changeRole(n,t,i):this.logPossibleInconsistency(`Unknown peer ID given ${e} for changerole`)}))}acceptChangeRole(e){return Te(this,null,(function*(){let t=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0;t||_t.w(`peer for which role change is requested no longer available - ${e.requestedBy}`);let i={requestedBy:t,role:e.role,token:e.token};yield this.sdk.acceptChangeRole(i),this.removeRoleChangeRequest(e)}))}rejectChangeRole(e){this.removeRoleChangeRequest(e)}endRoom(e,t){return Te(this,null,(function*(){let i=this.store.getState(mt);if(!(null==i?void 0:i.endRoom))return void _t.w("You are not allowed to perform this action - endRoom");let n=this.store.getState(pt);this.setState((e=>{e.room.roomState=le.Disconnecting}),"endingRoom");try{yield this.sdk.endRoom(e,t),this.resetState("endRoom")}catch(o){_t.e("error in ending room - ",o),this.setState((e=>{e.room.roomState=n}),"revertEndRoom")}}))}removePeer(e,t){return Te(this,null,(function*(){let i=this.hmsSDKPeers[e];i&&!i.isLocal?yield this.sdk.removePeer(i,t):this.logPossibleInconsistency(`No remote peer found for peerID - ${e}`)}))}startRTMPOrRecording(e){return Te(this,null,(function*(){yield this.sdk.startRTMPOrRecording(e)}))}stopRTMPAndRecording(){return Te(this,null,(function*(){yield this.sdk.stopRTMPAndRecording()}))}startHLSStreaming(e){return Te(this,null,(function*(){yield this.sdk.startHLSStreaming(e)}))}stopHLSStreaming(e){return Te(this,null,(function*(){yield this.sdk.stopHLSStreaming(e)}))}changeName(e){return Te(this,null,(function*(){yield this.sdk.changeName(e)}))}changeMetadata(e){return Te(this,null,(function*(){"string"!=typeof e&&(e=JSON.stringify(e)),yield this.sdk.changeMetadata(e)}))}setRemoteTrackEnabled(e,t){return Te(this,null,(function*(){if("string"==typeof e){let i=this.hmsSDKTracks[e];i&&function(e){return e instanceof ne.OL||e instanceof ne.CE}(i)?yield this.sdk.changeTrackState(i,t):this.logPossibleInconsistency(`No remote track with ID ${e} found for change track state`)}else Array.isArray(e)&&e.forEach((e=>this.setRemoteTrackEnabled(e,t)))}))}setRemoteTracksEnabled(e){return Te(this,null,(function*(){let t={enabled:e.enabled,type:e.type,source:e.source};if(e.roles){let i=this.store.getState(vt);t.roles=e.roles.map((e=>i[e]))}yield this.sdk.changeMultiTrackState(t)}))}setLogLevel(e){_t.level=e,this.sdk.setLogLevel(e)}resetState(e="resetState"){this.setState((e=>{Object.assign(e,Pe())}),e),this.isRoomJoinCalled=!1,this.hmsSDKTracks={},_t.cleanUp()}sdkJoinWithListeners(e){this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})}onRemovedFromRoom(e){var t;let i=this.store.getState(Lt(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(ye(me({},e),{requestedBy:i||void 0})),_t.i("resetting state after peer removed",e),this.resetState(e.roomEnded||!i?"roomEnded":"removedFromRoom")}onDeviceChange(e){let t=e.devices;if(!t)return;let i=this.store.getState(Xe);if(this.setState((e=>{De(e.devices.audioInput,t.audioInput)||(e.devices.audioInput=t.audioInput),De(e.devices.videoInput,t.videoInput)||(e.devices.videoInput=t.videoInput),De(e.devices.audioOutput,t.audioOutput)||(e.devices.audioOutput=t.audioOutput),this.hmsSDKPeers[null==i?void 0:i.id]&&Object.assign(e.settings,this.getMediaSettings(this.hmsSDKPeers[null==i?void 0:i.id]))}),"deviceChange"),e.selection){let t=Me.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(t)}}sdkPreviewWithListeners(e){return Te(this,null,(function*(){yield this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this)}),this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)})}))}startScreenShare(e){return Te(this,null,(function*(){this.store.getState(lt)?this.logPossibleInconsistency("start screenshare is called while it's on"):(yield this.sdk.startScreenShare((()=>this.syncRoomState("screenshareStopped")),e),this.syncRoomState("startScreenShare"))}))}stopScreenShare(){return Te(this,null,(function*(){this.store.getState(lt)?(yield this.sdk.stopScreenShare(),this.syncRoomState("stopScreenShare")):this.logPossibleInconsistency("stop screenshare is called while it's not on")}))}attachVideoInternal(e,t){return Te(this,null,(function*(){let i=this.hmsSDKTracks[e];i&&"video"===i.type?(yield i.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink")}))}syncRoomState(e){_t.time(`store-sync-${e}`);let t={},i=[],n={},r={},s={},o=this.sdk.getPeers();for(let d of o){let e=Me.convertPeer(d);t[e.id]=e,i.push(e.id),this.hmsSDKPeers[e.id]=d;let o=[d.audioTrack,d.videoTrack,...d.auxiliaryTracks];for(let t of o){if(!t)continue;let e=Me.convertTrack(t);n[e.id]=e,r[t.trackId]=t}e.isLocal&&Object.assign(s,this.getMediaSettings(d))}let a=this.sdk.getRecordingState(),l=this.sdk.getRTMPState(),c=this.sdk.getHLSState();this.setState((e=>{e.room.peers=i;let o=e.peers,d=e.tracks;((e,t)=>{let i=Oe(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];Ie(i,r)?(De(i.auxiliaryTracks,r.auxiliaryTracks)&&(r.auxiliaryTracks=i.auxiliaryTracks),Object.assign(i,r)):Ae(i,r)?delete e[n]:_e(i,r)&&(e[n]=r)}})(o,t),((e,t)=>{let i=Oe(Object.keys(e),Object.keys(t));for(let n of i){let i=e[n],r=t[n];Ie(i,r)?(Re(i,r),Object.assign(i,r)):Ae(i,r)?delete e[n]:_e(i,r)&&(e[n]=r)}})(d,n),Object.assign(e.settings,s),this.hmsSDKTracks=r,Object.assign(e.roles,Me.convertRoles(this.sdk.getRoles())),Object.assign(e.playlist,Me.convertPlaylist(this.sdk.getPlaylistManager())),Object.assign(e.room,Me.convertRecordingStreamingState(a,l,c))}),e),_t.timeEnd(`store-sync-${e}`)}onPreview(e){this.setState((t=>{Object.assign(t.room,Me.convertRoom(e)),t.room.roomState=le.Preview}),"previewStart"),this.syncRoomState("previewSync")}onJoin(e){let t=this.sdk.getPlaylistManager();this.audioPlaylist=new ti(t,ke.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new ti(t,ke.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState((t=>{Object.assign(t.room,Me.convertRoom(e)),t.room.isConnected=!0,t.room.roomState=le.Connected}),"joined"),t.onProgress(this.setProgress),t.onNewTrackStart((e=>{this.syncPlaylistState(`${e.type}PlaylistUpdate`)})),t.onPlaylistEnded((e=>{this.syncPlaylistState(`${e}PlaylistEnded`)})),t.onCurrentTrackEnded((e=>{this.hmsNotifications.sendPlaylistTrackEnded(Me.convertPlaylistItem(t,e)),this.syncPlaylistState(`${e.type}PlaylistItemEnded`)}))}onRoomUpdate(e,t){this.setState((e=>{Object.assign(e.room,Me.convertRoom(t))}),"RoomUpdate")}onPeerUpdate(e,t){if(![ne.iS.BECAME_DOMINANT_SPEAKER,ne.iS.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");let e=[];for(let i of t){let t=this.store.getState(Lt(i.peerId));t&&e.push(t)}return void this.hmsNotifications.sendPeerList(e)}this.sendPeerUpdateNotification(e,t)}}onTrackUpdate(e,t,i){if(e===ne.HK.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,i);else{let i=e===ne.HK.TRACK_ADDED?"trackAdded":"trackUpdate";this.syncRoomState(i),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}onMessageReceived(e){let t=Me.convertMessage(e);t.read=!1,this.onHMSMessage(t),this.hmsNotifications.sendMessageReceived(t)}onHMSMessage(e){this.setState((t=>{e.id=String(this.store.getState(ut)+1),t.messages.byID[e.id]=e,t.messages.allIDs.push(e.id)}),"newMessage")}onAudioLevelUpdate(e){this.setState((t=>{let i={};e.forEach((e=>{if(!e.track||!e.peer)return;let n=e.track.trackId;i[n]=e.audioLevel,t.speakers[n]||(t.speakers[n]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:n})}));let n=Object.entries(t.speakers);for(let[e,r]of n)r.audioLevel=i[e]||0,0===r.audioLevel&&delete t.speakers[e]}),"audioLevel")}onChangeTrackStateRequest(e){var t;let i=this.store.getState(Lt(null==(t=e.requestedBy)?void 0:t.peerId)),n=this.getStoreLocalTrackIDfromSDKTrack(e.track),r=this.store.getState(xt(n));if(!r)return this.logPossibleInconsistency(`Not found track for which track state change was requested, ${e.track}`);e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:i||void 0,track:r,enabled:e.enabled})}onChangeMultiTrackStateRequest(e){var t;let i=this.store.getState(Lt(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");let n=[],r=this.store.getState($e);for(let s of e.tracks){let e=this.getStoreLocalTrackIDfromSDKTrack(s);e&&r[e]&&n.push(r[e])}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:i||void 0,tracks:n,enabled:e.enabled,type:e.type,source:e.source})}onReconnected(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState((e=>{e.room.roomState=le.Connected}),"reconnected")}onReconnecting(e){let t=Me.convertException(e);_t.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState((e=>{e.room.roomState=le.Reconnecting,e.errors.push(t)}),"reconnecting")}onError(e){let t=Me.convertException(e);t.isTerminal?(this.leave().then((()=>_t.e("error from SDK, left room."))),this.setState((e=>{e.room.roomState=le.Failed,e.errors.push(t)}),"errorTerminal")):this.store.getState().errors.length<50&&this.setState((e=>{e.errors.push(t)}),"error"),this.hmsNotifications.sendError(t),_t.e("received error from sdk",t)}updateVideoLayer(e,t){let i=this.hmsSDKTracks[e];i&&i instanceof ne.CE&&this.setState((t=>{t.tracks[e].layer=i.getSimulcastLayer()}),t)}handleTrackRemove(e,t){this.setState((i=>{let n=i.peers[t.peerId],r=i.tracks,s=e.trackId;if(this.isSameStoreSDKTrack(s,null==n?void 0:n.audioTrack))null==n||delete n.audioTrack;else if(this.isSameStoreSDKTrack(s,null==n?void 0:n.videoTrack))null==n||delete n.videoTrack;else{let e=null==n?void 0:n.auxiliaryTracks.indexOf(s);e>-1&&this.isSameStoreSDKTrack(s,null==n?void 0:n.auxiliaryTracks[e])&&(null==n||n.auxiliaryTracks.splice(e,1))}delete r[s],delete this.hmsSDKTracks[s]}),"trackRemoved")}setEnabledSDKTrack(e,t){return Te(this,null,(function*(){let i=this.hmsSDKTracks[e];i?yield i.setEnabled(t):this.logPossibleInconsistency(`track ${e} not present, unable to enabled/disable`)}))}setSDKLocalVideoTrackSettings(e,t){return Te(this,null,(function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)}))}setSDKLocalAudioTrackSettings(e,t){return Te(this,null,(function*(){let i=this.hmsSDKTracks[e];i?yield i.setSettings(t):this.logPossibleInconsistency(`local track ${e} not present, unable to set settings`)}))}getMediaSettings(e){var t;let i=this.store.getState(qe),n=e.audioTrack,r=e.videoTrack;return{audioInputDeviceId:(null==n?void 0:n.settings.deviceId)||i.audioInputDeviceId,videoInputDeviceId:(null==r?void 0:r.settings.deviceId)||i.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId}}setTrackVolume(e,t){let i=this.hmsSDKTracks[t];i?i instanceof ne.wp?(i.setVolume(e),this.setState((i=>{let n=i.tracks[t];n&&(n.volume=e)}),"trackVolume")):_t.w(`track ${t} is not an audio track`):this.logPossibleInconsistency(`track ${t} not present, unable to set volume`)}localAndVideoUnmuting(e){if(this.store.getState(Xe).videoTrack!==e)return!1;let t=this.store.getState(at),i=this.store.getState(ot);return t&&!i}logPossibleInconsistency(e){_t.w("possible inconsistency detected - ",e)}addRemoveVideoPlugin(e,t,i){return Te(this,null,(function*(){if(!e)return void _t.w("Invalid plugin received in store");let n=this.store.getState(tt);if(n){let r=this.hmsSDKTracks[n];r?("add"===t?yield r.addPlugin(e,i):"remove"===t&&(yield r.removePlugin(e)),this.syncRoomState(`${t}VideoPlugin`)):this.logPossibleInconsistency(`track ${n} not present, unable to remove plugin`)}}))}addRemoveAudioPlugin(e,t){return Te(this,null,(function*(){if(!e)return void _t.w("Invalid plugin received in store");let i=this.store.getState(et);if(i){let n=this.hmsSDKTracks[i];n?("add"===t?yield n.addPlugin(e):"remove"===t&&(yield n.removePlugin(e)),this.syncRoomState(`${t}AudioPlugin`)):this.logPossibleInconsistency(`track ${i} not present, unable to remove plugin`)}}))}isSameStoreSDKTrack(e,t){var i;return!!t&&(null==(i=this.hmsSDKTracks[t])?void 0:i.trackId)===e}onRoleChangeRequest(e){this.setState((t=>{0===t.roleChangeRequests.length&&t.roleChangeRequests.push(Me.convertRoleChangeRequest(e))}),"roleChangeRequest")}removeRoleChangeRequest(e){this.setState((t=>{let i=t.roleChangeRequests.findIndex((t=>t.token===e.token));-1!==i&&t.roleChangeRequests.splice(i,1)}),"removeRoleChangeRequest")}onRoleUpdate(){this.syncRoomState("roleUpdate")}getStoreLocalTrackIDfromSDKTrack(e){return this.store.getState(nt).find((t=>this.hmsSDKTracks[t].trackId===e.trackId))}}(this.store,this.sdk,this.notifications)),this.initialTriggerOnSubscribe=!1,ne.jU&&(window.__hms=this)}triggerOnSubscribe(){this.initialTriggerOnSubscribe||(yi.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}getStore(){return this.store}getHMSActions(){return this.actions}getActions(){return this.actions}getNotifications(){return{onNotification:this.notifications.onNotification}}static createNewHMSStore(e,t){let i=te((()=>t())),n=i.setState;i.setState=e=>{let t="function"==typeof e?ee(e):e;n(t)};let r=i.getState;i.getState=e=>{if(e){let t=e.name||"byIDSelector";window.selectorsCount||(window.selectorsCount={}),window.selectorsCount[t]=(window.selectorsCount[t]||0)+1;let i=performance.now(),n=e(r()),s=performance.now()-i;return s>1&&(window.expensiveSelectors=window.expensiveSelectors||new Map,window.expensiveSelectors.set(t,s)),n}return r()},yi.useShallowCheckInSubscribe(i);let s=yi.setUpDevtools(i,e);return ye(me({},i),{namedSetState:s})}static makeStoreTriggerOnSubscribe(e){let t=e.subscribe;e.subscribe=(i,n,r)=>(i(e.getState(n),void 0),t(i,n,r))}static useShallowCheckInSubscribe(e){let t=e.subscribe;e.subscribe=(e,i,n)=>(i||(i=e=>e),t(e,i,n=n||ie))}static setUpDevtools(e,t){let i;try{i=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(c){}if(!i)return t=>{e.setState(t)};let n=i.connect(yi.devtoolsOptions(t));n.prefix=t?`${t} > `:"";let r=e.setState;return e.setState=t=>{r(t),n.send(`${n.prefix}setState`,e.getState())},n.subscribe(yi.devtoolsSubscribe(n,e,r)),n.send("setUpStore",e.getState()),(t,i)=>{r(t);let s=i||`${n.prefix}action`;n.send(s,e.getState())}}static devtoolsOptions(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress"]}}static devtoolsSubscribe(e,t,i){return n=>{var r,s,o,a;if("DISPATCH"===n.type&&n.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(n.payload.type)?i(JSON.parse(n.state)):t.setState(JSON.parse(n.state));else if("DISPATCH"===n.type&&"COMMIT"===(null==(r=n.payload)?void 0:r.type))e.init(t.getState());else if("DISPATCH"===n.type&&"IMPORT_STATE"===(null==(s=n.payload)?void 0:s.type)){let r=null==(o=n.payload.nextLiftedState)?void 0:o.actionsById;((null==(a=n.payload.nextLiftedState)?void 0:a.computedStates)||[]).forEach((({state:n},s)=>{let o=r[s]||`${e.prefix}setState`;0===s?e.init(n):(i(n),e.send(o,t.getState()))}))}}}})},828:function(e,t,i){"use strict";i.d(t,{wp:function(){return kt},Nl:function(){return vi},QX:function(){return Oi},QH:function(){return ye},iS:function(){return qe},OL:function(){return Pt},CE:function(){return wt},pZ:function(){return sn},HK:function(){return ze},jU:function(){return Dt},eC:function(){return At}});var n={};i.r(n),i.d(n,{fixNegotiationNeeded:function(){return _},shimAddTrackRemoveTrack:function(){return I},shimAddTrackRemoveTrackWithNative:function(){return R},shimGetDisplayMedia:function(){return S},shimGetSendersWithDtmf:function(){return P},shimGetStats:function(){return C},shimGetUserMedia:function(){return E},shimMediaStream:function(){return b},shimOnTrack:function(){return k},shimPeerConnection:function(){return A},shimSenderReceiverGetStats:function(){return w}});var r={};i.r(r),i.d(r,{shimAddTransceiver:function(){return G},shimCreateAnswer:function(){return B},shimCreateOffer:function(){return V},shimGetDisplayMedia:function(){return O},shimGetParameters:function(){return j},shimGetUserMedia:function(){return D},shimOnTrack:function(){return M},shimPeerConnection:function(){return N},shimRTCDataChannel:function(){return F},shimReceiverGetStats:function(){return x},shimRemoveStream:function(){return U},shimSenderGetStats:function(){return L}});var s={};i.r(s),i.d(s,{shimAudioContext:function(){return Q},shimCallbacksAPI:function(){return W},shimConstraints:function(){return q},shimCreateOfferLegacy:function(){return Y},shimGetUserMedia:function(){return $},shimLocalStreamsAPI:function(){return K},shimRTCIceServerUrls:function(){return J},shimRemoteStreamsAPI:function(){return H},shimTrackEventTransceiver:function(){return z}});var o={};i.r(o),i.d(o,{removeExtmapAllowMixed:function(){return re},shimAddIceCandidateNullOrEmpty:function(){return se},shimConnectionState:function(){return ne},shimMaxMessageSize:function(){return te},shimParameterlessSetLocalDescription:function(){return oe},shimRTCIceCandidate:function(){return ee},shimSendThrowTypeError:function(){return ie}});let a=!0,l=!0;function c(e,t,i){const n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}function d(e,t,i){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),r.apply(this,[e,s])};const s=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(i))return s.apply(this,arguments);const n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function u(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function h(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(l=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function p(){if("object"===typeof window){if(a)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function f(e,t){l&&console.warn(e+" is deprecated, please use "+t+" instead.")}function v(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return v(e)?Object.keys(e).reduce((function(t,i){const n=v(e[i]),r=n?g(e[i]):e[i],s=n&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[i]:r})}),{}):e}function m(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?m(e,e.get(t[n]),i):n.endsWith("Ids")&&t[n].forEach((t=>{m(e,e.get(t),i)}))})))}function y(e,t,i){const n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((i=>{i.type===n&&i.trackId===t.id&&m(e,i,r)}))})),r}const T=p;function E(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const n=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const n="object"===typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"===typeof n.exact&&(n.min=n.max=n.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"===typeof n.ideal?(e[r("min",i)]=n.ideal,t.optional.push(e),e={},e[r("max",i)]=n.ideal,t.optional.push(e)):(e[r("",i)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!==typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",i)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,i)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===typeof e.video){let s=e.video.facingMode;s=s&&("object"===typeof s?s:{ideal:s});const o=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return i.mediaDevices.enumerateDevices().then((i=>{let o=(i=i.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&i.length&&t.includes("back")&&(o=i[i.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=n(e.video),T("chrome: "+JSON.stringify(e)),r(e)}))}e.video=n(e.video)}return T("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(e,t,n){r(e,(e=>{i.webkitGetUserMedia(e,t,(e=>{n&&n(s(e))}))}))}.bind(i),i.mediaDevices.getUserMedia){const e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function S(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((t=>{const n=i.video&&i.video.width,r=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(i.video.mandatory.maxWidth=n),r&&(i.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function b(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function k(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.track.id)):{track:i.track};const r=new Event("track");r.track=i.track,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.id)):{track:i};const r=new Event("track");r.track=i,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else d(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function P(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let r=i.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function C(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,n]=arguments;if(arguments.length>0&&"function"===typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{i[t]=e.stat(t)})),t[i.id]=i})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){i(s(r(e)))};return t.apply(this,[n,e])}return new Promise(((e,i)=>{t.apply(this,[function(t){e(s(r(t)))},i])})).then(i,n)}}function w(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),d(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,n;return this.getSenders().forEach((i=>{i.track===e&&(t?n=!0:t=i)})),this.getReceivers().forEach((t=>(t.track===e&&(i?n=!0:i=t),t.track===e))),n||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function R(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();i.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function I(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return R(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(r.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:i})}function o(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(n.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const r=this.getSenders().find((e=>e.track===t));if(r)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[i.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[i.id]=n,this._reverseStreams[n.id]=i,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"===typeof arguments[0]?i.apply(this,[t=>{const i=s(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=l.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((i=>{this._streams[i].getTracks().find((t=>e.track===t))&&(t=this._streams[i])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function A(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function _(e,t){d(e,"negotiationneeded",(e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e}))}function D(e,t){const i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){f("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"===typeof i&&"object"===typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"===typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function O(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function M(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function N(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=i[e.type]||e.type}))}catch(Xe){if("TypeError"!==Xe.name)throw Xe;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,s)}}function L(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function x(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),d(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function U(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){f("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function F(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function G(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(i){const{sender:t}=n,i=t.getParameters();(!("encodings"in i)||1===i.encodings.length&&0===Object.keys(i.encodings[0]).length)&&(i.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(i).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function j(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function V(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function B(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function K(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((i=>t.call(this,i,e))),e.getVideoTracks().forEach((i=>t.call(this,i,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach((e=>{i.includes(e.track)&&this.removeTrack(e)}))})}}function H(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}))}),t.apply(e,arguments)}}}function W(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r};let a=function(e,t,i){const n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=a,a=function(e,t,i){const n=s.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.setRemoteDescription=a,a=function(e,t,i){const n=o.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=a}function $(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(q(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}.bind(t))}function q(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function J(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let n=e.iceServers[i];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(f("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function z(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Q(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var X=i(7539),Z=i.n(X);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),n=Z().parseCandidate(e.candidate),r=Object.assign(i,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,d(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function te(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const i=function(e){if(!e||!e.sdp)return!1;const t=Z().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Z().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!==i?-1:i},r=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i},s=function(e,i){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const r=Z().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?n=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const e=n(arguments[0]),t=r(e),i=s(arguments[0],e);let o;o=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function ie(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},d(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function ne(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))}function re(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const i=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function oe(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return i.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>i.apply(this,[e])))})}var ae,le=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=p,a=function(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=c(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=c(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=c(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),l={browserDetails:a,commonShim:o,extractVersion:c,disableLog:u,disableWarnings:h,sdp:X};switch(a.browser){case"chrome":if(!n||!A||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),l;if(null===a.version)return i("Chrome shim can not determine version, not shimming."),l;i("adapter.js shimming chrome."),l.browserShim=n,se(e,a),oe(e),E(e,a),b(e),A(e,a),k(e),I(e,a),P(e),C(e),w(e),_(e,a),ee(e),ne(e),te(e,a),ie(e),re(e,a);break;case"firefox":if(!r||!N||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),l;i("adapter.js shimming firefox."),l.browserShim=r,se(e,a),oe(e),D(e,a),N(e,a),M(e),U(e),L(e),x(e),F(e),G(e),j(e),V(e),B(e),ee(e),ne(e),te(e,a),ie(e);break;case"safari":if(!s||!t.shimSafari)return i("Safari shim is not included in this adapter release."),l;i("adapter.js shimming safari."),l.browserShim=s,se(e,a),oe(e),J(e),Y(e),W(e),K(e),H(e),z(e),$(e),Q(e),ee(e),te(e,a),ie(e),re(e,a);break;default:i("Unsupported browser!")}return l}({window:"undefined"===typeof window?void 0:window}),ce=i(766),de=i(2238),ue=new Uint8Array(16);function he(){if(!ae&&!(ae="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ae(ue)}var pe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var fe=function(e){return"string"===typeof e&&pe.test(e)},ve=[],ge=0;ge<256;++ge)ve.push((ge+256).toString(16).substr(1));var me=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(ve[e[t+0]]+ve[e[t+1]]+ve[e[t+2]]+ve[e[t+3]]+"-"+ve[e[t+4]]+ve[e[t+5]]+"-"+ve[e[t+6]]+ve[e[t+7]]+"-"+ve[e[t+8]]+ve[e[t+9]]+"-"+ve[e[t+10]]+ve[e[t+11]]+ve[e[t+12]]+ve[e[t+13]]+ve[e[t+14]]+ve[e[t+15]]).toLowerCase();if(!fe(i))throw TypeError("Stringified UUID is invalid");return i};var ye,Te,Ee=function(e,t,i){var n=(e=e||{}).random||(e.rng||he)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return me(n)},Se=i(6387),be=Object.defineProperty,ke=Object.defineProperties,Pe=Object.getOwnPropertyDescriptors,Ce=Object.getOwnPropertySymbols,we=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,Ie=(e,t,i)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ae=(e,t)=>{for(var i in t||(t={}))we.call(t,i)&&Ie(e,i,t[i]);if(Ce)for(var i of Ce(t))Re.call(t,i)&&Ie(e,i,t[i]);return e},_e=(e,t)=>ke(e,Pe(t)),De=(e,t,i)=>new Promise(((n,r)=>{var s=e=>{try{a(i.next(e))}catch(t){r(t)}},o=e=>{try{a(i.throw(e))}catch(t){r(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,o);a((i=i.apply(e,t)).next())}));(Te=ye||(ye={}))[Te.VERBOSE=0]="VERBOSE",Te[Te.DEBUG=1]="DEBUG",Te[Te.INFO=2]="INFO",Te[Te.WARN=3]="WARN",Te[Te.TIME=4]="TIME",Te[Te.TIMEEND=5]="TIMEEND",Te[Te.ERROR=6]="ERROR",Te[Te.NONE=7]="NONE";var Oe,Me,Ne="undefined"!=typeof window&&"undefined"!=typeof window.expect,Le=class{static v(e,...t){this.log(0,e,...t)}static d(e,...t){this.log(1,e,...t)}static i(e,...t){this.log(2,e,...t)}static w(e,...t){this.log(3,e,...t)}static e(e,...t){this.log(6,e,...t)}static time(e){this.log(4,"[HMSPerformanceTiming]",e)}static timeEnd(e){this.log(5,"[HMSPerformanceTiming]",e,e)}static cleanUp(){performance.clearMarks(),performance.clearMeasures()}static log(e,t,...i){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log(t,...i);break;case 1:console.debug(t,...i);break;case 2:console.info(t,...i);break;case 3:console.warn(t,...i);break;case 6:console.error(t,...i);break;case 4:performance.mark(i[0]);break;case 5:{let e=i[0];try{let i=performance.measure(e,e);this.log(1,t,e,null==i?void 0:i.duration),performance.clearMarks(e),performance.clearMeasures(e)}catch(n){this.log(1,t,e,n)}break}}}};Le.level=Ne?7:0,(Me=Oe||(Oe={}))[Me.Publish=0]="Publish",Me[Me.Subscribe=1]="Subscribe";var xe,Ue,Fe={WebSocketConnectionErrors:{GENERIC_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003},InitAPIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},Ge=class extends Error{constructor(e,t,i,n,r,s=!1){super(n),this.code=e,this.name=t,this.message=n,this.description=r,this.isTerminal=s,Object.setPrototypeOf(this,Ge.prototype),this.action=i.toString()}toAnalyticsProperties(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}addNativeError(e){this.nativeError=e}};(Ue=xe||(xe={})).NONE="NONE",Ue.TRACK="TRACK",Ue.INIT="INIT",Ue.PUBLISH="PUBLISH",Ue.UNPUBLISH="UNPUBLISH",Ue.JOIN="JOIN",Ue.SUBSCRIBE="SUBSCRIBE",Ue.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",Ue.RESTART_ICE="RESTART_ICE",Ue.VIDEO_PLUGINS="VIDEO_PLUGINS",Ue.AUDIO_PLUGINS="AUDIO_PLUGINS",Ue.AUTOPLAY="AUTOPLAY",Ue.RECONNECT_SIGNAL="RECONNECT_SIGNAL",Ue.VALIDATION="VALIDATION",Ue.PLAYLIST="PLAYLIST",Ue.PREVIEW="PREVIEW";var je={WebSocketConnectionErrors:{GenericConnect:(e,t="")=>new Ge(Fe.WebSocketConnectionErrors.GENERIC_CONNECT,"WebsocketConnection",e,`[WS]: ${t}`,`[WS]: ${t}`),WebSocketConnectionLost:(e,t="")=>new Ge(Fe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t)},InitAPIErrors:{ServerErrors:(e,t,i="")=>new Ge(e,"ServerErrors",t,"[INIT]: Server error",i),EndpointUnreachable:(e,t="")=>new Ge(Fe.InitAPIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,"Endpoint is not reachable.",t),InvalidTokenFormat:(e,t="")=>new Ge(Fe.InitAPIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,`Token is not in proper JWT format - ${t}`,t),InitConfigNotAvailable:(e,t="")=>new Ge(Fe.InitAPIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,`[INIT]: ${t}`,`[INIT]: ${t}`)},TracksErrors:{GenericTrack:(e,t="")=>new Ge(Fe.TracksErrors.GENERIC_TRACK,"GenericTrack",e,`[TRACK]: ${t}`,`[TRACK]: ${t}`),CantAccessCaptureDevice:(e,t,i="")=>new Ge(Fe.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,`[TRACK]: No permission to access capture device - ${t}`,i),DeviceNotAvailable:(e,t,i="")=>new Ge(Fe.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,`[TRACK]: Capture device is no longer available - ${t}`,i),DeviceInUse:(e,t,i="")=>new Ge(Fe.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,`[TRACK]: Capture device is in use by another application - ${t}`,i),DeviceLostMidway:(e,t,i="")=>new Ge(Fe.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,`Lost access to capture device midway - ${t}`,i),NothingToReturn:(e,t="")=>new Ge(Fe.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,"There is no media to return. Please select either video or audio or both.",t),InvalidVideoSettings:(e,t="")=>new Ge(Fe.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t),AutoplayBlocked:(e,t="")=>new Ge(Fe.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t),CodecChangeNotPermitted:(e,t="")=>new Ge(Fe.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t),OverConstrained:(e,t,i="")=>new Ge(Fe.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,`[TRACK]: Requested constraints cannot be satisfied with the device hardware - ${t}`,i)},WebrtcErrors:{CreateOfferFailed:(e,t="")=>new Ge(Fe.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,`[${e.toString()}]: Failed to create offer. `,t),CreateAnswerFailed:(e,t="")=>new Ge(Fe.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,`[${e.toString()}]: Failed to create answer. `,t),SetLocalDescriptionFailed:(e,t="")=>new Ge(Fe.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,`[${e.toString()}]: Failed to set offer. `,t),SetRemoteDescriptionFailed:(e,t="")=>new Ge(Fe.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,`[${e.toString()}]: Failed to set answer. `,t),ICEFailure:(e,t="")=>new Ge(Fe.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,`[${e.toString()}]: Ice connection state FAILED`,t)},WebsocketMethodErrors:{ServerErrors:(e,t,i)=>new Ge(e,"ServerErrors",t,i,i,!0),AlreadyJoined:(e,t="")=>new Ge(Fe.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t),CannotJoinPreviewInProgress:(e,t="")=>new Ge(Fe.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)},GenericErrors:{NotConnected:(e,t="")=>new Ge(Fe.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t),Signalling:(e,t)=>new Ge(Fe.GenericErrors.SIGNALLING,"Signalling",e,`Unknown signalling error: ${e.toString()} ${t} `,t),Unknown:(e,t)=>new Ge(Fe.GenericErrors.UNKNOWN,"Unknown",e,`Unknown exception: ${t}`,t),NotReady:(e,t="")=>new Ge(Fe.GenericErrors.NOT_READY,"NotReady",e,t,t),JsonParsingFailed:(e,t,i="")=>new Ge(Fe.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,`Failed to parse JSON message - ${t}`,i),TrackMetadataMissing:(e,t="")=>new Ge(Fe.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t),RTCTrackMissing:(e,t="")=>new Ge(Fe.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t),PeerMetadataMissing:(e,t="")=>new Ge(Fe.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t),ValidationFailed:(e,t)=>new Ge(Fe.GenericErrors.INVALID_ROLE,"ValidationFailed",xe.VALIDATION,e,t?JSON.stringify(t):""),InvalidRole:(e,t)=>new Ge(Fe.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0),PreviewAlreadyInProgress:(e,t="")=>new Ge(Fe.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t),MissingMediaDevices:()=>new Ge(Fe.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",xe.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0),MissingRTCPeerConnection:()=>new Ge(Fe.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",xe.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)},MediaPluginErrors:{PlatformNotSupported:(e,t="")=>new Ge(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t),InitFailed:(e,t="")=>new Ge(7002,"InitFailed",e,"Plugin init failed",t),ProcessingFailed:(e,t="")=>new Ge(7003,"ProcessingFailed",e,"Plugin processing failed",t),AddAlreadyInProgress:(e,t="")=>new Ge(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},PlaylistErrors:{NoEntryToPlay:(e,t)=>new Ge(Fe.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t),NoEntryPlaying:(e,t)=>new Ge(Fe.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}},Ve="VALIDATIONS";function Be(e){return null!=e}var Ke=()=>{if(!Be(RTCPeerConnection)){let e=je.GenericErrors.MissingRTCPeerConnection();throw Le.e(Ve,e),e}},He=()=>{if(!Be(navigator.mediaDevices)){let e=je.GenericErrors.MissingMediaDevices();throw Le.e(Ve,e),e}};var We,$e,qe,Je,ze,Ye,Qe,Xe,Ze,et="HMSConnection",tt=class{constructor(e,t){this.candidates=new Array,this.role=e,this.signal=t}get iceConnectionState(){return this.nativeConnection.iceConnectionState}get connectionState(){return this.nativeConnection.connectionState}get action(){return this.role===Oe.Publish?xe.PUBLISH:xe.SUBSCRIBE}addTransceiver(e,t){return this.nativeConnection.addTransceiver(e,t)}createOffer(e,t){return De(this,null,(function*(){try{let n=yield this.nativeConnection.createOffer(e);return Le.d(et,`[role=${this.role}] createOffer offer=${JSON.stringify(n,null,1)}`),(i=function(e,t){var i;let n=(0,ce.Qc)(e.sdp);if(!(null==(i=n.origin)?void 0:i.username.startsWith("mozilla")))return e;let r=Array.from(t.values());return n.media.forEach((e=>{var t,i,n;let s=null==(t=e.msid)?void 0:t.split(" ")[0],o=null==(i=r.find((t=>t.type===e.type&&t.stream_id===s)))?void 0:i.track_id;o&&(e.msid=null==(n=e.msid)?void 0:n.replace(/\s(.+)/,` ${o}`))})),{type:e.type,sdp:(0,ce.cW)(n)}}(n,t)).sdp.includes("usedtx=1")?i:{type:i.type,sdp:i.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}catch(vt){throw je.WebrtcErrors.CreateOfferFailed(this.action,vt.message)}var i}))}createAnswer(e){return De(this,null,(function*(){try{let t=yield this.nativeConnection.createAnswer(e);return Le.d(et,`[role=${this.role}] createAnswer answer=${JSON.stringify(t,null,1)}`),t}catch(Me){throw je.WebrtcErrors.CreateAnswerFailed(this.action,Me.message)}}))}setLocalDescription(e){return De(this,null,(function*(){try{Le.d(et,`[role=${this.role}] setLocalDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setLocalDescription(e)}catch(Me){throw je.WebrtcErrors.SetLocalDescriptionFailed(this.action,Me.message)}}))}setRemoteDescription(e){return De(this,null,(function*(){try{Le.d(et,`[role=${this.role}] setRemoteDescription description=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.setRemoteDescription(e)}catch(Me){throw je.WebrtcErrors.SetRemoteDescriptionFailed(this.action,Me.message)}}))}addIceCandidate(e){return De(this,null,(function*(){Le.d(et,`[role=${this.role}] addIceCandidate candidate=${JSON.stringify(e,null,1)}`),yield this.nativeConnection.addIceCandidate(e)}))}get remoteDescription(){return this.nativeConnection.remoteDescription}getSenders(){return this.nativeConnection.getSenders()}removeTrack(e){this.nativeConnection.removeTrack(e)}setMaxBitrate(e,t){return De(this,null,(function*(){let i=this.getSenders().find((e=>{var i;return(null==(i=null==e?void 0:e.track)?void 0:i.id)===t.getTrackIDBeingSent()}));if(i){let t=i.getParameters();t.encodings.length>0&&(t.encodings[0].maxBitrate=1e3*e),yield i.setParameters(t)}else Le.w(et,`no sender found to setMaxBitrate for track - ${t.trackId}, sentTrackId - ${t.getTrackIDBeingSent()}`)}))}getStats(){return De(this,null,(function*(){return yield this.nativeConnection.getStats()}))}close(){return De(this,null,(function*(){this.nativeConnection.close()}))}},it="renegotiation-callback-id",nt="ion-sfu",rt="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",st="device-change",ot="local-audio-enabled",at="local-video-enabled",lt="stats-update",ct="track-degraded",dt="track-restored",ut="track-audio-level-update",ht=class extends tt{constructor(e,t,i,n){super(Oe.Publish,e),this.observer=i,this.transport=n,this.nativeConnection=new RTCPeerConnection(t),this.nativeConnection.createDataChannel(nt,{protocol:"SCTP"}),this.nativeConnection.onicecandidate=({candidate:t})=>{t&&e.trickle(this.role,t)},this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)}}initAfterJoin(){this.nativeConnection.onnegotiationneeded=()=>De(this,null,(function*(){Le.d("HMSPublishConnection","onnegotiationneeded"),yield this.observer.onRenegotiationNeeded()}))}trackUpdate(e){this.transport.trackUpdate(e)}},pt=class{constructor(e){this.tracks=new Array,this.nativeStream=e,this.id=e.id}};($e=We||(We={}))[$e.PEER_ADDED=0]="PEER_ADDED",$e[$e.PEER_REMOVED=1]="PEER_REMOVED",$e[$e.PEER_KNOCKED=2]="PEER_KNOCKED",$e[$e.ROOM_TYPE_CHANGED=3]="ROOM_TYPE_CHANGED",$e[$e.METADATA_UPDATED=4]="METADATA_UPDATED",$e[$e.SCREENSHARE_STARTED=5]="SCREENSHARE_STARTED",$e[$e.SCREENSHARE_STOPPED=6]="SCREENSHARE_STOPPED",$e[$e.DEFAULT_UPDATE=7]="DEFAULT_UPDATE",$e[$e.RECORDING_STATE_UPDATED=8]="RECORDING_STATE_UPDATED",$e[$e.BROWSER_RECORDING_STATE_UPDATED=9]="BROWSER_RECORDING_STATE_UPDATED",$e[$e.SERVER_RECORDING_STATE_UPDATED=10]="SERVER_RECORDING_STATE_UPDATED",$e[$e.RTMP_STREAMING_STATE_UPDATED=11]="RTMP_STREAMING_STATE_UPDATED",$e[$e.HLS_STREAMING_STATE_UPDATED=12]="HLS_STREAMING_STATE_UPDATED",$e[$e.ROOM_STATE=13]="ROOM_STATE",(Je=qe||(qe={}))[Je.PEER_JOINED=0]="PEER_JOINED",Je[Je.PEER_LEFT=1]="PEER_LEFT",Je[Je.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",Je[Je.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",Je[Je.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",Je[Je.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",Je[Je.STARTED_SPEAKING=6]="STARTED_SPEAKING",Je[Je.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",Je[Je.ROLE_UPDATED=8]="ROLE_UPDATED",Je[Je.PEER_LIST=9]="PEER_LIST",Je[Je.NAME_UPDATED=10]="NAME_UPDATED",Je[Je.METADATA_UPDATED=11]="METADATA_UPDATED",(Ye=ze||(ze={}))[Ye.TRACK_ADDED=0]="TRACK_ADDED",Ye[Ye.TRACK_REMOVED=1]="TRACK_REMOVED",Ye[Ye.TRACK_MUTED=2]="TRACK_MUTED",Ye[Ye.TRACK_UNMUTED=3]="TRACK_UNMUTED",Ye[Ye.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",Ye[Ye.TRACK_DEGRADED=5]="TRACK_DEGRADED",Ye[Ye.TRACK_RESTORED=6]="TRACK_RESTORED",(Xe=Qe||(Qe={}))[Xe.DEFAULT=0]="DEFAULT",function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"}(Ze||(Ze={}));var ft,vt,gt,mt,yt={f:Ze.HIGH,h:Ze.MEDIUM,q:Ze.LOW};(vt=ft||(ft={})).VP8="vp8",vt.VP9="vp9",vt.H264="h264",function(e){e.OPUS="opus"}(gt||(gt={})),function(e){e.audio="audio",e.video="video"}(mt||(mt={}));var Tt,Et=class extends pt{constructor(e,t){super(e),this.audio=!0,this.video=Ze.NONE,this.frameRate=Ze.HIGH,this.connection=t}setAudio(e){this.audio!==e&&(this.audio=e,this.syncWithApiChannel())}setVideo(e){this.video!==e?(this.video=e,Le.d(`[Remote stream] ${this.id}`,`Switching to ${e} layer`),this.syncWithApiChannel()):Le.d(`[Remote stream] ${this.id}`,`Already on ${e} layer`)}getSimulcastLayer(){return this.video}isAudioSubscribed(){return this.audio}syncWithApiChannel(){let e={streamId:this.id,video:this.video,audio:this.audio,framerate:this.frameRate};this.connection.sendOverApiDataChannel(JSON.stringify(e))}},St=class{get enabled(){return this.nativeTrack.enabled}get trackId(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}getMediaTrackSettings(){return this.nativeTrack.getSettings()}setEnabled(e){return De(this,null,(function*(){this.nativeTrack.enabled=e}))}constructor(e,t,i){this.stream=e,this.nativeTrack=t,this.source=i}setSdpTrackId(e){this.sdpTrackId=e}setFirstTrackId(e){this.firstTrackId=e}cleanup(){var e;null==(e=this.nativeTrack)||e.stop()}};!function(e){e.AUDIO="audio",e.VIDEO="video"}(Tt||(Tt={}));var bt,kt=class extends St{constructor(e,t,i){if(super(e,t,i),this.type=Tt.AUDIO,this.audioElement=null,"audio"!==t.kind)throw new Error("Expected 'track' kind = 'audio'")}getVolume(){return this.audioElement?100*this.audioElement.volume:null}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.subscribeToAudio(0!==e&&this.enabled),this.audioElement&&(this.audioElement.volume=e/100)}setAudioElement(e){this.audioElement=e}getAudioElement(){return this.audioElement}getOutputDevice(){return this.outputDevice}cleanup(){super.cleanup(),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}setOutputDevice(e){return De(this,null,(function*(){var t;if(this.audioElement)try{"function"==typeof this.audioElement.setSinkId&&(yield null==(t=this.audioElement)?void 0:t.setSinkId(e.deviceId),this.outputDevice=e)}catch(vt){Le.d("audio-track",vt)}else Le.d("audio-track","no audio element to set output")}))}removeSink(){var e;this.audioElement&&(null==(e=window.HMS)?void 0:e.AUDIO_SINK)&&(this.audioElement.srcObject=null,this.subscribeToAudio(!1))}addSink(){var e,t;if(!this.nativeTrack||!this.audioElement||!(null==(e=window.HMS)?void 0:e.AUDIO_SINK))return;let i=this.audioElement.srcObject;null!==i&&i instanceof MediaStream&&(null==(t=i.getAudioTracks()[0])?void 0:t.id)===this.nativeTrack.id||(this.audioElement.srcObject=new MediaStream([this.nativeTrack]),this.subscribeToAudio(!0))}subscribeToAudio(e){this.stream instanceof Et&&this.stream.setAudio(e)}},Pt=class extends kt{setEnabled(e){var t=e=>super[e];return De(this,null,(function*(){e!==this.enabled&&(yield t("setEnabled").call(this,e),this.subscribeToAudio(e))}))}},Ct=class extends St{constructor(e,t,i){if(super(e,t,i),this.type=Tt.VIDEO,this.sinkCount=0,"video"!==t.kind)throw new Error("Expected 'track' kind = 'video'")}hasSinks(){return this.sinkCount>0}addSink(e){this.addSinkInternal(e,this.nativeTrack)}removeSink(e){e.srcObject=null,this.sinkCount>0&&this.sinkCount--}addSinkInternal(e,t){var i;let n=e.srcObject;null!==n&&n instanceof MediaStream&&(null==(i=n.getVideoTracks()[0])?void 0:i.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}},wt=class extends Ct{constructor(){super(...arguments),this._degraded=!1,this._degradedAt=null,this._layerDefinitions=[]}get degraded(){return this._degraded}get degradedAt(){return this._degradedAt}setEnabled(e){var t=e=>super[e];return De(this,null,(function*(){e!==this.enabled&&(this._degraded&&!e&&(this._degraded=!1),yield t("setEnabled").call(this,e))}))}preferLayer(e){this.stream.setVideo(e)}getSimulcastLayer(){return this.stream.getSimulcastLayer()}addSink(e){super.addSink(e),this.updateLayer()}removeSink(e){super.removeSink(e),this.updateLayer()}getSimulcastDefinitions(){return[...this._layerDefinitions]}setSimulcastDefinitons(e){this._layerDefinitions=e}setDegraded(e){this._degraded=e,e&&(this._degradedAt=new Date),this.updateLayer()}updateLayer(){let e=this.hasSinks()?Ze.HIGH:Ze.NONE;this.degraded&&(e=Ze.NONE),this.stream.setVideo(e)}},Rt=class extends tt{constructor(e,t,i){super(Oe.Subscribe,e),this.TAG="[HMSSubscribeConnection]",this.remoteStreams=new Map,this.pendingMessageQueue=[],this.handlePendingApiMessages=()=>{this.pendingMessageQueue.length>0&&(Le.d(this.TAG,"Found pending message queue, sending messages"),this.pendingMessageQueue.forEach((e=>this.sendOverApiDataChannel(e))),this.pendingMessageQueue.length=0)},this.observer=i,this.nativeConnection=new RTCPeerConnection(t),this.initNativeConnectionCallbacks()}initNativeConnectionCallbacks(){this.nativeConnection.oniceconnectionstatechange=()=>{this.observer.onIceConnectionChange(this.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=()=>{this.observer.onConnectionStateChange(this.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=e=>{e.channel.label===nt&&(this.apiChannel=new class{constructor(e,t,i=""){this.TAG="HMSDataChannel",this.nativeChannel=e,this.observer=t,this.metadata=i,e.onmessage=e=>{this.observer.onMessage(e.data)}}get id(){return this.nativeChannel.id}get label(){return this.nativeChannel.label}get readyState(){return this.nativeChannel.readyState}send(e){Le.d(this.TAG,`[${this.metadata}] Sending [size=${e.length}] message=${e}`),this.nativeChannel.send(e)}close(){this.nativeChannel.close()}}(e.channel,{onMessage:e=>{this.observer.onApiChannelMessage(e)}},`role=${this.role}`),e.channel.onopen=this.handlePendingApiMessages)},this.nativeConnection.onicecandidate=e=>{null!==e.candidate&&this.signal.trickle(this.role,e.candidate)},this.nativeConnection.ontrack=e=>{var t;let i=e.streams[0],n=i.id;if(!this.remoteStreams.has(n)){let e=new Et(i,this);this.remoteStreams.set(n,e),i.onremovetrack=t=>{let i=e.tracks.findIndex((e=>e.nativeTrack.id===t.track.id));if(i>=0){let t=e.tracks[i];this.observer.onTrackRemove(t),e.tracks.splice(i,1),0===e.tracks.length&&this.remoteStreams.delete(n)}}}let r=this.remoteStreams.get(n),s=new("audio"===e.track.kind?Pt:wt)(r,e.track),o=function(e,t){var i;if(!(null==e?void 0:e.sdp)||!t)return;let n=(0,ce.Qc)(e.sdp).media.find((e=>Be(e.mid)&&parseInt(e.mid)===parseInt(t)));return null==(i=null==n?void 0:n.msid)?void 0:i.split(" ")[1]}(this.remoteDescription,null==(t=e.transceiver)?void 0:t.mid);o&&s.setSdpTrackId(o),r.tracks.push(s),this.observer.onTrackAdd(s)}}sendOverApiDataChannel(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(Le.w(this.TAG,`API Data channel not ${this.apiChannel?"open":"present"}, queueing`,e),this.pendingMessageQueue.push(e))}close(){var e=e=>super[e];return De(this,null,(function*(){var t;yield e("close").call(this),null==(t=this.apiChannel)||t.close()}))}},It="0.1.43",At=new de.UAParser,_t="undefined"==typeof window&&!(null==(bt=At.getBrowser().name)?void 0:bt.toLowerCase().includes("electron")),Dt="undefined"!=typeof window;var Ot,Mt,Nt=function(){if(_t)return`hmsclient/${It}`;let e=At.getDevice(),t=At.getBrowser(),i=At.getOS();return e.type?`hmsclient/${It} ${i.name}/${i.version} (${e.vendor}_${e.type}_/_${t.name}_${t.version})`:`hmsclient/${It} ${i.name}/${i.version} (${t.name}_${t.version})`}(),Lt="InitService";(Mt=Ot||(Ot={})).JOIN="join",Mt.OFFER="offer",Mt.ANSWER="answer",Mt.TRICKLE="trickle",Mt.TRACK_UPDATE="track-update",Mt.BROADCAST="broadcast",Mt.ANALYTICS="analytics",Mt.SERVER_ERROR="on-error",Mt.SERVER_WARNING="on-warning",Mt.SDK_NOTIFICATION="sdk-notification",Mt.LEAVE="leave",Mt.END_ROOM="end-room",Mt.PING="ping",Mt.ROLE_CHANGE_REQUEST="role-change-request",Mt.ROLE_CHANGE="role-change",Mt.TRACK_UPDATE_REQUEST="track-update-request",Mt.PEER_LEAVE_REQUEST="peer-leave-request",Mt.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",Mt.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",Mt.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",Mt.UPDATE_PEER_METADATA="peer-update",Mt.START_HLS_STREAMING="hls-start",Mt.STOP_HLS_STREAMING="hls-stop";var xt,Ut=class{constructor(){this._volume=1,this._codec=gt.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}volume(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}codec(e){return this._codec=e,this}maxBitrate(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new Ft(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}},Ft=class{constructor(e,t,i,n,r){this.volume=e,this.codec=t,this.maxBitrate=i,this.deviceId=n,this.advanced=r}toConstraints(){return{deviceId:this.deviceId,advanced:this.advanced}}toAnalyticsProperties(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}},Gt=class{constructor(){this._width=320,this._height=180,this._codec=ft.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}setWidth(e){return this._width=e,this}setHeight(e){return this._height=e,this}codec(e){return this._codec=e,this}maxFramerate(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}maxBitrate(e,t=!0){if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}deviceId(e){return this._deviceId=e,this}advanced(e){return this._advanced=e,this}build(){return new jt(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate)}},jt=class{constructor(e,t,i,n,r,s,o){this.width=e,this.height=t,this.codec=i,this.maxFramerate=n,this.maxBitrate=o,this.deviceId=r,this.advanced=s}toConstraints(){return{width:this.width,height:this.height,frameRate:this.maxFramerate,deviceId:this.deviceId}}toAnalyticsProperties(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec}}},Vt=class{constructor(){this._video=(new Gt).build(),this._audio=(new Ut).build(),this._screen=(new Gt).build(),this._simulcast=!1}video(e){return this._video=e,this}audio(e){return this._audio=e,this}screen(e){return this._screen=e,this}simulcast(e){return this._simulcast=e,this}build(){if(null===this._audio&&null===this._video)throw je.TracksErrors.NothingToReturn(xe.TRACK);if(null===this._video&&this._simulcast)throw je.TracksErrors.InvalidVideoSettings(xe.TRACK,"Cannot enable simulcast when no video settings are provided");return new Bt(this._video,this._audio,this._simulcast,this._screen||void 0)}},Bt=class{constructor(e,t,i,n=null){this.video=e,this.audio=t,this.simulcast=i,this.screen=n}toAnalyticsProperties(){let e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=Ae(Ae({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=Ae(Ae({},this.video.toAnalyticsProperties()),e)),e}};!function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.SFU_STATS="sfu-stats",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop"}(xt||(xt={}));var Kt=class{constructor({sender:e,message:t,type:i="chat",recipientPeer:n,recipientRoles:r,time:s}){this.sender=e,this.message=t,this.type=i,this.recipientPeer=n,this.recipientRoles=r,this.time=s}toSignalParams(){var e,t;let i=null==(e=this.recipientRoles)?void 0:e.map((e=>e.name)),n=null==(t=this.recipientPeer)?void 0:t.peerId,r={info:{sender:this.sender.peerId,message:this.message,type:this.type}};return(null==i?void 0:i.length)&&(r.roles=i),n&&(r.peer_id=n),r}},Ht=class{constructor({peerId:e,name:t,isLocal:i,customerUserId:n,metadata:r,role:s}){this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=t,this.peerId=e,this.isLocal=i,this.customerUserId=n,this.metadata=r,s&&(this.role=s)}updateRole(e){this.role=e}updateName(e){this.name=e}updateMetadata(e){this.metadata=e}},Wt=class{};Wt.makePeerId=()=>Ee();var $t,qt=class extends Ht{constructor(e){super(_e(Ae({},e),{peerId:Wt.makePeerId(),isLocal:!0})),this.isLocal=!0,this.auxiliaryTracks=[]}},Jt=class extends Ht{constructor(e){super(_e(Ae({},e),{isLocal:!1})),this.isLocal=!1,this.auxiliaryTracks=[]}};function zt(e,t){let i=function(e,t){let i=e.message.toLowerCase();if("screen"===t&&"chrome"===le.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return je.TracksErrors.DeviceNotAvailable(xe.TRACK,t,e.message);switch(e.name){case"OverconstrainedError":return je.TracksErrors.OverConstrained(xe.TRACK,t,e.constraint);case"NotAllowedError":return je.TracksErrors.CantAccessCaptureDevice(xe.TRACK,t,e.message);case"NotFoundError":return je.TracksErrors.DeviceNotAvailable(xe.TRACK,t,e.message);case"NotReadableError":return je.TracksErrors.DeviceInUse(xe.TRACK,t,e.message);case"TypeError":return je.TracksErrors.NothingToReturn(xe.TRACK,e.message);default:return i.includes("device not found")?je.TracksErrors.DeviceNotAvailable(xe.TRACK,t,e.message):i.includes("permission denied")?je.TracksErrors.CantAccessCaptureDevice(xe.TRACK,t,e.message):je.TracksErrors.GenericTrack(xe.TRACK,e.message)}}(e,t);return i.addNativeError(e),i}function Yt(e){return De(this,null,(function*(){try{return(yield navigator.mediaDevices.getUserMedia({audio:!!e&&e.toConstraints()})).getAudioTracks()[0]}catch(Xe){throw zt(Xe,$t.AUDIO)}}))}function Qt(e){return De(this,null,(function*(){try{return(yield navigator.mediaDevices.getUserMedia({video:!!e&&e.toConstraints()})).getVideoTracks()[0]}catch(Xe){throw zt(Xe,$t.VIDEO)}}))}function Xt(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}!function(e){e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"}($t||($t={}));var Zt,ei;!function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(Zt||(Zt={})),function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"}(ei||(ei={}));var ti,ii,ni=function(){if(Dt&&window){let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?ei.LOCAL:e.includes("app.100ms.live")?ei.HMS:ei.CUSTOM}return ei.CUSTOM}(),ri=class{constructor({name:e,level:t,properties:i,includesPII:n,timestamp:r}){this.name=e,this.level=t,this.includesPII=n||!1,this.properties=i||{},this.timestamp=r||(new Date).getTime()}toSignalParams(){return{name:this.name,info:_e(Ae({},this.properties),{timestamp:this.timestamp,domain:ni}),timestamp:(new Date).getTime()}}};!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(ti||(ti={})),function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(ii||(ii={}));var si=class{static failure(e,t){let i=ii.ERROR,n=Ae({plugin_name:e},t.toAnalyticsProperties());return new ri({name:"mediaPlugin.failed",level:i,properties:n})}static audioPluginStats({pluginName:e,duration:t,loadTime:i}){let n=ii.INFO;return new ri({name:"mediaPlugin.stats",level:n,properties:{plugin_name:e,duration:t,load_time:i}})}static stats({pluginName:e,duration:t,loadTime:i,avgPreProcessingTime:n,avgProcessingTime:r,inputFrameRate:s,pluginFrameRate:o}){let a=ii.INFO;return new ri({name:"mediaPlugin.stats",level:a,properties:{plugin_name:e,duration:t,load_time:i,avg_preprocessing_time:n,avg_processing_time:r,input_frame_rate:s,plugin_frame_rate:o}})}},oi="AnalyticsEventsService",ai=new class{constructor(){this.bufferSize=100,this.transports=[],this.pendingEvents=[],this.level=ti.INFO}addTransport(e){this.transports.push(e)}removeTransport(e){this.transports.splice(this.transports.indexOf(e),1)}queue(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){let e=this.pendingEvents.shift();Le.d(oi,"Max buffer size reached","Removed event to accommodate new events",e)}return this}flush(){if(0!==this.transports.length)try{for(;this.pendingEvents.length>0;){let e=this.pendingEvents.shift();e&&this.transports.forEach((t=>t.sendEvent(e)))}}catch(Xe){Le.w(oi,"Flush Failed",Xe)}else Le.w(oi,"No valid signalling API found to flush analytics")}},li="AudioPluginsAnalytics",ci="AudioPluginsManager",di=class{constructor(e){this.key=e,this.storage=null}getStorage(){return Dt&&(this.storage=window.localStorage),this.storage}get(){var e;let t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}set(e){var t;let i=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,i)}clear(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}},ui=new class{constructor(){this.storage=new di("hms-device-selection"),this.remember=!1,this.TAG="HMSDeviceStorage"}setDevices(e){this.devices=e}rememberDevices(e){this.remember=e}updateSelection(e,{deviceId:t,groupId:i}){if(!this.devices||!this.remember)return;let n=this.devices[e].find((e=>this.isSame({deviceId:t,groupId:i},e)));if(!n)return void Le.w(this.TAG,`Could not find device with deviceId: ${t}, groupId: ${i}`);let r=this.storage.get()||{};r[e]=n,this.storage.set(r)}getSelection(){if(this.remember)return this.storage.get()}cleanup(){this.remember=!1,this.devices=void 0}isSame(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}};function hi(e,t){return function(i){return i in e&&e[i]!==t[i]}}var pi,fi="HMSLocalAudioTrack",vi=class extends kt{constructor(e,t,i,n,r=(new Ut).build()){super(e,t,i),this.eventBus=n,this.handleSettingsChange=e=>De(this,null,(function*(){let t=this.stream,i=hi(e,this.settings);i("maxBitrate")&&e.maxBitrate&&(yield t.setMaxBitrate(e.maxBitrate,this)),i("advanced")&&(yield this.nativeTrack.applyConstraints(e.toConstraints()))})),this.handleDeviceChange=(e,t=!1)=>De(this,null,(function*(){if(hi(e,this.settings)("deviceId")){let i=Boolean(this.audioLevelMonitor);Le.d(fi,"Device change",{isLevelMonitored:i}),i&&this.destroyAudioLevelMonitor(),yield this.replaceTrackWith(e),i&&this.initAudioLevelMonitor(),t||ui.updateSelection("audioInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId})}})),e.tracks.push(this),this.settings=r,"default"===r.deviceId&&!Xt(t)&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new class{constructor(e){this.pluginAddInProgress=!1,this.hmsTrack=e,this.pluginsMap=new Map,this.analytics=new class{constructor(){this.initTime={},this.addedTimestamps={},this.pluginAdded={}}added(e){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0}removed(e){if(this.pluginAdded[e]){let t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e]};ai.queue(si.audioPluginStats(t)).flush(),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(ai.queue(si.failure(e,t)).flush(),this.clean(e))}initWithTime(e,t){return De(this,null,(function*(){if(this.initTime[e])return void Le.i(li,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);let i;try{i=yield this.timeInMs(t),Le.i(li,`Time taken for Plugin ${e} initialization : ${i}`)}catch(n){let i=je.MediaPluginErrors.InitFailed(xe.AUDIO_PLUGINS,`failed during initialization of plugin${n.message||n}`);throw Le.e(li,i),this.failure(e,i),i}i&&(this.initTime[e]=i)}))}timeInMs(e){return De(this,null,(function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)}))}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e]}}}getPlugins(){return Array.from(this.pluginsMap.keys())}addPlugin(e){return De(this,null,(function*(){var t;let i=null==(t=e.getName)?void 0:t.call(e);if(i){if(this.pluginAddInProgress){let e=je.MediaPluginErrors.AddAlreadyInProgress(xe.AUDIO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.failure(i,e),Le.w("can't add another plugin when previous add is in progress"),e}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e)}finally{this.pluginAddInProgress=!1}}else Le.w("no name provided by the plugin")}))}addPluginInternal(e){return De(this,null,(function*(){var t;let i=null==(t=e.getName)?void 0:t.call(e);if(this.pluginsMap.get(i))Le.w(ci,`plugin - ${i} already added.`);else{if(!e.isSupported()){let t=je.MediaPluginErrors.PlatformNotSupported(xe.AUDIO_PLUGINS,"platform not supported ");return this.analytics.failure(i,t),void Le.i(ci,`Platform is not supported for plugin - ${e.getName()}`)}try{0===this.pluginsMap.size?yield this.initContextAndAudioNodes():this.prevAudioNode&&this.prevAudioNode.disconnect(),this.analytics.added(i),yield this.analytics.initWithTime(i,(()=>De(this,null,(function*(){return e.init()})))),this.pluginsMap.set(i,e),yield this.processPlugin(e),yield this.connectToDestination()}catch(n){throw Le.e(ci,"failed to add plugin",n),n}}}))}removePlugin(e){return De(this,null,(function*(){yield this.removePluginInternal(e),0===this.pluginsMap.size?(yield this.cleanup(),Le.i(ci,"No plugins left, stopping plugins loop"),yield this.hmsTrack.setProcessedTrack(void 0)):yield this.reprocessPlugins()}))}cleanup(){return De(this,null,(function*(){var e,t,i,n;for(let r of this.pluginsMap.values())yield this.removePluginInternal(r);yield this.hmsTrack.setProcessedTrack(void 0),null==(e=this.audioContext)||e.close(),null==(t=this.sourceNode)||t.disconnect(),null==(i=this.prevAudioNode)||i.disconnect(),null==(n=this.outputTrack)||n.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.audioContext=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0}))}reprocessPlugins(){return De(this,null,(function*(){if(0===this.pluginsMap.size||!this.sourceNode)return;let e=Array.from(this.pluginsMap.values());yield this.cleanup(),yield this.initContextAndAudioNodes();for(let t of e)yield this.addPlugin(t)}))}initContextAndAudioNodes(){return De(this,null,(function*(){if(this.audioContext||(this.audioContext=new AudioContext),!this.sourceNode){let e=new MediaStream([this.hmsTrack.nativeTrack]);this.sourceNode=this.audioContext.createMediaStreamSource(e)}if(!this.destinationNode){this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0];try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw Le.e(ci,"error in setting processed track",e),e}}}))}processPlugin(e){return De(this,null,(function*(){try{let t=yield e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);this.prevAudioNode&&this.prevAudioNode.connect(t),this.prevAudioNode=t}catch(t){let n=e.getName();Le.e(ci,`error in processing plugin ${n}`,t),yield this.removePluginInternal(e)}}))}connectToDestination(){return De(this,null,(function*(){try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(e){Le.e(ci,"error in connecting to destination node",e)}}))}removePluginInternal(e){return De(this,null,(function*(){var t;let i=null==(t=e.getName)?void 0:t.call(e);this.pluginsMap.get(i)?(Le.i(ci,`removing plugin ${i}`),this.pluginsMap.delete(i),e.stop(),this.analytics.removed(i)):Le.w(ci,`plugin - ${i} not found to remove.`)}))}}(this),this.publishedTrackId=this.trackId,this.setFirstTrackId(t.id)}replaceTrackWith(e){return De(this,null,(function*(){let t=this.nativeTrack,i=this.enabled;null==t||t.stop();let n=yield Yt(e);n.enabled=i;let r=this.stream;yield r.replaceSenderTrack(t,this.processedTrack||n),yield r.replaceStreamTrack(t,n),this.nativeTrack=n,yield this.pluginsManager.reprocessPlugins()}))}setEnabled(e){var t=e=>super[e];return De(this,null,(function*(){e!==this.enabled&&(e&&Xt(this.nativeTrack)&&(yield this.replaceTrackWith(this.settings)),yield t("setEnabled").call(this,e),this.eventBus.localAudioEnabled.publish(e),this.stream.trackUpdate(this))}))}setSettings(e,t=!1){return De(this,null,(function*(){let i=this.buildNewSettings(e);this.handleDeviceChange(i,t),Xt(this.nativeTrack)||this.handleSettingsChange(i),this.settings=i}))}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e){return De(this,null,(function*(){return this.pluginsManager.addPlugin(e)}))}removePlugin(e){return De(this,null,(function*(){return this.pluginsManager.removePlugin(e)}))}setProcessedTrack(e){return De(this,null,(function*(){if(!e)return this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),void(this.processedTrack=void 0);e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)}))}initAudioLevelMonitor(){Le.d(fi,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new class{constructor(e,t){this.track=e,this.audioLevelEvent=t,this.TAG="[TrackAudioLevelMonitor]",this.averaging=.99,this.audioLevel=0,this.rawLevel=0,this.processVolume=e=>{let t=e.inputBuffer.getChannelData(0),i=0;for(let r=0;r<t.length;++r)i+=t[r]*t[r];let n=Math.sqrt(i/t.length);this.rawLevel=Math.max(n,this.rawLevel*this.averaging)};try{this.audioContext=new AudioContext,this.audioSource=this.audioContext.createMediaStreamSource(new MediaStream([this.track.nativeTrack])),this.processor=this.audioContext.createScriptProcessor(512),this.processor.addEventListener("audioprocess",this.processVolume),this.audioSource.connect(this.processor),this.processor.connect(this.audioContext.destination)}catch(vt){Le.w(this.TAG,"Unable to initialize AudioContext",vt)}}updateAudioLevel(e){let t=Math.ceil(Math.min(400*e,100));if(t<this.audioLevel-5||t>this.audioLevel+5){this.audioLevel=t>35?t:0;let e=this.audioLevel?{track:this.track,audioLevel:this.audioLevel}:void 0;this.audioLevelEvent.publish(e)}}start(){if(!this.isInitialized())return void Le.w(this.TAG,"AudioContext not initialized");let e=-1;this.interval=window.setTimeout((()=>{this.rawLevel!==e&&(e=this.rawLevel,this.updateAudioLevel(this.rawLevel)),this.start()}),1e3)}stop(){this.isInitialized()?(this.updateAudioLevel(0),window.clearInterval(this.interval),this.interval=void 0):Le.w(this.TAG,"AudioContext not initialized")}isInitialized(){return Boolean(this.audioContext&&this.audioSource&&this.processor)}}(this,this.eventBus.trackAudioLevelUpdate),this.audioLevelMonitor.start()}destroyAudioLevelMonitor(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}cleanup(){var e=e=>super[e];return De(this,null,(function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),null==(t=this.processedTrack)||t.stop(),this.destroyAudioLevelMonitor()}))}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}buildNewSettings(e){let{volume:t,codec:i,maxBitrate:n,deviceId:r,advanced:s}=Ae(Ae({},this.settings),e);return new Ft(t,i,n,r,s)}};function gi(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise((t=>setTimeout(t,e)))}!function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(pi||(pi={}));var mi=class{constructor(){this.total=0,this.count=0}add(e){this.count++,this.total+=e}getAvg(){return Math.floor(this.total/this.count)}reset(){this.total=0,this.count=0}},yi="VideoPluginsAnalytics",Ti=320,Ei=240,Si="VideoPluginsManager",bi="HMSLocalStream",ki=class extends pt{constructor(){super(...arguments),this.connection=null}setConnection(e){this.connection=e}addTransceiver(e,t){let i=[];if(e instanceof Oi)if(t.length>0)Le.v(bi,"Simulcast enabled with layers",t),i.push(...t);else{let t={active:this.nativeStream.active};e.settings.maxBitrate&&!_t&&(t.maxBitrate=e.settings.maxBitrate),i.push(t)}let n=this.connection.addTransceiver(e.nativeTrack,{streams:[this.nativeStream],direction:"sendonly",sendEncodings:i});return this.setPreferredCodec(n,e.nativeTrack.kind),n}setMaxBitrate(e,t){return De(this,null,(function*(){var i;yield null==(i=this.connection)?void 0:i.setMaxBitrate(e,t)}))}setPreferredCodec(e,t){}replaceTrack(e,t){return De(this,null,(function*(){yield this.replaceSenderTrack(e,t),e.stop(),this.replaceStreamTrack(e,t)}))}replaceStreamTrack(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}replaceSenderTrack(e,t){return De(this,null,(function*(){var i;let n=null==(i=this.connection)?void 0:i.getSenders().find((t=>t.track&&t.track.id===e.id));void 0!==n?yield n.replaceTrack(t):Le.w(bi,`No sender found for trackId=${e.id}`)}))}removeSender(e){let t=0;this.connection.getSenders().forEach((i=>{var n,r;if((null==(n=i.track)?void 0:n.id)===e.trackId||(null==(r=i.track)?void 0:r.id)===e.getTrackIDBeingSent()){this.connection.removeTrack(i),t+=1;let n=this.tracks.indexOf(e);-1!==n?this.tracks.splice(n,1):Le.e(bi,`Cannot find ${e.trackId} in locally stored tracks`)}})),1!==t&&Le.e(bi,`Removed ${t} sender's, expected to remove 1`)}trackUpdate(e){var t;null==(t=this.connection)||t.trackUpdate(e)}},Pi=class{static connect(e,t=new Date,i=new Date,n){let r=this.eventNameFor("connect",void 0===e),s=e?ii.ERROR:ii.INFO,o=this.getPropertiesWithError({[this.KEY_REQUESTED_AT]:null==t?void 0:t.getTime(),[this.KEY_RESPONDED_AT]:null==i?void 0:i.getTime(),endpoint:n},e);return new ri({name:r,level:s,properties:o})}static disconnect(e){let t=e?ii.ERROR:ii.INFO,i=this.getPropertiesWithError({},e);return new ri({name:"disconnected",level:t,properties:i})}static join(e,t,i){let n=this.eventNameFor("join",void 0===i),r=i?ii.ERROR:ii.INFO,s=this.getPropertiesWithError({[this.KEY_REQUESTED_AT]:e.getTime(),[this.KEY_RESPONDED_AT]:t.getTime()},i);return new ri({name:n,level:r,properties:s})}static publish({devices:e,settings:t,error:i}){let n=this.eventNameFor("publish",void 0===i),r=i?ii.ERROR:ii.INFO,s=this.getPropertiesWithError({devices:e,audio:null==t?void 0:t.audio,video:null==t?void 0:t.video},i);return new ri({name:n,level:r,properties:s})}static subscribeFail(e){let t=this.eventNameFor("subscribe",!1),i=ii.ERROR,n=e.toAnalyticsProperties();return new ri({name:t,level:i,properties:n})}static leave(){return new ri({name:"leave",level:ii.INFO})}static autoplayError(){return new ri({name:"autoplayError",level:ii.ERROR})}static deviceChange({selection:e,type:t,devices:i,error:n}){let r=this.eventNameFor(n?"publish":`device.${t}`,void 0===n),s=n?ii.ERROR:ii.INFO,o=this.getPropertiesWithError({selection:e,devices:i},n);return new ri({name:r,level:s,properties:o})}static performance(e){let t=ii.INFO,i=e.toAnalyticsProperties();return new ri({name:"perf.stats",level:t,properties:i})}static rtcStats(e){let t=ii.INFO,i=e.toAnalyticsProperties();return new ri({name:"rtc.stats",level:t,properties:i})}static degradationStats(e,t){let i=ii.INFO,n={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){let t=new Date,i=t.valueOf()-e.degradedAt.valueOf();n=_e(Ae({},n),{duration:i,restoredAt:t})}return new ri({name:"video.degradation.stats",level:i,properties:n})}static eventNameFor(e,t){return`${e}.${t?"success":"failed"}`}static getPropertiesWithError(e,t){return t&&(e=Ae(Ae({},t.toAnalyticsProperties()),e)),e}};Pi.KEY_REQUESTED_AT="requested_at",Pi.KEY_RESPONDED_AT="responded_at";var Ci,wi="default",Ri="default",Ii=class{constructor(e,t,i,n){this.store=e,this.observer=t,this.deviceManager=i,this.eventBus=n,this.TAG="[LocalTrackManager]"}getTracksToPublish(e){return De(this,null,(function*(){let t=this.store.getPublishParams();if(!t)return[];let{allowed:i}=t,n=Boolean(i&&i.includes("audio")),r=Boolean(i&&i.includes("video"));if(!n&&!r)return[];let s=[],o=this.getTrackSettings(e,t);if(!o)return[];let a=this.store.getLocalPeerTracks(),l=a.find((e=>e.type===Tt.VIDEO&&"regular"===e.source)),c=a.find((e=>e.type===Tt.AUDIO&&"regular"===e.source)),d=a.find((e=>e.type===Tt.VIDEO&&"screen"===e.source)),u=Boolean(l&&this.store.getTrackById(l.trackId)),h=Boolean(c&&this.store.getTrackById(c.trackId));if(l&&o.video&&(yield l.setSettings(o.video)),c&&o.audio&&(yield c.setSettings(o.audio)),d&&o.screen&&d.setSettings(o.screen),u&&h)return[];let p={audio:n&&!c&&(!e.isAudioMuted||"empty"),video:r&&!l&&(!e.isVideoMuted||"empty")};try{Le.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:p}),s=yield this.getLocalTracks(p,o)}catch(f){s=yield this.retryGetLocalTracks(f,o,p)}return l&&r&&!u&&s.push(l),c&&n&&!h&&s.push(c),s}))}getLocalTracks(){return De(this,arguments,(function*(e={audio:!0,video:!0},t){try{let i=yield this.getNativeLocalTracks(e,t),n=i.find((e=>"video"===e.kind)),r=i.find((e=>"audio"===e.kind)),s=new ki(new MediaStream(i)),o=[];if(r&&(null==t?void 0:t.audio)){let e=new vi(s,r,"regular",this.eventBus,t.audio);o.push(e)}if(n&&(null==t?void 0:t.video)){let e=new Oi(s,n,"regular",this.eventBus,t.video);o.push(e)}return o}catch(vt){throw vt instanceof Ge&&ai.queue(Pi.publish({devices:this.deviceManager.getDevices(),error:vt,settings:t})).flush(),vt}}))}getNativeLocalTracks(){return De(this,arguments,(function*(e={audio:!1,video:!1},t){let i=new Bt(!0===e.video?t.video:null,!0===e.audio?t.audio:null,t.simulcast),n=[];return(i.audio||i.video)&&n.push(...yield this.getAVTracks(i)),"empty"===e.audio&&n.push(Ii.getEmptyAudioTrack()),"empty"===e.video&&n.push(Ii.getEmptyVideoTrack()),n}))}getLocalScreen(e,t){return De(this,null,(function*(){let i=t.toConstraints();delete i.advanced;let n,r={video:e.toConstraints(),audio:_e(Ae({},i),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})};try{n=yield navigator.mediaDevices.getDisplayMedia(r)}catch(d){throw zt(d,$t.SCREEN)}let s=[],o=new ki(n),a=n.getVideoTracks()[0],l=new Oi(o,a,"screen",this.eventBus,e);s.push(l);let c=n.getAudioTracks()[0];if(c){let e=new vi(o,c,"screen",this.eventBus,t);s.push(e)}return Le.v(this.TAG,"getLocalScreen",s),s}))}requestPermissions(){return De(this,null,(function*(){try{(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})).getTracks().forEach((e=>e.stop()))}catch(Xe){Le.e(this.TAG,Xe)}}))}static getEmptyVideoTrack(e){var t,i,n;let r=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,s=(null==(i=null==e?void 0:e.getSettings())?void 0:i.height)||240;Ci||(null==(n=(Ci=Object.assign(document.createElement("canvas"),{width:r,height:s})).getContext("2d"))||n.fillRect(0,0,r,s));let o=Ci.captureStream(10).getVideoTracks()[0],a=setInterval((()=>{if("ended"===o.readyState)return void clearInterval(a);let e=Ci.getContext("2d");if(e){let t=0===e.getImageData(0,0,1,1).data[0]?1:0;e.fillStyle=`rgb(${t}, 0, 0)`,e.fillRect(0,0,1,1)}}),100);return o.onended=()=>{clearInterval(a)},o.enabled=!1,o}static getEmptyAudioTrack(){let e=new AudioContext,t=e.createOscillator(),i=t.connect(e.createMediaStreamDestination());t.start();let n=i.stream.getAudioTracks()[0];return n.enabled=!1,n}getAVTracks(e){return De(this,null,(function*(){try{let t=yield navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});return t.getVideoTracks().concat(t.getAudioTracks())}catch(Me){let i=!1,n=!1;throw yield this.deviceManager.init(),!this.deviceManager.hasWebcamPermission&&e.video&&(i=!0),!this.deviceManager.hasMicrophonePermission&&e.audio&&(n=!0),zt(Me,i&&n?$t.AV:i?$t.VIDEO:$t.AUDIO)}}))}getTrackSettings(e,t){let{audio:i,video:n,screen:r,allowed:s}=t,o=Boolean(s&&s.includes("audio")),a=Boolean(s&&s.includes("video")),l=Boolean(s&&s.includes("screen"));if(!o&&!a)return null;let c=this.store.getLocalPeer(),d=null==c?void 0:c.videoTrack,u=null==c?void 0:c.audioTrack,h=(null==u?void 0:u.settings.deviceId)||e.audioInputDeviceId,p=(null==d?void 0:d.settings.deviceId)||e.videoDeviceId,f=null,v=null,g=null;if(o&&(f=(new Ut).codec(i.codec).maxBitrate(i.bitRate).deviceId(h||wi).build()),a){let e=this.store.getSimulcastDimensions("regular");v=(new Gt).codec(n.codec).maxBitrate(n.bitRate).maxFramerate(n.frameRate).setWidth((null==e?void 0:e.width)||n.width).setHeight((null==e?void 0:e.height)||n.height).deviceId(p||Ri).build()}if(l){let e=this.store.getSimulcastDimensions("screen");g=(new Gt).maxBitrate(r.bitRate,!1).codec(r.codec).maxFramerate(r.frameRate).setWidth((null==e?void 0:e.width)||r.width).setHeight((null==e?void 0:e.height)||r.height).build()}return(new Vt).video(v).audio(f).screen(g).build()}retryGetLocalTracks(e,t,i){return De(this,null,(function*(){if(!(e instanceof Ge&&e.action===xe.TRACK))return Le.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(je.TracksErrors.GenericTrack(xe.TRACK,e.message)),[];{this.observer.onFailure(e);let n=e.code===Fe.TracksErrors.OVER_CONSTRAINED,r=e.message.includes("audio"),s=e.message.includes("video");if(n){let n=(new Vt).video(new jt).audio(new Ft).build();Le.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:i},{error:e});try{return yield this.getLocalTracks(i,n)}catch(Te){let n=Te instanceof Ge?Te.nativeError:Te,r=Te;if("OverconstrainedError"===(null==n?void 0:n.name)){let e=je.TracksErrors.GenericTrack(xe.TRACK,"Overconstrained error after dropping all constraints");e.addNativeError(n),r=e}return yield this.retryGetLocalTracks(r,t,i)}}i.audio=r?"empty":i.audio,i.video=s?"empty":i.video,Le.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:i},e);try{return yield this.getLocalTracks(i,t)}catch(Ye){return Le.w(this.TAG,"Fetch empty tacks failed",Ye),i.audio=i.audio&&"empty",i.video=i.video&&"empty",this.observer.onFailure(je.TracksErrors.GenericTrack(xe.TRACK,Ye.message)),yield this.getLocalTracks(i,t)}}}))}};function Ai(e,t){return function(i){return i in e&&e[i]!==t[i]}}var _i,Di,Oi=class extends Ct{constructor(e,t,i,n,r=(new Gt).build()){super(e,t,i),this.eventBus=n,this.buildNewSettings=e=>{let{width:t,height:i,codec:n,maxFramerate:r,maxBitrate:s,deviceId:o,advanced:a}=Ae(Ae({},this.settings),e);return new jt(t,i,n,r,o,a,s)},this.handleSettingsChange=e=>De(this,null,(function*(){let t=this.stream,i=Ai(e,this.settings);i("maxBitrate")&&e.maxBitrate&&(yield t.setMaxBitrate(e.maxBitrate,this)),(i("width")||i("height")||i("advanced"))&&(yield this.nativeTrack.applyConstraints(e.toConstraints()))})),this.handleDeviceChange=(e,t=!1)=>De(this,null,(function*(){if(Ai(e,this.settings)("deviceId")&&"regular"===this.source){if(this.enabled){let t=yield this.replaceTrackWith(e);yield this.replaceSender(t,this.enabled),this.nativeTrack=t}t||ui.updateSelection("videoInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId})}})),e.tracks.push(this),this.settings=r,"default"===r.deviceId&&t.enabled&&(this.settings=this.buildNewSettings({deviceId:t.getSettings().deviceId})),this.pluginsManager=new class{constructor(e){this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=e,this.plugins=[],this.pluginsMap={},this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new class{constructor(){this.initTime={},this.preProcessingAvgs=new mi,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}added(e,t,i){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new mi,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=i||t}removed(e){var t;if(this.pluginAdded[e]){let i={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};ai.queue(si.stats(i)).flush(),this.clean(e)}}failure(e,t){this.pluginAdded[e]&&(ai.queue(si.failure(e,t)).flush(),this.clean(e))}initWithTime(e,t){return De(this,null,(function*(){if(this.initTime[e])return void Le.i(yi,`Plugin Already loaded ${e}, time it took: ${this.initTime[e]}`);let i;try{i=yield this.timeInMs(t),Le.i(yi,`Time taken for Plugin ${e} initialization : ${i}`)}catch(n){let i=je.MediaPluginErrors.InitFailed(xe.VIDEO_PLUGINS,`failed during initialization of plugin${n.message||n}`);throw Le.e(yi,i),this.failure(e,i),i}i&&(this.initTime[e]=i)}))}preProcessWithTime(e){return De(this,null,(function*(){let t=yield this.timeInMs(e);this.preProcessingAvgs.add(t)}))}processWithTime(e,t){return De(this,null,(function*(){var i;let n;try{n=yield this.timeInMs(t)}catch(r){let i=je.MediaPluginErrors.ProcessingFailed(xe.VIDEO_PLUGINS,`Failed during processing of plugin${r.message||r}`);throw Le.e(yi,i),this.failure(e,i),i}n&&(null==(i=this.processingAvgs[e])||i.add(n))}))}timeInMs(e){return De(this,null,(function*(){let t=Date.now();return yield e(),Math.floor(Date.now()-t)}))}clean(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}},this.canvases=new Array}getPlugins(){return[...this.plugins]}addPlugin(e,t){return De(this,null,(function*(){var i;if(this.pluginAddInProgress){let t=null==(i=e.getName)?void 0:i.call(e);if(!t||""===t)return void Le.w("no name provided by the plugin");let n=je.MediaPluginErrors.AddAlreadyInProgress(xe.VIDEO_PLUGINS,"Add Plugin is already in Progress");throw this.analytics.failure(t,n),Le.w("can't add another plugin when previous add is in progress"),n}this.pluginAddInProgress=!0;try{yield this.addPluginInternal(e,t)}finally{this.pluginAddInProgress=!1}}))}addPluginInternal(e,t){return De(this,null,(function*(){var i;let n=null==(i=e.getName)?void 0:i.call(e);if(!n||""===n)return void Le.w("no name provided by the plugin");if(this.pluginsMap[n])return void Le.w(Si,`plugin - ${e.getName()} already added.`);let r=this.hmsTrack.getMediaTrackSettings().frameRate||24,s=0;if(t&&t>0?(Le.i(Si,`adding plugin ${e.getName()} with framerate ${t}`),t<r&&(s=Math.ceil(r/t)-1),this.analytics.added(n,r,t)):(Le.i(Si,`adding plugin ${e.getName()}`),this.analytics.added(n,r)),Le.i(Si,"numFrames to skip processing",s),this.pluginNumFramesToSkip[n]=s,this.pluginNumFramesSkipped[n]=s,!e.isSupported()){let t=je.MediaPluginErrors.PlatformNotSupported(xe.VIDEO_PLUGINS,"platform not supported ");return this.analytics.failure(n,t),void Le.i(Si,`Platform is not supported for plugin - ${e.getName()}`)}try{if(yield this.analytics.initWithTime(n,(()=>De(this,null,(function*(){return yield e.init()})))),this.plugins.push(n),this.pluginsMap[n]=e,this.plugins.length+1>this.canvases.length)for(let e=this.canvases.length;e<=this.plugins.length;e++)this.canvases[e]=document.createElement("canvas");yield this.startPluginsLoop()}catch(Ye){throw Le.e(Si,"failed to add plugin",Ye),yield this.removePlugin(e),Ye}}))}removePlugin(e){return De(this,null,(function*(){let t=e.getName();this.pluginsMap[t]?(Le.i(Si,`removing plugin ${t}`),this.removePluginEntry(t),0===this.plugins.length&&(Le.i(Si,"No plugins left, stopping plugins loop"),yield this.stopPluginsLoop()),e.stop(),this.analytics.removed(t)):Le.w(Si,`plugin - ${t} not found to remove.`)}))}removePluginEntry(e){let t=this.plugins.indexOf(e);-1!==t&&this.plugins.splice(t,1),this.pluginsMap[e]&&delete this.pluginsMap[e],this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}waitForRestart(){return De(this,null,(function*(){if(this.pluginsLoopRunning&&"running"!==this.pluginsLoopState)for(;"paused"===this.pluginsLoopState;)yield gi(100)}))}cleanup(){return De(this,null,(function*(){var e;for(let t of this.plugins)yield this.removePlugin(this.pluginsMap[t]);null==(e=this.outputTrack)||e.stop()}))}initElementsAndStream(){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext("2d");let e=this.outputCanvas.captureStream();this.outputTrack=e.getVideoTracks()[0]}startPluginsLoop(){return De(this,null,(function*(){if(!this.pluginsLoopRunning){this.initElementsAndStream(),this.pluginsLoopRunning=!0;try{yield this.hmsTrack.setProcessedTrack(this.outputTrack)}catch(e){throw this.pluginsLoopRunning=!1,Le.e(Si,"error in setting processed track",e),e}this.pluginsLoop().then((()=>{Le.d(Si,"processLoop stopped")}))}}))}stopPluginsLoop(){return De(this,null,(function*(){var e;this.pluginsLoopRunning=!1,yield this.hmsTrack.setProcessedTrack(void 0),this.resetCanvases(),null==(e=this.outputTrack)||e.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0)}))}pluginsLoop(){return De(this,null,(function*(){for(;this.pluginsLoopRunning;){let e=this.hmsTrack.getMediaTrackSettings().frameRate||24,t=Math.floor(1e3/e);if(!this.hmsTrack.enabled||"ended"===this.hmsTrack.nativeTrack.readyState){"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",yield gi(t);continue}let i=0;try{yield this.analytics.preProcessWithTime((()=>De(this,null,(function*(){return yield this.doPreProcessing()}))));let e=Date.now();yield this.processFramesThroughPlugins(),i=Math.floor(Date.now()-e),i>t&&(i=t)}catch(n){Le.e(Si,"error in plugins loop",n)}this.pluginsLoopState="running",yield gi(t-i)}}))}doPreProcessing(){return De(this,null,(function*(){yield this.addTrackToVideo(),yield this.updateInputCanvas()}))}processFramesThroughPlugins(){return De(this,null,(function*(){this.canvases[0]=this.inputCanvas;for(let e=0;e<this.plugins.length;e++){let t=this.plugins[e],i=this.pluginsMap[t];if(i)try{let n=this.checkIfSkipRequired(t);if(i.getPluginType()===pi.TRANSFORM){let r=(e,r)=>De(this,null,(function*(){try{yield i.processVideoFrame(e,r,n)}catch(Te){Le.e(Si,`error in processing plugin ${t}`,Te)}}));n?e==this.plugins.length-1?yield r(this.canvases[e],this.outputCanvas):yield r(this.canvases[e],this.canvases[e+1]):e==this.plugins.length-1?yield this.analytics.processWithTime(t,(()=>De(this,null,(function*(){return r(this.canvases[e],this.outputCanvas)})))):yield this.analytics.processWithTime(t,(()=>De(this,null,(function*(){return r(this.canvases[e],this.canvases[e+1])}))))}else i.getPluginType()===pi.ANALYZE&&!n&&(yield this.analytics.processWithTime(t,(()=>De(this,null,(function*(){return yield i.processVideoFrame(this.inputCanvas)})))))}catch(n){Le.e(Si,`error in processing plugin ${t}`,n),yield this.removePlugin(i)}}}))}addTrackToVideo(){return De(this,null,(function*(){var e;if(!this.inputVideo)return;let t=this.inputVideo.srcObject;null!==t&&t instanceof MediaStream&&(null==(e=t.getVideoTracks()[0])?void 0:e.id)===this.hmsTrack.nativeTrack.id||(this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,this.inputVideo&&(this.inputVideo.oncanplaythrough=()=>{var e;null==(e=this.inputVideo)||e.play()}))}))}updateInputCanvas(){return De(this,null,(function*(){if(!this.inputCanvas||!this.inputVideo)return;let{width:e=Ti,height:t=Ei}=this.hmsTrack.getMediaTrackSettings();this.inputCanvas.height!==t&&(this.inputCanvas.height=t),this.inputCanvas.width!==e&&(this.inputCanvas.width=e),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,e,t)}))}resetCanvases(){if(!this.outputCanvas||!this.inputCanvas)return;let e=this.outputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height));let t=this.inputCanvas.getContext("2d");t&&(t.fillStyle="rgb(0, 0, 0)",t.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}checkIfSkipRequired(e){let t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}}(this),this.publishedTrackId=this.trackId,this.setFirstTrackId(this.trackId)}setEnabled(e){var t=e=>super[e];return De(this,null,(function*(){if(e!==this.enabled){if("regular"===this.source){let t;t=e?yield this.replaceTrackWith(this.settings):yield this.replaceTrackWithBlank(),yield this.replaceSender(t,e),this.nativeTrack=t,e&&(yield this.pluginsManager.waitForRestart())}yield t("setEnabled").call(this,e),this.eventBus.localVideoEnabled.publish(e),this.stream.trackUpdate(this)}}))}addSink(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}setSettings(e,t=!1){return De(this,null,(function*(){let i=this.buildNewSettings(e);yield this.handleDeviceChange(i,t),this.enabled?(yield this.handleSettingsChange(i),this.settings=i):this.settings=i}))}getPlugins(){return this.pluginsManager.getPlugins()}addPlugin(e,t){return De(this,null,(function*(){return this.pluginsManager.addPlugin(e,t)}))}removePlugin(e){return De(this,null,(function*(){return this.pluginsManager.removePlugin(e)}))}cleanup(){var e=e=>super[e];return De(this,null,(function*(){var t;e("cleanup").call(this),yield this.pluginsManager.cleanup(),null==(t=this.processedTrack)||t.stop()}))}setProcessedTrack(e){return De(this,null,(function*(){if(this.nativeTrack.enabled)return e?void(e!==this.processedTrack&&(this.processedTrack?yield this.stream.replaceSenderTrack(this.processedTrack,e):yield this.stream.replaceSenderTrack(this.nativeTrack,e),this.processedTrack=e)):(this.processedTrack&&(yield this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack)),void(this.processedTrack=void 0));this.processedTrack=e}))}getTrackIDBeingSent(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}getTrackBeingSent(){return this.processedTrack||this.nativeTrack}replaceTrackWith(e){return De(this,null,(function*(){let t=this.nativeTrack;null==t||t.stop();let i=yield Qt(e);return"default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),i}))}replaceTrackWithBlank(){return De(this,null,(function*(){let e=this.nativeTrack;return null==e||e.stop(),Ii.getEmptyVideoTrack(e)}))}replaceSender(e,t){return De(this,null,(function*(){let i=this.stream;t?yield i.replaceSenderTrack(this.nativeTrack,this.processedTrack||e):yield i.replaceSenderTrack(this.processedTrack||this.nativeTrack,e),yield i.replaceStreamTrack(this.nativeTrack,e)}))}},Mi=class{constructor(e){this.type=e.type,this.source=e.source||"regular",this.description="",e instanceof St?(this.mute=!e.enabled,this.track_id=e.publishedTrackId,this.stream_id=e.stream.id):(this.mute=e.mute,this.track_id=e.track_id,this.stream_id=e.stream_id)}};(Di=_i||(_i={}))[Di.Disconnected=0]="Disconnected",Di[Di.Connecting=1]="Connecting",Di[Di.Joined=2]="Joined",Di[Di.Failed=3]="Failed",Di[Di.Reconnecting=4]="Reconnecting",Di[Di.Leaving=5]="Leaving";var Ni;!function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.PublishIceConnectionFailed=2]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=3]="SubscribeIceConnectionFailed"}(Ni||(Ni={}));var Li={0:[],1:[],2:[1],3:[1]},xi="[RetryScheduler]",Ui=(e,t,i,n)=>De(void 0,null,(function*(){var r;let s=t instanceof vi||t instanceof Oi,o=s?"publish":"subscribe",a=s?t.getTrackBeingSent():t.nativeTrack,l=yield null==(r=e[o])?void 0:r.call(e,a),c=Fi(l),d=Vi("publish"===o?"bytesSent":"bytesReceived",c,n),u=Bi("packetsLost",c,n);return(null==c?void 0:c.remote)&&Object.assign(c.remote,{packetsLostRate:Bi("packetsLost",c.remote,null==n?void 0:n.remote)}),c&&Object.assign(c,{bitrate:d,packetsLostRate:u,peerId:t.peerId,peerName:i})})),Fi=e=>{let t,i;return null==e||e.forEach((e=>{switch(e.type){case"inbound-rtp":case"outbound-rtp":t=e;break;case"remote-inbound-rtp":i=e}})),t&&Object.assign(t,{remote:i})},Gi=(e,t,i)=>{let n=ji(t),r=Vi("publish"===e?"bytesSent":"bytesReceived",n,i&&i[e]);return n&&Object.assign(n,{bitrate:r})},ji=e=>{let t;return e.forEach((i=>{"transport"===i.type&&(t=e.get(i.selectedCandidatePairId))})),t||e.forEach((e=>{"candidate-pair"===e.type&&e.selected&&(t=e)})),t},Vi=(e,t,i)=>8*Bi(e,t,i),Bi=(e,t,i)=>{let n=t&&t[e],r=i?i[e]:null;return t&&i&&Be(n)&&Be(r)?1e3*Ki(n,r,t.timestamp,i.timestamp):0},Ki=(e,t,i,n)=>Be(e)&&Be(t)&&i&&n?(e-t)/(i-n):0,Hi="[HMSTransport]:";function Wi(e){if(0===e.length)throw je.InitAPIErrors.InvalidTokenFormat(xe.INIT,"Token cannot be an empty string");let t=e.split(".");if(3!==t.length)throw je.InitAPIErrors.InvalidTokenFormat(xe.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");let i=atob(t[1]);try{let e=JSON.parse(i);return{roomId:e.room_id,userId:e.user_id,role:e.role}}catch(vt){throw je.InitAPIErrors.InvalidTokenFormat(xe.INIT,`couldn't parse to json - ${vt.message}`)}}var $i="autoplay-error",qi={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Ji=class extends Se.EventEmitter2{on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}emit(e,t){return super.emit(e,t)}listeners(e){return super.listeners(e)}},zi=class{constructor(e){this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.audioContext.destination)}resumeContext(){"suspended"===this.audioContext.state&&(Le.d(this.TAG,"AudioContext is resumed"),this.audioContext.resume())}getAudioTrack(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}cleanup(){"closed"!==this.audioContext.state&&this.audioContext.close()}get TAG(){return"AudioContextManager"}},Yi=class extends Ji{constructor(){super(),this.seeked=!1,this.audioElement=this.getAudioElement()}play(e){return De(this,null,(function*(){return new Promise(((t,i)=>{this.audioElement=this.getAudioElement(),this.audioElement.src=e,this.seeked=!1,this.audioElement.onerror=()=>{let t=`Error loading ${e}`;Le.e(this.TAG,t),this.stop(),i(t)},this.audioElement.oncanplaythrough=()=>De(this,null,(function*(){try{if(!this.audioElement)return;if(this.audioContextManager.resumeContext(),this.track)this.seeked?this.seeked=!1:(yield this.audioElement.play(),t([this.track]));else{yield this.audioElement.play();let e=this.audioContextManager.getAudioTrack();this.track=e,t([e])}}catch(ge){Le.e(this.TAG,"Error playing audio",e,ge.message),i(ge)}})),this.audioElement.onseeked=()=>{this.seeked=!0}}))}))}getTracks(){return this.track?[this.track.id]:[]}getElement(){return this.audioElement}stop(){var e,t;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,this.audioContextManager.cleanup(),this.track=void 0}getAudioElement(){if(this.audioElement)return this.audioElement;let e=document.createElement("audio");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",(e=>this.emit("progress",e))),e.addEventListener("ended",(()=>{this.emit("ended",null)})),this.audioContextManager=new zi(e),e}get TAG(){return"PlaylistAudioManager"}},Qi=class extends Ji{constructor(){super(),this.tracks=[],this.DEFAUL_FPS=24,this.seeked=!1,this.drawImage=()=>{var e,t,i;this.videoElement&&!this.videoElement.paused&&!this.videoElement.ended&&(null==(i=this.canvasContext)||i.drawImage(this.videoElement,0,0,null==(e=this.canvas)?void 0:e.width,null==(t=this.canvas)?void 0:t.height),this.timer=setTimeout((()=>{this.drawImage()}),1e3/this.DEFAUL_FPS))},this.videoElement=this.getVideoElement(),this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d")}play(e){return new Promise(((t,i)=>{this.videoElement=this.getVideoElement(),this.videoElement.src=e,this.seeked=!1,this.videoElement.onerror=()=>{let t=`Error loading ${e}`;Le.e(this.TAG,t),this.stop(),i(t)},this.videoElement.oncanplaythrough=()=>De(this,null,(function*(){var n,r,s;try{if(!this.videoElement)return;if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0===this.tracks.length){this.clearCanvasAndTracks();let e=this.canvas.captureStream();if(!e)return void Le.e(this.TAG,"Browser does not support captureStream");this.videoElement.onplay=this.drawImage,this.audioContextManager.resumeContext(),yield this.videoElement.play();let i=this.audioContextManager.getAudioTrack();e.addTrack(i),e.getTracks().forEach((e=>{this.tracks.push(e)})),t(this.tracks)}else this.seeked?(this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(n=this.canvas)?void 0:n.width,null==(r=this.canvas)?void 0:r.height)):(yield this.videoElement.play(),t(this.tracks))}catch(Ye){Le.e(this.TAG,"Error playing video",e,Ye.message),i(Ye)}})),this.videoElement.onseeked=()=>{this.seeked=!0}}))}getTracks(){return this.tracks.map((e=>e.id))}getElement(){return this.videoElement}stop(){var e,t;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,this.clearCanvasAndTracks()}clearCanvasAndTracks(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}getVideoElement(){if(this.videoElement)return this.videoElement;let e=document.createElement("video");return e.crossOrigin="anonymous",e.addEventListener("timeupdate",(e=>this.emit("progress",e))),e.addEventListener("ended",(()=>{this.emit("ended",null)})),this.audioContextManager=new zi(e),e}get TAG(){return"PlaylistVideoManager"}},Xi={list:[],currentIndex:-1,isAutoplayOn:!0},Zi={list:[],currentIndex:-1,isAutoplayOn:!0},en=class extends Ji{constructor(e){super(),this.sdk=e,this.state={audio:Ae({},Xi),video:Ae({},Zi)},this.addTrack=(e,t)=>De(this,null,(function*(){yield this.sdk.addTrack(e,t),Le.d(this.TAG,"Playlist track added",e)})),this.removeTrack=e=>De(this,null,(function*(){yield this.sdk.removeTrack(e),Le.d(this.TAG,"Playlist track removed",e)})),this.audioManager=new Yi,this.videoManager=new Qi,this.addListeners()}getList(e=mt.audio){return this.state[e].list}setList(e){e&&0!==e.length?e.forEach((e=>{this.state[e.type].list.push(e)})):Le.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}removeItem(e){let t=this.state[e.type].list,i=t.findIndex((t=>e.id===t.id));i>-1&&t.splice(i,1)}seek(e,t=mt.audio){let{currentIndex:i}=this.state[t];if(-1===i)throw je.PlaylistErrors.NoEntryToPlay(xe.PLAYLIST,"No item is currently playing");let n=this.getElement(t);if(n){let t=Math.max(n.currentTime+e,0);n.currentTime=Math.min(t,n.duration)}}seekTo(e,t=mt.audio){let{currentIndex:i}=this.state[t];if(-1===i)throw je.PlaylistErrors.NoEntryToPlay(xe.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");let n=this.getElement(t);n&&(n.currentTime=Math.min(e,n.duration))}setVolume(e,t=mt.audio){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");let i=this.getElement(t);i&&(i.volume=.01*e)}getVolume(e=mt.audio){let t=this.getElement(e);return t?100*t.volume:0}getCurrentTime(e=mt.audio){let t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}getCurrentIndex(e=mt.audio){return this.state[e].currentIndex}getCurrentProgress(e=mt.audio){var t;let{list:i,currentIndex:n}=this.state[e],r=null==(t=i[n])?void 0:t.url,s=this.getElement(e);return r&&s?Math.floor(s.currentTime/s.duration*100):0}getCurrentSelection(e=mt.audio){let{list:t,currentIndex:i}=this.state[e];if(-1!==i)return t[i]}isPlaying(e=mt.audio){let t=this.getElement(e);return!!t&&!t.paused}setIsAutoplayOn(e=mt.audio,t){this.state[e].isAutoplayOn=t}getPlaybackRate(e=mt.audio){let t=this.getElement(e);return t?t.playbackRate:1}setPlaybackRate(e=mt.audio,t){if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");let i=this.getElement(e);i&&(i.playbackRate=t)}setEnabled(e,t){return De(this,arguments,(function*(e,{id:t,type:i=mt.audio}){let n=this.state[i].list.findIndex((e=>e.id===t));if(!t||-1===n)return void Le.w(this.TAG,"Pass a valid id");let r=this.state[i].list[n].url;e?yield this.play(r,i):yield this.pause(r,i),this.state[i].currentIndex=n,this.setDuration(i)}))}playNext(){return De(this,arguments,(function*(e=mt.audio){let{list:t,currentIndex:i}=this.state[e];if(i>=t.length-1)throw je.PlaylistErrors.NoEntryToPlay(xe.PLAYLIST,"Reached end of playlist");yield this.play(t[i+1].url,e),this.state[e].currentIndex=i+1,this.setDuration(e)}))}playPrevious(){return De(this,arguments,(function*(e=mt.audio){let{list:t,currentIndex:i}=this.state[e];if(i<=0)throw je.PlaylistErrors.NoEntryToPlay(xe.PLAYLIST,"Reached start of playlist");yield this.play(t[i-1].url,e),this.state[e].currentIndex=i-1,this.setDuration(e)}))}stop(){return De(this,arguments,(function*(e=mt.audio){var t;let i=e===mt.audio?this.audioManager:this.videoManager;null==(t=i.getElement())||t.pause(),yield this.removeTracks(e),i.stop(),this.state[e].currentIndex=-1}))}cleanup(){this.state={audio:Ae({},Xi),video:Ae({},Zi)},this.audioManager.stop(),this.videoManager.stop()}onProgress(e){this.videoManager.on("progress",(()=>{try{e({type:mt.video,progress:this.getCurrentProgress(mt.video)})}catch(Me){Le.e(this.TAG,"Error in onProgress callback")}})),this.audioManager.on("progress",(()=>{try{e({type:mt.audio,progress:this.getCurrentProgress(mt.audio)})}catch(Me){Le.e(this.TAG,"Error in onProgress callback")}}))}onNewTrackStart(e){this.on("newTrackStart",e)}onPlaylistEnded(e){this.on("playlistEnded",e)}onCurrentTrackEnded(e){this.on("currentTrackEnded",e)}getElement(e=mt.audio){return e===mt.audio?this.audioManager.getElement():this.videoManager.getElement()}removeTracks(){return De(this,arguments,(function*(e=mt.audio){let t=(e===mt.audio?this.audioManager:this.videoManager).getTracks();for(let i of t)yield this.removeTrack(i)}))}play(e){return De(this,arguments,(function*(e,t=mt.audio){let i=t===mt.audio?this.audioManager:this.videoManager,n=i.getElement();if(this.isItemCurrentlyPlaying(e,t))Le.w(this.TAG,`The ${t} is currently playing`);else if(null==n?void 0:n.src.includes(e))yield n.play();else{null==n||n.pause();let r=yield i.play(e);for(let e of r)yield this.addTrack(e,t===mt.audio?"audioplaylist":"videoplaylist")}}))}isItemCurrentlyPlaying(e,t){let i=this.getElement(t);return!(!i||i.paused||!i.src.includes(e))}setDuration(e=mt.audio){let t=this.getElement(e),{list:i,currentIndex:n}=this.state[e];i[n]&&(i[n].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",i[n])}pause(e){return De(this,arguments,(function*(e,t=mt.audio){let i=this.getElement(t);i&&!i.paused&&i.src.includes(e)?(i.pause(),Le.d(this.TAG,"paused url",e)):Le.w(this.TAG,"The passed in url is not currently playing")}))}addListeners(){this.audioManager.on("ended",(()=>this.handleEnded(mt.audio))),this.videoManager.on("ended",(()=>this.handleEnded(mt.video)))}handleEnded(){return De(this,arguments,(function*(e=mt.audio){let{list:t,currentIndex:i,isAutoplayOn:n}=this.state[e];i===t.length-1?(yield this.stop(e),this.emit("playlistEnded",e)):n?this.playNext(e):yield this.pause(t[i].url,e),this.emit("currentTrackEnded",t[i])}))}get TAG(){return"PlaylistManager"}},tn=class{constructor(e,t){this.eventName=e,this.eventEmitter=t,this.publish=e=>{this.eventEmitter.emit(this.eventName,e)},this.subscribe=e=>{this.eventEmitter.on(this.eventName,e)},this.subscribeOnce=e=>{this.eventEmitter.once(this.eventName,e)},this.unsubscribe=e=>{this.eventEmitter.off(this.eventName,e)},this.removeAllListeners=()=>{this.eventEmitter.removeAllListeners(this.eventName)}}},nn={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},rn={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,deviceManagersInitialised:!1},sn=class{constructor(){this.TAG="[HMSSdk]:",this.transportState=_i.Disconnected,this.sdkState=Ae({},rn),this.handleAutoplayError=e=>{var t,i;null==(i=null==(t=this.errorListener)?void 0:t.onError)||i.call(t,e.error)},this.observer={onNotification:e=>{e.method!==xt.PEER_LEAVE_REQUEST?this.notificationManager.handleNotification(e,this.sdkState.isReconnecting):this.handlePeerLeaveRequest(e.params)},onTrackAdd:e=>{this.notificationManager.handleTrackAdd(e)},onTrackRemove:e=>{this.notificationManager.handleTrackRemove(e)},onTrackDegrade:e=>{var t,i;Le.d(this.TAG,"Sending Track Update Track Degraded",e),null==(i=this.listener)||i.onTrackUpdate(ze.TRACK_DEGRADED,e,null==(t=this.store)?void 0:t.getPeerByTrackId(e.trackId))},onTrackRestore:e=>{var t,i;Le.d(this.TAG,"Sending Track Update Track Restored",e),null==(i=this.listener)||i.onTrackUpdate(ze.TRACK_RESTORED,e,null==(t=this.store)?void 0:t.getPeerByTrackId(e.trackId))},onFailure:e=>{var t;null==(t=this.errorListener)||t.onError(e)},onStateChange:(e,t)=>De(this,null,(function*(){var i,n,r,s;switch(e){case _i.Joined:this.transportState===_i.Reconnecting&&(null==(i=this.listener)||i.onReconnected());break;case _i.Failed:yield this.leave(),null==(r=null==(n=this.errorListener)?void 0:n.onError)||r.call(n,t),this.sdkState.isReconnecting=!1;break;case _i.Reconnecting:this.sdkState.isReconnecting=!0,null==(s=this.listener)||s.onReconnecting(t)}this.transportState=e}))},this.handlePeerLeaveRequest=e=>{var t;let i=this.store.getPeerById(e.requested_by),n={roomEnded:e.room_end,reason:e.reason,requestedBy:i};null==(t=this.listener)||t.onRemovedFromRoom(n),this.leave()},this.handleDeviceChange=e=>{var t,i,n,r,s,o;if(Le.d(this.TAG,"Device Change event",e),null==(i=null==(t=this.deviceChangeListener)?void 0:t.onDeviceChange)||i.call(t,e),e.error&&e.type){let t=e.type.includes("audio")?null==(n=this.localPeer)?void 0:n.audioTrack:null==(r=this.localPeer)?void 0:r.videoTrack;null==(s=this.errorListener)||s.onError(e.error),[Fe.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,Fe.TracksErrors.DEVICE_IN_USE,Fe.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&t&&(t.setEnabled(!1),null==(o=this.listener)||o.onTrackUpdate(ze.TRACK_MUTED,t,this.localPeer))}}}initStoreAndManagers(){if(this.sdkState.isInitialised)return this.notificationManager.setListener(this.listener),void this.audioSinkManager.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new class{constructor(){this.comparator=new class{constructor(e){this.store=e,this.primitiveComparator=(e,t)=>e===t?0:Number(e)-Number(t),this.stringComparator=(e,t)=>e===t?0:e<t?-1:1}getPeerComparators(){return{videoEnabled:(e,t)=>{var i,n;return this.primitiveComparator(Boolean(null==(i=e.videoTrack)?void 0:i.enabled),Boolean(null==(n=t.videoTrack)?void 0:n.enabled))},audioEnabled:(e,t)=>{var i,n;return this.primitiveComparator(Boolean(null==(i=e.audioTrack)?void 0:i.enabled),Boolean(null==(n=t.audioTrack)?void 0:n.enabled))},screenShare:(e,t)=>this.primitiveComparator(e.auxiliaryTracks.some((e=>"screen"===e.source)),t.auxiliaryTracks.some((e=>"screen"===e.source))),audioLevel:(e,t)=>{var i,n;return this.primitiveComparator((null==(i=this.store.getSpeakers().find((t=>t.peer&&t.peer.peerId===(null==e?void 0:e.peerId))))?void 0:i.audioLevel)||-1,(null==(n=this.store.getSpeakers().find((e=>e.peer&&e.peer.peerId===(null==t?void 0:t.peerId))))?void 0:n.audioLevel)||-1)},rolePriority:(e,t)=>{var i,n;return this.primitiveComparator((null==(i=e.role)?void 0:i.priority)||0,(null==(n=t.role)?void 0:n.priority)||0)}}}getTrackComparators(){return{video:(e,t)=>this.primitiveComparator(e.type===Tt.VIDEO,t.type===Tt.VIDEO),audio:(e,t)=>this.primitiveComparator(e.type===Tt.AUDIO,t.type===Tt.AUDIO),enabled:(e,t)=>this.primitiveComparator(Boolean(e.enabled),Boolean(t.enabled)),peerAudioLevel:(e,t)=>{let i=this.store.getPeerByTrackId(e.trackId),n=this.store.getPeerByTrackId(t.trackId);return this.getPeerComparators().audioLevel(i,n)},audioLevel:(e,t)=>{var i,n;return this.primitiveComparator((null==(i=this.store.getSpeakers().find((t=>t.track.trackId===e.trackId)))?void 0:i.audioLevel)||0,(null==(n=this.store.getSpeakers().find((e=>e.track.trackId===t.trackId)))?void 0:n.audioLevel)||0)},screenShare:(e,t)=>this.primitiveComparator("screen"===e.source,"screen"===t.source),rolePriority:(e,t)=>{var i,n,r,s;return this.primitiveComparator((null==(n=null==(i=this.store.getPeerByTrackId(e.trackId))?void 0:i.role)?void 0:n.priority)||0,(null==(s=null==(r=this.store.getPeerByTrackId(t.trackId))?void 0:r.role)?void 0:s.priority)||0)}}}}(this),this.knownRoles={},this.peers={},this.tracks={},this.peerTrackStates={},this.speakers=[],this.videoLayers=null,this.screenshareLayers=null}getConfig(){return this.config}getPublishParams(){return this.publishParams}getComparator(){return this.comparator}getRoom(){return this.room}getPolicyForRole(e){return this.knownRoles[e]}getKnownRoles(){return this.knownRoles}getLocalPeer(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}getRemotePeers(){return Object.values(this.peers).filter((e=>!e.isLocal))}getPeers(){return Object.values(this.peers)}getPeerById(e){if(this.peers[e])return this.peers[e]}getTracksMap(){return this.tracks}getTracks(){return Object.values(this.tracks)}getVideoTracks(){return this.getTracks().filter((e=>e.type===Tt.VIDEO))}getRemoteVideoTracks(){return this.getTracks().filter((e=>e instanceof wt))}getAudioTracks(){return this.getTracks().filter((e=>e.type===Tt.AUDIO))}getPeerTracks(e){let t=e?this.peers[e]:void 0,i=[];return(null==t?void 0:t.videoTrack)&&i.push(t.videoTrack),(null==t?void 0:t.audioTrack)&&i.push(t.audioTrack),i.concat((null==t?void 0:t.auxiliaryTracks)||[])}getLocalPeerTracks(){return this.getPeerTracks(this.localPeerId)}getTrackById(e){return this.tracks[e]}getPeerByTrackId(e){let t=this.tracks[e];return t.peerId?this.peers[t.peerId]:void 0}getSpeakers(){return this.speakers}getSpeakerPeers(){return this.speakers.map((e=>e.peer))}setRoom(e){this.room=e}setKnownRoles(e){this.knownRoles=e,this.updatePeersPolicy()}setConfig(e){var t,i,n;if(ui.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){let r=ui.getSelection();r&&(e.settings||(e.settings={}),(null==(t=r.audioInput)?void 0:t.deviceId)&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||r.audioInput.deviceId),(null==(i=r.audioOutput)?void 0:i.deviceId)&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||r.audioOutput.deviceId),(null==(n=r.videoInput)?void 0:n.deviceId)&&(e.settings.videoDeviceId=e.settings.videoDeviceId||r.videoInput.deviceId))}this.config=e}setPublishParams(e){this.publishParams=e}addPeer(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}addTrack(e){this.tracks[e.trackId]=e}getTrackState(e){return this.peerTrackStates[e]}setTrackState(e){this.peerTrackStates[e.trackInfo.track_id]=e}removePeer(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}removeTrack(e){delete this.tracks[e]}updateSpeakers(e){this.speakers=e}updateAudioOutputVolume(e){this.getAudioTracks().forEach((t=>t.setVolume(e)))}updateAudioOutputDevice(e){this.getAudioTracks().forEach((t=>{t.setOutputDevice(e)}))}getSubscribeDegradationParams(){var e,t;let i=null==(t=null==(e=this.getLocalPeer())?void 0:e.role)?void 0:t.subscribeParams.subscribeDegradation;if(i&&Object.keys(i).length>0)return i}getSimulcastLayers(e){var t,i;return"screen"===e?(null==(t=this.screenshareLayers)?void 0:t.layers)||[]:(null==(i=this.videoLayers)?void 0:i.layers)||[]}getSimulcastDimensions(e){let t="screen"===e?this.screenshareLayers:this.videoLayers;return{width:null==t?void 0:t.width,height:null==t?void 0:t.height}}convertSimulcastLayers(e){return _e(Ae({},e),{layers:(e.layers||[]).map((e=>_e(Ae({},e),{maxBitrate:1e3*e.maxBitrate})))})}setVideoSimulcastLayers(e){this.videoLayers=this.convertSimulcastLayers(e)}setScreenshareSimulcastLayers(e){this.screenshareLayers=this.convertSimulcastLayers(e)}getSimulcastDefinitionsForPeer(e,t){if(!e.role)return[];let i,n=this.getPolicyForRole(e.role.name).publishParams;if("regular"===t?i=n.videoSimulcastLayers:"screen"===t&&(i=n.screenSimulcastLayers),!i||!i.layers||0===i.layers.length)return[];let r=i.width,s=i.height;return i.layers.map((e=>({layer:yt[e.rid],resolution:{width:r&&e.scaleResolutionDownBy?r/e.scaleResolutionDownBy:void 0,height:s&&e.scaleResolutionDownBy?s/e.scaleResolutionDownBy:void 0}})))}cleanUp(){let e=this.getTracks();for(let t of e)t.cleanup();this.config=void 0}setErrorListener(e){this.errorListener=e}updatePeersPolicy(){this.getPeers().forEach((e=>{var t;e.role?e.role=this.getPolicyForRole(e.role.name):null==(t=this.errorListener)||t.onError(je.GenericErrors.InvalidRole(xe.VALIDATION,""))}))}},this.eventBus=new class{constructor(){this.eventEmitter=new Se.EventEmitter2,this.deviceChange=new tn(st,this.eventEmitter),this.localAudioEnabled=new tn(ot,this.eventEmitter),this.localVideoEnabled=new tn(at,this.eventEmitter),this.statsUpdate=new tn(lt,this.eventEmitter),this.trackDegraded=new tn(ct,this.eventEmitter),this.trackRestored=new tn(dt,this.eventEmitter),this.trackAudioLevelUpdate=new tn(ut,this.eventEmitter)}},this.playlistManager=new en(this),this.notificationManager=new class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i,this.TAG="[HMSNotificationManager]",this.eventEmitter=new Se.EventEmitter2,this.handleTrackAdd=e=>{this.trackManager.handleTrackAdd(e)},this.handleTrackRemove=e=>{this.trackManager.handleTrackRemove(e)},this.updateLocalPeer=({name:e,metadata:t})=>{let i=this.store.getLocalPeer();this.peerManager.handlePeerInfoUpdate({peer:i,name:e,data:t})},this.trackManager=new class{constructor(e,t,i){this.store=e,this.eventEmitter=t,this.listener=i,this.tracksToProcess=new Map,this.handleTrackAdd=e=>{Le.d(this.TAG,"ONTRACKADD",e,e.nativeTrack),this.store.addTrack(e),this.tracksToProcess.set(e.trackId,e),this.processPendingTracks()},this.handleTrackRemove=e=>{var t;Le.d(this.TAG,"ONTRACKREMOVE",e,e.nativeTrack);let i=this.store.getTrackState(e.trackId);if(!i)return;e.type===Tt.AUDIO&&this.eventEmitter.emit("track-removed",{detail:e});let n=this.store.getPeerById(i.peerId);if(!n)return;let r=()=>{let t=n.auxiliaryTracks.indexOf(e);t>-1&&n.auxiliaryTracks.splice(t,1)};switch(e.type){case Tt.AUDIO:"regular"!==e.source?r():n.audioTrack=void 0;break;case Tt.VIDEO:"regular"!==e.source?r():n.videoTrack=void 0}this.store.removeTrack(e.trackId),null==(t=this.listener)||t.onTrackUpdate(ze.TRACK_REMOVED,e,n)},this.handleTrackUpdate=e=>{var t,i,n,r;Le.d(this.TAG,"TRACK_UPDATE",e);let s=this.store.getPeerById(e.peer.peer_id);if(s)for(let o in e.tracks){let a=Object.assign({},null==(t=this.store.getTrackState(o))?void 0:t.trackInfo),l=e.tracks[o],c=this.store.getTrackById(o);this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:Ae(Ae({},a),l)}),!c||this.tracksToProcess.has(o)?this.processPendingTracks():(c.setEnabled(!l.mute),a.mute!==l.mute?(l.mute?null==(i=this.listener)||i.onTrackUpdate(ze.TRACK_MUTED,c,s):null==(n=this.listener)||n.onTrackUpdate(ze.TRACK_UNMUTED,c,s),c.type===Tt.AUDIO&&this.eventEmitter.emit("track-updated",{detail:{track:c,enabled:!l.mute}})):a.description!==l.description&&(null==(r=this.listener)||r.onTrackUpdate(ze.TRACK_DESCRIPTION_CHANGED,c,s)))}}}get TAG(){return`[${this.constructor.name}]`}handleTrackMetadataAdd(e){Le.d(this.TAG,"TRACK_METADATA_ADD",e);for(let t in e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}processPendingTracks(){new Map(this.tracksToProcess).forEach((e=>{var t;let i=this.store.getTrackState(e.trackId);if(!i)return;let n=this.store.getPeerById(i.peerId);if(n){switch(e.source=i.trackInfo.source,e.peerId=n.peerId,e.setEnabled(!i.trackInfo.mute),e.type){case Tt.AUDIO:n.audioTrack||"regular"!==e.source?n.auxiliaryTracks.push(e):n.audioTrack=e;break;case Tt.VIDEO:{let t=e,i=this.store.getSimulcastDefinitionsForPeer(n,t.source);t.setSimulcastDefinitons(i),n.videoTrack||"regular"!==e.source?n.auxiliaryTracks.push(t):n.videoTrack=t}}e.type===Tt.AUDIO?this.eventEmitter.emit("track-added",{detail:{track:e,peer:n}}):null==(t=this.listener)||t.onTrackUpdate(ze.TRACK_ADDED,e,n),this.tracksToProcess.delete(e.trackId)}}))}}(this.store,this.eventEmitter,this.listener),this.peerManager=new class{constructor(e,t,i){this.store=e,this.trackManager=t,this.listener=i,this.handlePeerList=e=>{var t;if(0===e.length)return;let i=[];for(let n of e)i.push(this.makePeer(n));null==(t=this.listener)||t.onPeerUpdate(qe.PEER_LIST,i),this.trackManager.processPendingTracks()},this.handlePeerJoin=e=>{var t;let i=this.makePeer(e);null==(t=this.listener)||t.onPeerUpdate(qe.PEER_JOINED,i),this.trackManager.processPendingTracks()},this.handlePeerLeave=e=>{var t,i,n,r;let s=this.store.getPeerById(e.peer_id);this.store.removePeer(e.peer_id),Le.d(this.TAG,"PEER_LEAVE event",e,this.store.getPeers()),s&&(s.audioTrack&&(null==(t=this.listener)||t.onTrackUpdate(ze.TRACK_REMOVED,s.audioTrack,s)),s.videoTrack&&(null==(i=this.listener)||i.onTrackUpdate(ze.TRACK_REMOVED,s.videoTrack,s)),null==(n=s.auxiliaryTracks)||n.forEach((e=>{var t;null==(t=this.listener)||t.onTrackUpdate(ze.TRACK_REMOVED,e,s)})),null==(r=this.listener)||r.onPeerUpdate(qe.PEER_LEFT,s))}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){switch(e){case xt.PEER_JOIN:{let e=t;this.handlePeerJoin(e);break}case xt.PEER_LEAVE:{let e=t;this.handlePeerLeave(e);break}case xt.PEER_UPDATE:this.handlePeerUpdate(t)}}handlePeerUpdate(e){var t;let i=this.store.getPeerById(e.peer_id);if(i){if(i.role&&i.role.name!==e.role){let n=this.store.getPolicyForRole(e.role);i.updateRole(n),null==(t=this.listener)||t.onPeerUpdate(qe.ROLE_UPDATED,i)}this.handlePeerInfoUpdate(Ae({peer:i},e.info))}}handlePeerInfoUpdate({peer:e,name:t,data:i}){var n,r;!e||(t&&e.name!==t&&(e.updateName(t),null==(n=this.listener)||n.onPeerUpdate(qe.NAME_UPDATED,e)),i&&e.metadata!==i&&(e.updateMetadata(i),null==(r=this.listener)||r.onPeerUpdate(qe.METADATA_UPDATED,e)))}makePeer(e){let t=new Jt({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role)});this.store.addPeer(t),Le.d(this.TAG,"adding to the peerList",t);for(let i in e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[i]});return t}}(this.store,this.trackManager,this.listener),this.peerListManager=new class{constructor(e,t,i,n){this.store=e,this.peerManager=t,this.trackManager=i,this.listener=n,this.handleInitialPeerList=e=>{let t=Object.values(e.peers);this.peerManager.handlePeerList(t)},this.handleReconnectPeerList=e=>{this.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=e=>{let t=e.peers;Object.keys(t).forEach((e=>{t[e].tracks={}})),this.handleRepeatedPeerList(t)},this.handleRepeatedPeerList=e=>{let t=this.store.getRemotePeers(),i=Object.values(e),n=t.filter((t=>!e[t.peerId]));Le.d(this.TAG,{peersToRemove:n}),n.forEach((e=>{var t;let i={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||""},tracks:{}};this.peerManager.handlePeerLeave(i)})),i.forEach((e=>{let t=this.store.getPeerById(e.peer_id),i=Object.values(e.tracks);t?(this.store.getPeerTracks(t.peerId).forEach((i=>{var n;e.tracks[i.trackId]||(this.removePeerTrack(t,i.trackId),null==(n=this.listener)||n.onTrackUpdate(ze.TRACK_REMOVED,i,t))})),i.forEach((e=>{this.store.getTrackById(e.track_id)||this.store.setTrackState({peerId:t.peerId,trackInfo:e})})),this.trackManager.handleTrackUpdate({peer:{info:e.info,peer_id:e.peer_id},tracks:e.tracks}),this.peerManager.handlePeerUpdate(e)):this.peerManager.handlePeerJoin(e)}))}}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t,i){if(e===xt.PEER_LIST){let e=t;i?(Le.d(this.TAG,"RECONNECT_PEER_LIST event",e),this.handleReconnectPeerList(e)):(Le.d(this.TAG,"PEER_LIST event",e),this.handleInitialPeerList(e))}else if(e===xt.ROOM_STATE){let e=t;this.handlePreviewRoomState(e)}}removePeerTrack(e,t){var i,n;if((null==(i=e.audioTrack)?void 0:i.trackId)===t)e.audioTrack=void 0;else if((null==(n=e.videoTrack)?void 0:n.trackId)===t)e.videoTrack=void 0;else{let i=e.auxiliaryTracks.findIndex((e=>e.trackId===t));i>=0&&e.auxiliaryTracks.splice(i,1)}}}(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new class{constructor(e,t){this.store=e,this.listener=t}get TAG(){return`[${this.constructor.name}]`}handleNotification(e,t){e===xt.BROADCAST&&this.handleBroadcast(t)}handleBroadcast(e){var t;let i=e.peer,n=e.info,r=e.roles,s=this.store.getPeerById(i.peer_id);s||(s=new Ht({peerId:i.peer_id,name:i.info.name,isLocal:!1,customerUserId:i.info.user_id,metadata:i.info.data}));let o=e.private?this.store.getLocalPeer():void 0,a=[];if(null==r?void 0:r.length){let e=this.store.getKnownRoles();for(let t of r)e[t]&&a.push(e[t])}let l=new Kt(_e(Ae({},n),{sender:s,recipientRoles:a,recipientPeer:o,time:new Date(e.timestamp)}));Le.d(this.TAG,"Received Message:: ",l),null==(t=this.listener)||t.onMessageReceived(l)}}(this.store,this.listener),this.policyChangeManager=new class{constructor(e,t){this.store=e,this.eventEmitter=t}handlePolicyChange(e){var t,i;let n=this.store.getLocalPeer();if(n&&!n.role){let t=e.known_roles[e.name];n.updateRole(t)}this.store.setKnownRoles(e.known_roles);let r=null==(t=e.known_roles[e.name])?void 0:t.publishParams;if(this.store.setPublishParams(r),this.setSimulcastLayers(r),this.handleStreamingRecordingPermissions(null==(i=e.known_roles[e.name])?void 0:i.permissions),(null==n?void 0:n.role)&&n.role.name!==e.name){let t=this.store.getPolicyForRole(e.name),i=n.role;n.updateRole(t),this.eventEmitter.emit("local-peer-role-update",{detail:{oldRole:i,newRole:t}})}this.eventEmitter.emit("policy-change",{detail:{params:e}})}setSimulcastLayers(e){if(e&&Object.keys(e).length>0){let{videoSimulcastLayers:t,screenSimulcastLayers:i}=e;this.store.setVideoSimulcastLayers(t),this.store.setScreenshareSimulcastLayers(i)}}handleStreamingRecordingPermissions(e){e&&(void 0===e.recording&&(e.recording=!0),void 0===e.streaming&&(e.streaming=!0))}}(this.store,this.eventEmitter),this.requestManager=new class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case xt.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case xt.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case xt.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}handleRoleChangeRequest(e){var t;let i={requestedBy:this.store.getPeerById(e.requested_by),role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(i)}handleTrackUpdateRequest(e){let{requested_by:t,track_id:i,mute:n}=e,r=this.store.getPeerById(t),s=this.store.getLocalPeerTracks().find((e=>e.publishedTrackId===i));if(!r||r.isLocal||!s)return;let o=()=>{var e;null==(e=this.listener)||e.onChangeTrackStateRequest({requestedBy:r,track:s,enabled:!n})};if(n){if(s.enabled===!n)return;s.setEnabled(!n).then(o)}else o()}handleChangeTrackStateRequest(e){var t;let{type:i,source:n,value:r,requested_by:s}=e,o=this.store.getPeerById(s);if(!o)return;let a=!r,l=this.getTracksToBeUpdated({type:i,source:n,enabled:a});if(0!==l.length)if(a)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,type:i,source:n,enabled:!0});else{let e=[];for(let t of l)e.push(t.setEnabled(!1));Promise.all(e).then((()=>{var e;null==(e=this.listener)||e.onChangeMultiTrackStateRequest({requestedBy:o,tracks:l,enabled:!1})}))}}getTracksToBeUpdated({type:e,source:t,enabled:i}){let n=this.store.getLocalPeerTracks();return e&&(n=n.filter((t=>t.type===e))),t&&(n=n.filter((e=>e.source===t))),n.filter((e=>e.enabled!==i))}}(this.store,this.listener),this.activeSpeakerManager=new class{constructor(e,t,i){this.store=e,this.listener=t,this.audioListener=i}handleActiveSpeakers(e){var t,i,n;let r=e["speaker-list"],s=r.map((e=>({audioLevel:e.level,peer:this.store.getPeerById(e.peer_id),track:this.store.getTrackById(e.track_id)})));null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);let o=r[0];if(o){let e=this.store.getPeerById(o.peer_id);null==(i=this.listener)||i.onPeerUpdate(qe.BECAME_DOMINANT_SPEAKER,e)}else null==(n=this.listener)||n.onPeerUpdate(qe.RESIGNED_DOMINANT_SPEAKER,null)}}(this.store,this.listener,this.audioListener),this.roomUpdateManager=new class{constructor(e,t){this.store=e,this.listener=t}handleNotification(e,t){switch(e){case xt.PEER_LIST:this.onPeerList(t.room);break;case xt.RTMP_START:this.onRTMPStart(t);break;case xt.RTMP_STOP:this.onRTMPStop(t);break;case xt.RECORDING_START:this.onRecordingStart(t);break;case xt.RECORDING_STOP:this.onRecordingStop(t);break;case xt.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t)}}handlePreviewRoomState(e){let{room:t}=e;this.onPeerList(t,e.peer_count)}onPeerList(e,t){var i,n,r;let{recording:s,streaming:o,session_id:a,started_at:l,name:c}=e,d=this.store.getRoom();d.peerCount=t,d.name=c,d.recording.server.running=s.sfu.enabled,d.recording.browser.running=s.browser.enabled,d.rtmp.running=(null==(i=o.rtmp)?void 0:i.enabled)||o.enabled,d.rtmp.startedAt=this.getAsDate(null==(n=o.rtmp)?void 0:n.started_at),d.recording.server.startedAt=this.getAsDate(s.sfu.started_at),d.recording.browser.startedAt=this.getAsDate(s.browser.started_at),d.hls=this.convertHls(o.hls),d.sessionId=a,d.startedAt=this.getAsDate(l),null==(r=this.listener)||r.onRoomUpdate(We.RECORDING_STATE_UPDATED,d)}getAsDate(e){return e?new Date(e):void 0}onRTMPStart(e){var t;this.setRTMPStatus(!(null==(t=e.error)?void 0:t.code),e)}onRTMPStop(e){this.setRTMPStatus(!1,e)}onRecordingStart(e){var t;this.setRecordingStatus(!(null==(t=e.error)?void 0:t.code),e)}onRecordingStop(e){this.setRecordingStatus(!1,e)}onHLS(e,t){var i,n;if(![xt.HLS_START,xt.HLS_STOP].includes(e))return;let r=this.store.getRoom();t.enabled=e===xt.HLS_START&&!(null==(i=t.error)?void 0:i.code),r.hls=this.convertHls(t),null==(n=this.listener)||n.onRoomUpdate(We.HLS_STREAMING_STATE_UPDATED,r)}convertHls(e){var t,i;let n={running:e.enabled,variants:[],error:(null==(t=e.error)?void 0:t.code)?e.error:void 0};return null==(i=null==e?void 0:e.variants)||i.map((e=>{null==n||n.variants.push({meetingURL:e.meeting_url,url:e.url,metadata:e.metadata,startedAt:this.getAsDate(e.started_at)})})),n}setRecordingStatus(e,t){var i,n,r;let s,o=this.store.getRoom();"sfu"===t.type?(o.recording.server={running:e,startedAt:e?this.getAsDate(t.started_at):void 0,error:(null==(i=t.error)?void 0:i.code)?t.error:void 0},s=We.SERVER_RECORDING_STATE_UPDATED):(o.recording.browser={running:e,startedAt:e?this.getAsDate(t.started_at):void 0,error:(null==(n=t.error)?void 0:n.code)?t.error:void 0},s=We.BROWSER_RECORDING_STATE_UPDATED),null==(r=this.listener)||r.onRoomUpdate(s,o)}setRTMPStatus(e,t){var i,n;let r=this.store.getRoom();r.rtmp={running:e,startedAt:e?this.getAsDate(t.started_at):void 0,error:(null==(i=t.error)?void 0:i.code)?t.error:void 0},null==(n=this.listener)||n.onRoomUpdate(We.RTMP_STREAMING_STATE_UPDATED,r)}}(this.store,this.listener)}setListener(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e}setAudioListener(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}addEventListener(e,t){this.eventEmitter.addListener(e,t)}removeEventListener(e,t){this.eventEmitter.removeListener(e,t)}once(e,t){this.eventEmitter.once(e,t)}handleNotification(e,t=!1){var i,n;let r=e.method,s=e.params;switch([xt.ACTIVE_SPEAKERS,xt.SFU_STATS].includes(r)||Le.d(this.TAG,"Received notification",{method:r,notification:s}),r===xt.SFU_STATS&&(null==(i=window.HMS)?void 0:i.ON_SFU_STATS)&&"function"==typeof(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),this.roomUpdateManager.handleNotification(r,s),this.peerManager.handleNotification(r,s),this.requestManager.handleNotification(r,s),this.peerListManager.handleNotification(r,s,t),this.broadcastManager.handleNotification(r,s),r){case xt.TRACK_METADATA_ADD:this.trackManager.handleTrackMetadataAdd(s);break;case xt.TRACK_UPDATE:this.trackManager.handleTrackUpdate(s);break;case xt.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(s);break;case xt.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(s)}}}(this.store,this.listener,this.audioListener),this.deviceManager=new class{constructor(e,t){this.store=e,this.eventBus=t,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=e=>{let t=this.audioOutput.find((t=>t.deviceId===e));return t&&(this.outputDevice=t,this.store.updateAudioOutputDevice(t),ui.updateSelection("audioOutput",{deviceId:t.deviceId,groupId:t.groupId})),t},this.getCurrentSelection=()=>{var e,t;let i=this.store.getLocalPeer(),n=this.createIdentifier(null==(e=null==i?void 0:i.audioTrack)?void 0:e.getMediaTrackSettings()),r=this.createIdentifier(null==(t=null==i?void 0:i.videoTrack)?void 0:t.getMediaTrackSettings());return{audioInput:this.audioInput.find((e=>this.createIdentifier(e)===n)),videoInput:this.videoInput.find((e=>this.createIdentifier(e)===r)),audioOutput:this.outputDevice}},this.computeChange=(e,t)=>e.length!==t.length||t.some((t=>!e.includes(this.createIdentifier(t)))),this.enumerateDevices=()=>De(this,null,(function*(){try{let e=yield navigator.mediaDevices.enumerateDevices(),t=this.videoInput.map(this.createIdentifier),i=this.audioInput.map(this.createIdentifier);this.audioInput=[],this.audioOutput=[],this.videoInput=[],e.forEach((e=>{"audioinput"===e.kind&&e.label?(this.hasMicrophonePermission=!0,this.audioInput.push(e)):"audiooutput"===e.kind?this.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(this.hasWebcamPermission=!0,this.videoInput.push(e))})),this.videoInputChanged=this.computeChange(t,this.videoInput),this.audioInputChanged=this.computeChange(i,this.audioInput),ui.setDevices({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput]}),this.logDevices("Enumerate Devices")}catch(e){Le.e(this.TAG,"Failed enumerating devices",e)}})),this.handleDeviceChange=function(e,t=300){let i;return function(...n){clearTimeout(i),i=void 0;let r=this;i=setTimeout((()=>{e.apply(r,n)}),t)}}((()=>De(this,null,(function*(){yield this.enumerateDevices(),ai.queue(Pi.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})).flush(),this.logDevices("After Device Change");let e=this.store.getLocalPeer();this.setOutputDevice(!0),yield this.handleAudioInputDeviceChange(null==e?void 0:e.audioTrack),yield this.handleVideoInputDeviceChange(null==e?void 0:e.videoTrack)}))),500).bind(this),this.handleAudioInputDeviceChange=e=>De(this,null,(function*(){if(!e)return void Le.d(this.TAG,"No Audio track on local peer");if(!this.audioInputChanged)return void Le.d(this.TAG,"No Change in AudioInput Device");let t=this.getNewAudioInputDevice();if(!t||!t.deviceId)return void Le.w(this.TAG,"Audio device not found");let{settings:i}=e,n=(new Ut).codec(i.codec).maxBitrate(i.maxBitrate).deviceId(t.deviceId).build();try{yield e.setSettings(n,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"audioInput"}),this.logDevices("Audio Device Change Success")}catch(r){Le.e(this.TAG,"[Audio Device Change]",r),ai.queue(Pi.deviceChange({selection:{audioInput:t},devices:this.getDevices(),error:r})).flush(),this.eventBus.deviceChange.publish({error:r,selection:t,type:"audioInput",devices:this.getDevices()})}})),this.handleVideoInputDeviceChange=e=>De(this,null,(function*(){if(!e)return void Le.d(this.TAG,"No video track on local peer");if(!this.videoInputChanged)return void Le.d(this.TAG,"No Change in VideoInput Device");let t=this.videoInput[0];if(!t||!t.deviceId)return void Le.w(this.TAG,"Video device not found");let{settings:i}=e,n=(new Gt).codec(i.codec).maxBitrate(i.maxBitrate).maxFramerate(i.maxFramerate).setWidth(i.width).setHeight(i.height).deviceId(t.deviceId).build();try{yield e.setSettings(n,!0),this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:t,type:"video"}),this.logDevices("Video Device Change Success")}catch(r){Le.e(this.TAG,"[Video Device Change]",r),ai.queue(Pi.deviceChange({selection:{videoInput:t},devices:this.getDevices(),error:r})).flush(),this.eventBus.deviceChange.publish({error:r,type:"video",selection:t,devices:this.getDevices()})}}))}init(){return De(this,null,(function*(){this.initialized||(this.initialized=!0,navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),yield this.enumerateDevices(),this.logDevices("Init"),this.setOutputDevice(),this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.localVideoEnabled.subscribeOnce((e=>De(this,null,(function*(){!e||(yield this.enumerateDevices(),this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()}))})))),this.eventBus.localAudioEnabled.subscribeOnce((e=>De(this,null,(function*(){!e||(yield this.enumerateDevices(),this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()}))})))),ai.queue(Pi.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})).flush())}))}getDevices(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}cleanUp(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}createIdentifier(e){return e?`${e.deviceId}${e.groupId}`:""}getNewAudioInputDevice(){let e=this.audioInput.find((e=>"default"===e.deviceId));return e?this.audioInput.find((t=>t.label!==e.label&&e.label.includes(t.label))):this.audioInput[0]}setOutputDevice(e=!1){let t=this.getNewAudioInputDevice(),i=this.createIdentifier(this.outputDevice);this.outputDevice=void 0,(null==t?void 0:t.groupId)&&(this.outputDevice=this.audioOutput.find((e=>"default"!==t.deviceId&&e.label===t.label))),this.outputDevice||(this.outputDevice=this.audioOutput.find((e=>"default"===e.deviceId))||this.audioOutput[0]),this.store.updateAudioOutputDevice(this.outputDevice),e&&i!==this.createIdentifier(this.outputDevice)&&this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()})}logDevices(e=""){Le.d(this.TAG,e,JSON.stringify({videoInput:[...this.videoInput],audioInput:[...this.audioInput],audioOutput:[...this.audioOutput],selected:this.getCurrentSelection()},null,4))}}(this.store,this.eventBus),this.audioSinkManager=new class{constructor(e,t,i,n){this.store=e,this.notificationManager=t,this.deviceManager=i,this.eventBus=n,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.eventEmitter=new Se.EventEmitter2,this.state=Ae({},qi),this.audioContextList=new Map,this.handleAudioPaused=e=>{var t;let i=null==(t=e.target.srcObject)?void 0:t.getAudioTracks()[0];if(!(null==i?void 0:i.enabled))return;Le.d(this.TAG,"Audio Paused",e.target.id);let n=this.store.getTrackById(e.target.id);n&&("mobile"===At.getDevice().type?setTimeout((()=>De(this,null,(function*(){n&&(yield this.playAudioFor(n))}))),500):this.autoPausedTracks.add(n))},this.handleTrackUpdate=e=>{var t;if(null==(t=window.HMS)?void 0:t.AUDIO_SINK){let{track:t,enabled:i}=e.detail;i?(t.addSink(),this.playAudioFor(t)):t.removeSink()}},this.handleTrackAdd=e=>{this.handleTrackAddAsync(e)},this.handleTrackAddAsync=e=>De(this,null,(function*(){var t,i,n,r;let{track:s,peer:o}=e.detail,a=document.createElement("audio");if(a.style.display="none",a.id=s.trackId,a.addEventListener("pause",this.handleAudioPaused),s.setAudioElement(a),s.setVolume(this.volume),this.connectAudioContext(a,s.trackId),Le.d(this.TAG,"Audio track added",s.trackId),null==(t=this.audioSink)||t.append(a),this.outputDevice&&(yield s.setOutputDevice(this.outputDevice)),null==(i=window.HMS)?void 0:i.AUDIO_SINK){if(!s.enabled)return s.removeSink(),void(null==(n=this.listener)||n.onTrackUpdate(ze.TRACK_ADDED,s,o));s.addSink()}else a.srcObject=new MediaStream([s.nativeTrack]);null==(r=this.listener)||r.onTrackUpdate(ze.TRACK_ADDED,s,o),void 0===this.state.autoplayFailed&&(this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise((e=>{this.playAudioFor(s).then(e)}))),yield this.state.autoplayCheckPromise),this.state.autoplayFailed?this.autoPausedTracks.add(s):yield this.playAudioFor(s)})),this.handleAudioDeviceChange=e=>{e.error||!e.selection||"video"===e.type||this.unpauseAudioTracks()},this.handleTrackRemove=e=>{let t=e.detail;this.autoPausedTracks.delete(t);let i=document.getElementById(t.trackId);i&&(i.removeEventListener("pause",this.handleAudioPaused),i.srcObject=null,i.remove(),t.setAudioElement(null)),this.audioSink&&0===this.audioSink.childElementCount&&(this.state.autoplayCheckPromise=void 0,this.state.autoplayFailed=void 0),Le.d(this.TAG,"Audio track removed",t.trackId)},this.unpauseAudioTracks=()=>De(this,null,(function*(){let e=[];this.autoPausedTracks.forEach((t=>{e.push(this.playAudioFor(t))})),yield Promise.all(e)})),this.connectAudioContext=(e,t)=>{var i;if(!Dt||!(null==(i=window.HMS)?void 0:i.GAIN_VALUE))return;let n=new AudioContext,r=n.createMediaElementSource(e),s=n.createGain();s.gain.value=window.HMS.GAIN_VALUE,r.connect(s),s.connect(n.destination),this.audioContextList.set(t,n)},this.notificationManager.addEventListener("track-added",this.handleTrackAdd),this.notificationManager.addEventListener("track-removed",this.handleTrackRemove),this.notificationManager.addEventListener("track-updated",this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}setListener(e){this.listener=e}addEventListener(e,t){this.eventEmitter.addListener(e,t)}removeEventListener(e,t){this.eventEmitter.removeListener(e,t)}get outputDevice(){return this.deviceManager.outputDevice}getVolume(){return this.volume}setVolume(e){this.store.updateAudioOutputVolume(e),this.volume=e}unblockAutoplay(){return De(this,null,(function*(){this.autoPausedTracks.size>0&&this.unpauseAudioTracks()}))}init(e){if(this.state.initialized)return;this.state.initialized=!0;let t=document.createElement("div");t.id=`HMS-SDK-audio-sink-${Ee()}`,(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t}cleanUp(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0;for(let t of this.audioContextList.values())t.close();this.audioContextList.clear(),this.notificationManager.removeEventListener("track-added",this.handleTrackAdd),this.notificationManager.removeEventListener("track-removed",this.handleTrackRemove),this.notificationManager.removeEventListener("track-updated",this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=Ae({},qi)}playAudioFor(e){return De(this,null,(function*(){var t;let i=e.getAudioElement();if(i)try{let t=this.audioContextList.get(e.trackId);"suspended"===(null==t?void 0:t.state)&&(null==t||t.resume()),yield i.play(),this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),Le.d(this.TAG,"Played track",e.trackId)}catch(ge){if(this.autoPausedTracks.add(e),Le.e(this.TAG,"Failed to play track",e.trackId,ge),!this.state.autoplayFailed&&!(null==(t=null==ge?void 0:ge.message)?void 0:t.includes("new load request"))){this.state.autoplayFailed=!0;let e=je.TracksErrors.AutoplayBlocked(xe.AUTOPLAY,"");ai.queue(Pi.autoplayError()).flush(),this.eventEmitter.emit($i,{error:e})}}else Le.w(this.TAG,"No audio element found on track",e.trackId)}))}}(this.store,this.notificationManager,this.deviceManager,this.eventBus),this.audioOutput=new class{constructor(e,t){this.deviceManager=e,this.audioSinkManager=t}getVolume(){return this.audioSinkManager.getVolume()}setVolume(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}getDevice(){return this.deviceManager.outputDevice}setDevice(e){return this.deviceManager.updateOutputDevice(e)}unblockAutoplay(){return De(this,null,(function*(){yield this.audioSinkManager.unblockAutoplay()}))}}(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.audioSinkManager.addEventListener($i,this.handleAutoplayError),this.localTrackManager=new Ii(this.store,this.observer,this.deviceManager,this.eventBus),this.transport=new class{constructor(e,t,i,n,r){var s,o;this.observer=e,this.deviceManager=t,this.store=i,this.localTrackManager=n,this.eventBus=r,this.state=_i.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.retryScheduler=new class{constructor(e,t){this.inProgress=new Map,this.retryTaskIds=[],this.analyticsEventsService=e,this.onStateChange=t}schedule(e,t,i){return De(this,arguments,(function*(e,t,i,n=5,r=!0){yield this.scheduleTask(e,t,r,i,n)}))}reset(){this.retryTaskIds.forEach((e=>clearTimeout(e))),this.retryTaskIds=[],this.inProgress.clear()}scheduleTask(e,t,i,n){return De(this,arguments,(function*(e,t,i,n,r=5,s=0){if(Le.d(xi,"schedule: ",{category:Ni[e],error:t}),0===s){let i=this.inProgress.get(e);if(i)return Le.d(xi,`schedule: Already a task for ${Ni[e]} scheduled, waiting for its completion`),void(yield i.promise);let n=new class{constructor(e){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i,e(t,i)}))}}(((e,t)=>{}));this.inProgress.set(e,n),this.sendEvent(t,e)}let o=!1,a=Li[e];for(let h in a){let t=a[parseInt(h)];try{let i=this.inProgress.get(t);i&&(Le.d(xi,`schedule: Suspending retry task of ${Ni[e]}, waiting for ${Ni[t]} to recover`),yield i.promise,Le.d(xi,`schedule: Resuming retry task ${Ni[e]} as it's dependency ${Ni[t]} is recovered`))}catch(d){Le.d(xi,`schedule: Stopping retry task of ${Ni[e]} as it's dependency ${Ni[t]} failed to recover`),o=!0;break}}if(s>=r||o){if(t.description+=`. [${Ni[e]}] Could not recover after ${s} tries`,o&&(t.description+=` Could not recover all of it's required dependencies - [${a.map((e=>Ni[e])).toString()}]`),t.isTerminal=!0,this.inProgress.delete(e),this.sendEvent(t,e),this.reset(),!i)throw t;return void this.onStateChange(_i.Failed,t)}i&&this.onStateChange(_i.Reconnecting,t);let l,c=this.getDelayForRetryCount(s);Le.i(xi,`schedule: [${Ni[e]}] [failedRetryCount=${s}] Scheduling retry task in ${c}ms`);try{l=yield this.setTimeoutPromise(n,c)}catch(u){l=!1,Le.w(xi,`[${Ni[e]}] Un-caught exception ${u.name} in retry-task, initiating retry`,u)}if(l){let t=this.inProgress.get(e);this.inProgress.delete(e),null==t||t.resolve(s),i&&0===this.inProgress.size&&this.onStateChange(_i.Joined),Le.i(xi,`schedule: [${Ni[e]}] [failedRetryCount=${s}] Recovered \u267b\ufe0f`)}else yield this.scheduleTask(e,t,i,n,r,s+1)}))}sendEvent(e,t){let i;switch(t){case Ni.ConnectFailed:i=Pi.connect(e);break;case Ni.SignalDisconnect:i=Pi.disconnect(e);break;case Ni.PublishIceConnectionFailed:i=Pi.publish({error:e});break;case Ni.SubscribeIceConnectionFailed:i=Pi.subscribeFail(e)}this.analyticsEventsService.queue(i).flush()}getDelayForRetryCount(e){let t=Math.pow(2,e),i=Math.random();return Math.round(1e3*Math.min(t+i,60))}setTimeoutPromise(e,t){return De(this,null,(function*(){return new Promise(((i,n)=>{let r=window.setTimeout((()=>De(this,null,(function*(){try{let t=yield e();t&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(r),1),i(t)}catch(s){n(s)}}))),t);this.retryTaskIds.push(r)}))}))}}(ai,((e,t)=>De(this,null,(function*(){e!==this.state&&(this.state=e,yield this.observer.onStateChange(this.state,t))})))),this.callbacks=new Map,this.signalObserver={onOffer:e=>De(this,null,(function*(){try{yield this.subscribeConnection.setRemoteDescription(e),Le.d(Hi,`[SUBSCRIBE] Adding ${this.subscribeConnection.candidates.length} ice-candidates`,this.subscribeConnection.candidates);for(let e of this.subscribeConnection.candidates)yield this.subscribeConnection.addIceCandidate(e);this.subscribeConnection.candidates.length=0;let t=yield this.subscribeConnection.createAnswer();yield this.subscribeConnection.setLocalDescription(t),this.signal.answer(t),Le.d(Hi,"[role=SUBSCRIBE] onOffer renegotiation DONE \u2705")}catch(t){let i;throw Le.d(Hi,"[role=SUBSCRIBE] onOffer renegotiation FAILED \u274c"),this.state=_i.Failed,i=t instanceof Ge?t:je.GenericErrors.Unknown(xe.PUBLISH,t.message),ai.queue(Pi.subscribeFail(i)).flush(),i}})),onTrickle:e=>De(this,null,(function*(){let t=e.target===Oe.Publish?this.publishConnection:this.subscribeConnection;null===t.remoteDescription?t.candidates.push(e.candidate):yield t.addIceCandidate(e.candidate)})),onNotification:e=>this.observer.onNotification(e),onServerError:e=>De(this,null,(function*(){yield this.observer.onStateChange(_i.Failed,e)})),onFailure:e=>{this.joinParameters&&this.retryScheduler.schedule(Ni.SignalDisconnect,e,this.retrySignalDisconnectTask)},onOffline:()=>De(this,null,(function*(){Le.d(Hi,"socket offline",_i[this.state]);try{this.state!==_i.Leaving&&this.joinParameters&&this.retryScheduler.schedule(Ni.SignalDisconnect,je.WebSocketConnectionErrors.WebSocketConnectionLost(xe.RECONNECT_SIGNAL,"Network offline"),this.retrySignalDisconnectTask)}catch(e){console.error(e)}})),onOnline:()=>{Le.d(Hi,"socket online",_i[this.state]),this.analyticsSignalTransport.flushFailedEvents()}},this.signal=new class{constructor(e){this.TAG="[ SIGNAL ]: ",this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.observer=e,window.addEventListener("offline",(()=>{Le.d(this.TAG,"Window network offline"),this.isConnected=!1})),window.addEventListener("online",(()=>{Le.d(this.TAG,"Window network online")})),this.onCloseHandler=this.onCloseHandler.bind(this),this.onMessageHandler=this.onMessageHandler.bind(this)}get isConnected(){return this._isConnected}set isConnected(e){Le.d(this.TAG,"isConnected set",{id:this.id,old:this._isConnected,new:e}),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.observer.onOffline()):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}call(e,t){return De(this,null,(function*(){let i=Ee(),n={method:e,params:t,id:i,jsonrpc:"2.0"};this.socket.send(JSON.stringify(n));try{return yield new Promise(((e,t)=>{this.callbacks.set(i,{resolve:e,reject:t})}))}catch(r){let i=r;throw je.WebsocketMethodErrors.ServerErrors(Number(i.code),function(e){switch(e){case Ot.JOIN:return xe.JOIN;case Ot.OFFER:return xe.PUBLISH;case Ot.ANSWER:return xe.SUBSCRIBE;case Ot.TRACK_UPDATE:return xe.TRACK;default:return xe.NONE}}(e),i.message)}}))}notify(e,t){let i={method:e,params:t};this.socket.send(JSON.stringify(i))}open(e){return new Promise(((t,i)=>{this.socket&&(this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)),this.socket=new WebSocket(e);let n=e=>{Le.d(this.TAG,"Error opening socket connection",e),i(je.WebSocketConnectionErrors.GenericConnect(xe.JOIN,"Error opening socket connection"))};this.socket.addEventListener("error",n);let r=()=>{t(),this.isConnected=!0,this.id++,this.socket.removeEventListener("open",r),this.socket.removeEventListener("error",n),this.pingPongLoop(this.id)};this.socket.addEventListener("open",r),this.socket.addEventListener("close",this.onCloseHandler),this.socket.addEventListener("message",this.onMessageHandler)}))}close(){return De(this,null,(function*(){let e=new Promise((e=>{this.socket.addEventListener("close",(()=>e()))}));return this.socket.close(1e3,"Normal Close"),this.isConnected=!1,this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler),e}))}join(e,t,i,n){return De(this,null,(function*(){let r={name:e,disableVidAutoSub:n,data:t,offer:i},s=yield this.call(Ot.JOIN,r);return this.isJoinCompleted=!0,this.pendingTrickle.forEach((({target:e,candidate:t})=>this.trickle(e,t))),this.pendingTrickle.length=0,Le.d(this.TAG,`join: response=${JSON.stringify(s,null,1)}`),s}))}trickle(e,t){this.isJoinCompleted?this.notify(Ot.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}offer(e,t){return De(this,null,(function*(){return yield this.call(Ot.OFFER,{desc:e,tracks:Object.fromEntries(t)})}))}answer(e){this.notify(Ot.ANSWER,{desc:e})}trackUpdate(e){this.notify(Ot.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}broadcast(e){return De(this,null,(function*(){yield this.call(Ot.BROADCAST,Ae({version:"1.0"},e.toSignalParams()))}))}leave(){this.notify(Ot.LEAVE,{version:"1.0"})}endRoom(e,t){return De(this,null,(function*(){yield this.call(Ot.END_ROOM,{lock:e,reason:t})}))}sendEvent(e){if(!this.isConnected)throw Error(`${this.TAG} not connected. Could not send event ${e}`);this.notify(Ot.ANALYTICS,e.toSignalParams())}ping(e){let t=Date.now(),i=new Promise((i=>{setTimeout((()=>{i(Date.now()-t)}),e+1)})),n=this.call(Ot.PING,{timestamp:t}).then((()=>Date.now()-t)).catch((()=>Date.now()-t));return Promise.race([i,n])}requestRoleChange(e){return De(this,null,(function*(){yield this.call(Ot.ROLE_CHANGE_REQUEST,e)}))}acceptRoleChangeRequest(e){return De(this,null,(function*(){yield this.call(Ot.ROLE_CHANGE,e)}))}requestTrackStateChange(e){return De(this,null,(function*(){yield this.call(Ot.TRACK_UPDATE_REQUEST,e)}))}requestMultiTrackStateChange(e){return De(this,null,(function*(){yield this.call(Ot.CHANGE_TRACK_MUTE_STATE_REQUEST,e)}))}removePeer(e){return De(this,null,(function*(){yield this.call(Ot.PEER_LEAVE_REQUEST,e)}))}startRTMPOrRecording(e){return De(this,null,(function*(){yield this.call(Ot.START_RTMP_OR_RECORDING_REQUEST,Ae({version:"1.0"},e))}))}stopRTMPAndRecording(){return De(this,null,(function*(){yield this.call(Ot.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"})}))}startHLSStreaming(e){return De(this,null,(function*(){yield this.call(Ot.START_HLS_STREAMING,Ae({version:"1.0"},e))}))}stopHLSStreaming(e){return De(this,null,(function*(){yield this.call(Ot.STOP_HLS_STREAMING,Ae({version:"1.0"},e))}))}updatePeer(e){return De(this,null,(function*(){yield this.call(Ot.UPDATE_PEER_METADATA,Ae({version:"1.0"},e))}))}onCloseHandler(e){Le.d(`Websocket closed code=${e.code}`),this.isConnected=!1}onMessageHandler(e){let t=e.data,i=JSON.parse(t);if(i.id)this.handleResponseWithId(i);else{if(!i.method)throw Error(`WebSocket message has no 'method' or 'id' field, message=${i}`);this.handleResponseWithMethod(i)}}handleResponseWithId(e){let t=e,i=t.id;if(this.callbacks.has(i)){let e=this.callbacks.get(i);this.callbacks.delete(i),t.result?e.resolve(t.result):e.reject(t.error)}else this.observer.onNotification(t)}handleResponseWithMethod(e){switch(e.method){case Ot.OFFER:this.observer.onOffer(e.params);break;case Ot.TRICKLE:this.observer.onTrickle(e.params);break;case Ot.SERVER_ERROR:this.observer.onServerError(je.WebsocketMethodErrors.ServerErrors(Number(e.params.code),xe.NONE,e.params.message));break;case Ot.SERVER_WARNING:Le.w(this.TAG,e.params);break;default:this.observer.onNotification(e)}}pingPongLoop(e){return De(this,null,(function*(){var t,i;let n=(null==(t=window.HMS)?void 0:t.PING_TIMEOUT)||12e3;this.isConnected&&((yield this.ping(n))>n?(Le.d(this.TAG,"Pong timeout",{id:e}),this.id===e&&(this.isConnected=!1)):setTimeout((()=>this.pingPongLoop(e)),(null==(i=window.HMS)?void 0:i.PING_INTERVAL)||1e3))}))}}(this.signalObserver),this.analyticsSignalTransport=new class extends class{constructor(){this.TAG="AnalyticsTransport"}sendEvent(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){Le.w(this.TAG,"sendEvent failed",t)}}flushFailedEvents(){try{for(Le.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){let e=this.failedEvents.dequeue();e&&this.sendSingleEvent(e)}}catch(e){Le.w(this.TAG,"flushFailedEvents failed",e)}}sendSingleEvent(e){try{Le.d(this.TAG,"Sending event",{event:e}),this.transportProvider.sendEvent(e)}catch(t){throw Le.w(this.TAG,`${this.transportProvider.constructor.name}.sendEvent failed, adding to local storage events`,{event:e,error:t}),this.failedEvents.enqueue(e),t}}}{constructor(e){super(),this.transportProvider=e,this.failedEvents=new class extends class{constructor(e=1/0){this.capacity=e,this.storage=[]}size(){return this.storage.length}enqueue(e){if(this.size()===this.capacity)throw Error("Queue has reached max capacity, cannot add more items");this.storage.push(e)}dequeue(){return this.storage.shift()}}{constructor(){super(100),this.localStorage=new di("hms-analytics"),this.localStorage.clear(),this.initLocalStorageQueue()}enqueue(e){super.enqueue(e),this.localStorage.set(this.storage)}dequeue(){let e=super.dequeue();return this.localStorage.set(this.storage),e}initLocalStorageQueue(){var e;null==(e=this.localStorage.get())||e.forEach((e=>{let t=new ri(e);super.enqueue(t)}))}}}}(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:()=>De(this,null,(function*(){yield this.performPublishRenegotiation()})),onIceConnectionChange:e=>De(this,null,(function*(){Le.d("publisher ice connection state change, ",e)})),onConnectionStateChange:e=>De(this,null,(function*(){Le.d("publisher connection state change, ",e),"failed"===e&&(yield this.handleIceConnectionFailure(Oe.Publish))}))},this.subscribeConnectionObserver={onApiChannelMessage:e=>{this.observer.onNotification(JSON.parse(e))},onTrackAdd:e=>{Le.d(Hi,"[Subscribe] onTrackAdd",e),this.observer.onTrackAdd(e)},onTrackRemove:e=>{Le.d(Hi,"[Subscribe] onTrackRemove",e),this.observer.onTrackRemove(e)},onIceConnectionChange:e=>De(this,null,(function*(){if(Le.d("subscriber ice connection state change, ",e),"connected"===e){let e=this.callbacks.get(rt);this.callbacks.delete(rt),e&&e.promise.resolve(!0)}})),onConnectionStateChange:e=>De(this,null,(function*(){if(Le.d("subscriber connection state change, ",e),"failed"===e&&(yield this.handleIceConnectionFailure(Oe.Subscribe)),"connected"===e){let e=this.callbacks.get(rt);this.callbacks.delete(rt),e&&e.promise.resolve(!0)}}))},this.retryPublishIceFailedTask=()=>De(this,null,(function*(){if("connected"!==this.publishConnection.iceConnectionState||"connected"!==this.publishConnection.connectionState){let e=new Promise(((e,t)=>{this.callbacks.set(it,{promise:{resolve:e,reject:t},action:xe.RESTART_ICE,extra:{}})}));yield this.performPublishRenegotiation({iceRestart:!0}),yield e}return!0})),this.retrySubscribeIceFailedTask=()=>De(this,null,(function*(){if("connected"!==this.subscribeConnection.iceConnectionState||"connected"!==this.subscribeConnection.connectionState){let e=new Promise(((e,t)=>{this.callbacks.set(rt,{promise:{resolve:e,reject:t},action:xe.RESTART_ICE,extra:{}})})),t=new Promise((e=>{setTimeout(e,6e4,!1)}));return Promise.race([e,t])}return!0})),this.retrySignalDisconnectTask=()=>De(this,null,(function*(){let e=this.signal.isConnected;if(Le.d(Hi,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),!this.signal.isConnected)try{yield this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId),e=!0}catch(t){e=!1}return e=this.signal.isConnected&&(yield this.retryPublishIceFailedTask()),this.signal.trackUpdate(this.trackStates),e})),this.webrtcInternals=new class{constructor(e,t,i,n){this.store=e,this.eventBus=t,this.publishConnection=i,this.subscribeConnection=n,this.TAG="[HMSWebrtcInternals]",this.interval=1e3,this.isMonitored=!1,this.handleStatsUpdate=()=>De(this,null,(function*(){var e;yield null==(e=this.hmsStats)?void 0:e.updateStats(),this.eventBus.statsUpdate.publish(this.hmsStats)}))}getPublishPeerConnection(){return this.publishConnection}getSubscribePeerConnection(){return this.subscribeConnection}onStatsChange(e){return this.eventBus.statsUpdate.subscribe(e),()=>{this.eventBus.statsUpdate.unsubscribe(e)}}setPeerConnections({publish:e,subscribe:t}){var i,n;this.publishConnection=e,this.subscribeConnection=t,this.hmsStats=new class{constructor(e,t){var i;this.getStats=e,this.store=t,this.peerStats={},this.trackStats={},this.localPeerID=null==(i=this.store.getLocalPeer())?void 0:i.peerId}getLocalPeerStats(){if(this.localPeerID)return this.peerStats[this.localPeerID]}getTrackStats(e){return this.trackStats[e]}updateStats(){return De(this,null,(function*(){yield this.updateLocalPeerStats(),yield this.updateTrackStats()}))}updateLocalPeerStats(){return De(this,null,(function*(){var e,t,i,n,r,s;if(!this.localPeerID)return;let o=this.getLocalPeerStats(),a=yield null==(t=(e=this.getStats).publish)?void 0:t.call(e),l=a&&Gi("publish",a,o),c=yield null==(n=(i=this.getStats).subscribe)?void 0:n.call(i),d=c&&Gi("subscribe",c,o),{packetsLost:u,jitter:h}=(e=>{let t={packetsLost:0,jitter:0};return null==e||e.forEach((e=>{e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)})),t})(c),p=Ki(u,null==(r=null==o?void 0:o.subscribe)?void 0:r.packetsLost,null==d?void 0:d.timestamp,null==(s=null==o?void 0:o.subscribe)?void 0:s.timestamp),f=d&&Object.assign(d,{packetsLostRate:p,jitter:h,packetsLost:u});this.peerStats[this.localPeerID]={publish:l,subscribe:f}}))}updateTrackStats(){return De(this,null,(function*(){var e;let t=this.store.getTracksMap(),i=((e,t)=>Array.from(new Set(e.concat(t))))(Object.keys(this.trackStats),Object.keys(t));for(let n of i){let i=t[n];if(i){let t=i.peerId&&(null==(e=this.store.getPeerById(i.peerId))?void 0:e.name),r=this.getTrackStats(i.trackId),s=yield Ui(this.getStats,i,t,r);s&&(this.trackStats[n]=s)}else delete this.trackStats[n]}}))}}({publish:null==(i=this.publishConnection)?void 0:i.getStats.bind(this.publishConnection),subscribe:null==(n=this.subscribeConnection)?void 0:n.getStats.bind(this.subscribeConnection)},this.store)}start(){return De(this,null,(function*(){this.stop(),this.isMonitored=!0,Le.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then((()=>Le.d(this.TAG,"Stopping Webrtc Stats Monitor")))}))}stop(){this.isMonitored=!1}startLoop(){return De(this,null,(function*(){for(;this.isMonitored;)yield this.handleStatsUpdate(),yield gi(this.interval)}))}cleanUp(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}}(this.store,this.eventBus,null==(s=this.publishConnection)?void 0:s.nativeConnection,null==(o=this.subscribeConnection)?void 0:o.nativeConnection)}getLocalScreen(e,t){return De(this,null,(function*(){try{return yield this.localTrackManager.getLocalScreen(e,t)}catch(vt){throw vt instanceof Ge&&ai.queue(Pi.publish({error:vt,devices:this.deviceManager.getDevices(),settings:new Bt(e,t,!1)})).flush(),vt}}))}getWebrtcInternals(){return this.webrtcInternals}join(e,t,i,n="https://prod-init.100ms.live/init",r=!1){return De(this,null,(function*(){this.setTransportStateForJoin(),this.joinParameters=new class{constructor(e,t,i,n,r,s){this.authToken=e,this.peerId=t,this.peerName=i,this.data=n,this.endpoint=r,this.autoSubscribeVideo=s}}(e,t,i.name,i.metaData,n,r),Le.d(Hi,"join: started \u23f0");let s=new Date;try{(!this.signal.isConnected||!this.initConfig)&&(yield this.connect(e,n,t)),this.initConfig&&(yield this.connectionJoin(i.name,i.metaData,this.initConfig.rtcConfiguration,r))}catch(Ye){Le.e(Hi,`join: failed \u274c [token=${e}]`,Ye),this.state=_i.Failed,Ye instanceof Ge&&ai.queue(Pi.join(s,new Date,Ye)).flush();let i=Ye;throw i.isTerminal=500===i.code,yield this.observer.onStateChange(this.state,i),i}Le.d(Hi,"\u2705 join: successful"),this.state=_i.Joined,this.observer.onStateChange(this.state)}))}connect(e,t,i){return De(this,null,(function*(){try{return yield this.internalConnect(e,t,i)}catch(ge){if(!(ge instanceof Ge&&([Fe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,Fe.InitAPIErrors.ENDPOINT_UNREACHABLE].includes(ge.code)||ge.code.toString().startsWith("5")||ge.code.toString().startsWith("429"))))throw ge;{let r=()=>De(this,null,(function*(){return yield this.internalConnect(e,t,i),Boolean(this.initConfig&&this.initConfig.endpoint)}));yield this.retryScheduler.schedule(Ni.ConnectFailed,ge,r,5,!1)}}}))}leave(){return De(this,null,(function*(){var e,t,i,n;ai.removeTransport(this.analyticsSignalTransport),this.retryScheduler.reset(),this.joinParameters=void 0;try{this.state=_i.Leaving,null==(e=this.webrtcInternals)||e.cleanUp(),null==(t=this.trackDegradationController)||t.cleanUp(),yield null==(i=this.publishConnection)?void 0:i.close(),yield null==(n=this.subscribeConnection)?void 0:n.close(),this.signal.isConnected&&(this.signal.leave(),yield this.signal.close())}catch(r){r instanceof Ge&&ai.queue(Pi.disconnect(r)).flush(),Le.e(Hi,"leave: FAILED \u274c",r)}finally{this.state=_i.Disconnected,this.observer.onStateChange(this.state)}}))}publish(e){return De(this,null,(function*(){for(let t of e)try{yield this.publishTrack(t)}catch(vt){vt instanceof Ge&&ai.queue(Pi.publish({devices:this.deviceManager.getDevices(),error:vt})).flush()}}))}unpublish(e){return De(this,null,(function*(){for(let t of e)yield this.unpublishTrack(t)}))}sendMessage(e){return De(this,null,(function*(){yield this.signal.broadcast(e)}))}trackUpdate(e){let t=Array.from(this.trackStates.values()).find((t=>e.type===t.type&&e.source===t.source));if(t){let i=new Mi(_e(Ae({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,i),Le.d(Hi,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,i]]))}}changeRole(e,t,i=!1){return De(this,null,(function*(){yield this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:i})}))}acceptRoleChange(e){return De(this,null,(function*(){yield this.signal.acceptRoleChangeRequest({role:e.role.name,token:e.token})}))}endRoom(e,t){return De(this,null,(function*(){yield this.signal.endRoom(e,t)}))}removePeer(e,t){return De(this,null,(function*(){yield this.signal.removePeer({requested_for:e,reason:t})}))}startRTMPOrRecording(e){return De(this,null,(function*(){var t;(null==(t=e.rtmpURLs)?void 0:t.length)?yield this.signal.startRTMPOrRecording({meeting_url:e.meetingURL,record:e.record,rtmp_urls:e.rtmpURLs}):yield this.signal.startRTMPOrRecording({meeting_url:e.meetingURL,record:e.record})}))}stopRTMPOrRecording(){return De(this,null,(function*(){yield this.signal.stopRTMPAndRecording()}))}startHLSStreaming(e){return De(this,null,(function*(){let t={variants:e.variants.map((e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))};yield this.signal.startHLSStreaming(t)}))}stopHLSStreaming(e){return De(this,null,(function*(){if(e){let t={variants:null==e?void 0:e.variants.map((e=>{let t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t}))};yield this.signal.stopHLSStreaming(t)}yield this.signal.stopHLSStreaming()}))}changeName(e){return De(this,null,(function*(){yield this.signal.updatePeer({name:e})}))}changeMetadata(e){return De(this,null,(function*(){yield this.signal.updatePeer({data:e})}))}changeTrackState(e){return De(this,null,(function*(){yield this.signal.requestTrackStateChange(e)}))}changeMultiTrackState(e){return De(this,null,(function*(){yield this.signal.requestMultiTrackStateChange(e)}))}publishTrack(e){return De(this,null,(function*(){e.publishedTrackId=e.nativeTrack.id,Le.d(Hi,`\u23f3 publishTrack: trackId=${e.trackId}, toPublishTrackId=${e.publishedTrackId}`,e),this.trackStates.set(e.publishedTrackId,new Mi(e));let t=new Promise(((e,t)=>{this.callbacks.set(it,{promise:{resolve:e,reject:t},action:xe.PUBLISH,extra:{}})})),i=e.stream;i.setConnection(this.publishConnection);let n=this.store.getSimulcastLayers(e.source);i.addTransceiver(e,n),Le.time(`publish-${e.trackId}-${e.type}`),yield t,Le.timeEnd(`publish-${e.trackId}-${e.type}`),this.store.addTrack(e);let r=e.settings.maxBitrate;r&&(yield i.setMaxBitrate(r,e).then((()=>{Le.i(Hi,`Setting maxBitrate for ${e.source} ${e.type} to ${r} kpbs`)})).catch((e=>Le.e(Hi,"Failed setting maxBitrate",e)))),Le.d(Hi,`\u2705 publishTrack: trackId=${e.trackId}`,e,this.callbacks)}))}unpublishTrack(e){return De(this,null,(function*(){if(Le.d(Hi,`\u23f3 unpublishTrack: trackId=${e.trackId}`,e),this.trackStates.has(e.publishedTrackId))this.trackStates.delete(e.publishedTrackId);else{let t=Array.from(this.trackStates.values()).find((t=>e.type===t.type&&e.source===t.source));t&&this.trackStates.delete(t.track_id)}let t=new Promise(((e,t)=>{this.callbacks.set(it,{promise:{resolve:e,reject:t},action:xe.UNPUBLISH,extra:{}})}));e.stream.removeSender(e),yield t,yield e.cleanup(),this.store.removeTrack(e.trackId),Le.d(Hi,`\u2705 unpublishTrack: trackId=${e.trackId}`,this.callbacks)}))}connectionJoin(e,t,i,n){return De(this,arguments,(function*(e,t,i,n,r={offerToReceiveAudio:!1,offerToReceiveVideo:!1}){this.publishConnection=new ht(this.signal,i,this.publishConnectionObserver,this),this.subscribeConnection=new Rt(this.signal,i,this.subscribeConnectionObserver);try{Le.d(Hi,"\u23f3 join: Negotiating over PUBLISH connection");let i=yield this.publishConnection.createOffer(r,new Map);yield this.publishConnection.setLocalDescription(i);let s=yield this.signal.join(e,t,i,!n);yield this.publishConnection.setRemoteDescription(s);for(let e of this.publishConnection.candidates||[])yield this.publishConnection.addIceCandidate(e);this.publishConnection.initAfterJoin(),yield this.initRtcStatsMonitor(),Le.d(Hi,"\u2705 join: Negotiated over PUBLISH connection")}catch(s){throw this.state=_i.Failed,s}}))}performPublishRenegotiation(e){return De(this,null,(function*(){Le.d(Hi,"\u23f3 [role=PUBLISH] onRenegotiationNeeded START",this.trackStates);let t=this.callbacks.get(it);if(t)try{let i=yield this.publishConnection.createOffer(e,this.trackStates);yield this.publishConnection.setLocalDescription(i),Le.time("renegotiation-offer-exchange");let n=yield this.signal.offer(i,this.trackStates);this.callbacks.delete(it),Le.timeEnd("renegotiation-offer-exchange"),yield this.publishConnection.setRemoteDescription(n),t.promise.resolve(!0),Le.d(Hi,"[role=PUBLISH] onRenegotiationNeeded DONE \u2705")}catch(vt){let i;i=vt instanceof Ge?vt:je.GenericErrors.Unknown(xe.PUBLISH,vt.message),t.promise.reject(i),Le.d(Hi,"[role=PUBLISH] onRenegotiationNeeded FAILED \u274c")}}))}handleIceConnectionFailure(e){return De(this,null,(function*(){e===Oe.Publish?this.retryScheduler.schedule(Ni.PublishIceConnectionFailed,je.WebrtcErrors.ICEFailure(xe.PUBLISH),this.retryPublishIceFailedTask):this.retryScheduler.schedule(Ni.SubscribeIceConnectionFailed,je.WebrtcErrors.ICEFailure(xe.SUBSCRIBE),this.retrySubscribeIceFailedTask,1)}))}internalConnect(e,t,i){return De(this,null,(function*(){Le.d(Hi,"connect: started \u23f0");let n=new Date;try{this.initConfig=yield class{static fetchInitConfig(e,t,i="https://prod-init.100ms.live",n=""){return De(this,null,(function*(){Le.d(Lt,`fetchInitConfig: initEndpoint=${i} token=${e} peerId=${t} region=${n} `);let r,s,o=function(e,t,n){try{let i=new URL("/init",e);return n&&n.trim().length>0&&i.searchParams.set("region",n.trim()),i.searchParams.set("peer_id",t),i.searchParams.set("user_agent",Nt),i.toString()}catch(i){let t=i;throw Le.e(Lt,t.name,t.message),t}}(i,t,n);try{r=yield fetch(o,{headers:{Authorization:`Bearer ${e}`}});let t=yield r.json();if(404===r.status)throw je.InitAPIErrors.EndpointUnreachable(xe.INIT,t.message||r.statusText);if(200!==(null==r?void 0:r.status))throw je.InitAPIErrors.ServerErrors(t.code||r.status,xe.INIT,t.message||(null==r?void 0:r.statusText));s=t,Le.d(Lt,`config is ${JSON.stringify(s,null,2)}`)}catch(Te){let t=Te;throw"Failed to fetch"===t.message||t.message.includes("NetworkError")?je.InitAPIErrors.EndpointUnreachable(xe.INIT,t.message):t}return _e(Ae({},a=s),{rtcConfiguration:_e(Ae({},a.rtcConfiguration),{iceServers:a.rtcConfiguration.ice_servers})});var a}))}}.fetchInitConfig(e,i,t),yield this.openSignal(e,i),Le.d(Hi,"Adding Analytics Transport: JsonRpcSignal"),ai.addTransport(this.analyticsSignalTransport),ai.flush()}catch(r){throw r instanceof Ge&&ai.queue(Pi.connect(r,n,new Date,t)).flush(),Le.d(Hi,"\u274c internal connect: failed",r),r}}))}openSignal(e,t){return De(this,null,(function*(){if(!this.initConfig)throw je.WebSocketConnectionErrors.GenericConnect(xe.INIT,"Init Config not found");Le.d(Hi,"\u23f3 internal connect: connecting to ws endpoint",this.initConfig.endpoint);let i=new URL(this.initConfig.endpoint);i.searchParams.set("peer",t),i.searchParams.set("token",e),i.searchParams.set("user_agent",Nt),this.endpoint=i.toString(),yield this.signal.open(this.endpoint),Le.d(Hi,"\u2705 internal connect: connected to ws endpoint")}))}initRtcStatsMonitor(){return De(this,null,(function*(){var e,t,i,n;null==(i=this.webrtcInternals)||i.setPeerConnections({publish:null==(e=this.publishConnection)?void 0:e.nativeConnection,subscribe:null==(t=this.subscribeConnection)?void 0:t.nativeConnection}),this.store.getSubscribeDegradationParams()&&(this.trackDegradationController=new class{constructor(e,t){this.store=e,this.eventBus=t,this.TAG="[TrackDegradationController]",this.MAX_RECOVER_GRACE_PERIOD=120,this.recoverAttemptCount=0,this.packetsLost=0;let i=this.store.getSubscribeDegradationParams();this.PACKETS_LOST_THRESHOLD=i.packetLossThreshold,this.MIN_DEGRADE_GRACE_PERIOD=i.degradeGracePeriodSeconds,this.MIN_RECOVER_GRACE_PERIOD=i.recoverGracePeriodSeconds,this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}get isAttemptingRecover(){return Boolean(this.recoveringTrack)}handleRtcStatsChange(e){let t=e>this.packetsLost+this.PACKETS_LOST_THRESHOLD;this.packetsLost=e,t?this.degrade():this.recover()}degrade(){if(!(this.degradeGracePeriod>0))return this.isAttemptingRecover?this.cancelRecovery():(Le.d(this.TAG,"Packet loss increased, Degrading",{packetsLost:this.packetsLost}),this.degradeActiveTracksByHalf(),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,void(this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD));this.degradeGracePeriod--}recover(){this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod>0?this.recoverGracePeriod--:(this.recoveringTrack=this.getActiveTracks(!0).find((e=>e.degraded)),this.recoveringTrack&&(Le.d(this.TAG,"Packet lost stable, recovering track",this.recoveringTrack),this.recoveringTrack.setDegraded(!1),this.eventBus.trackRestored.publish(this.recoveringTrack),this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD))}cleanUp(){this.eventBus.trackDegraded.removeAllListeners(),this.eventBus.trackRestored.removeAllListeners()}degradeActiveTracksByHalf(){let e=this.getActiveTracks(!1);if(!e.length)return;Le.d(this.TAG,{activeTracks:[...e]});let t=Math.ceil(e.length/2);for(;t--;){let t=e.pop();t.setDegraded(!0),this.eventBus.trackDegraded.publish(t)}}getActiveTracks(e){return this.store.getRemoteVideoTracks().filter((t=>t.hasSinks()&&(!t.degraded||e))).sort(((e,t)=>{let i=this.store.getComparator().getTrackComparators();return-1*(i.screenShare(e,t)||i.rolePriority(e,t)||i.peerAudioLevel(e,t)||this.store.getComparator().stringComparator(e.trackId,t.trackId))})).slice(0)}cancelRecovery(){this.recoveringTrack&&(this.recoveringTrack.setDegraded(!0),this.eventBus.trackDegraded.publish(this.recoveringTrack)),this.recoveringTrack=void 0,this.recoverAttemptCount++,this.recoverGracePeriod=this.getDelayForRecoverCount(this.recoverAttemptCount),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,Le.d(this.TAG,"Recover Attempt Failed",{count:this.recoverAttemptCount,delay:this.recoverGracePeriod})}getDelayForRecoverCount(e){let t=this.MIN_RECOVER_GRACE_PERIOD+this.MIN_RECOVER_GRACE_PERIOD*e;return Math.min(t,this.MAX_RECOVER_GRACE_PERIOD)}}(this.store,this.eventBus),this.eventBus.statsUpdate.subscribe((e=>{var t,i,n;null==(n=this.trackDegradationController)||n.handleRtcStatsChange((null==(i=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:i.packetsLost)||0)})),this.eventBus.trackDegraded.subscribe((e=>{ai.queue(Pi.degradationStats(e,!0)).flush(),this.observer.onTrackDegrade(e)})),this.eventBus.trackRestored.subscribe((e=>{ai.queue(Pi.degradationStats(e,!1)).flush(),this.observer.onTrackRestore(e)}))),yield null==(n=this.webrtcInternals)?void 0:n.start()}))}setTransportStateForJoin(){if(this.state===_i.Failed&&(this.state=_i.Disconnected),this.state!==_i.Disconnected&&this.state!==_i.Reconnecting)throw je.WebsocketMethodErrors.AlreadyJoined(xe.JOIN,`Cannot join a meeting in ${this.state}`);this.state===_i.Disconnected&&(this.state=_i.Connecting,this.observer.onStateChange(this.state))}}(this.observer,this.deviceManager,this.store,this.localTrackManager,this.eventBus)}validateJoined(e){if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,`Not connected - ${e}`)}getWebrtcInternals(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}getPlaylistManager(){return this.playlistManager}getRecordingState(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}getRTMPState(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}getHLSState(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}get localPeer(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}preview(e,t){return De(this,null,(function*(){return He(),Ke(),this.sdkState.isPreviewInProgress?Promise.reject(je.GenericErrors.PreviewAlreadyInProgress(xe.PREVIEW,"Preview already called")):(this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then((()=>De(this,null,(function*(){yield this.initDeviceManagers()})))),new Promise(((i,n)=>{let r=()=>De(this,null,(function*(){var n;this.notificationManager.removeEventListener("policy-change",r);let s=yield this.localTrackManager.getTracksToPublish(e.settings||nn);s.forEach((e=>this.setLocalPeerTrack(e))),(null==(n=this.localPeer)?void 0:n.audioTrack)&&this.initPreviewTrackAudioLevelMonitor(),yield this.initDeviceManagers(),t.onPreview(this.store.getRoom(),s),this.sdkState.isPreviewInProgress=!1,i()}));this.notificationManager.addEventListener("policy-change",r),this.transport.connect(e.authToken,e.initEndpoint||"https://prod-init.100ms.live/init",this.localPeer.peerId).catch((e=>{var t;null==(t=this.errorListener)||t.onError(e),this.sdkState.isPreviewInProgress=!1,n(e)}))})))}))}join(e,t){var i,n;if(He(),Ke(),this.sdkState.isPreviewInProgress)throw je.GenericErrors.NotReady(xe.JOIN,"Preview is in progress, can't join");let{roomId:r,userId:s,role:o}=Wi(e.authToken);null==(n=null==(i=this.localPeer)?void 0:i.audioTrack)||n.destroyAudioLevelMonitor(),this.listener=t,this.commonSetup(e,r,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(o),this.localPeer.customerUserId=s,this.localPeer.metadata=e.metaData||""):(this.notificationManager.addEventListener("role-change",(e=>{this.store.setPublishParams(e.detail.params.role.publishParams)})),this.createAndAddLocalPeerToStore(e,o,s)),this.roleChangeManager=new class{constructor(e,t,i,n,r){this.store=e,this.transport=t,this.publish=i,this.removeAuxillaryTrack=n,this.listener=r,this.handleLocalPeerRoleUpdate=e=>De(this,null,(function*(){var t,i;let n=this.store.getLocalPeer();if(!n)return;let r=e.detail.oldRole,s=e.detail.newRole,o=r.publishParams.allowed||[],a=s.publishParams.allowed||[],l={removeVideo:!1,removeAudio:!1,removeScreen:!1};o.length>0&&(0===a.length?(l.removeVideo=!0,l.removeAudio=!0,l.removeScreen=!0):(o.includes("video")&&!a.includes("video")&&(l.removeVideo=!0),o.includes("audio")&&!a.includes("audio")&&(l.removeAudio=!0),o.includes("screen")&&!a.includes("screen")&&(l.removeScreen=!0))),yield this.removeLocalTracks(l),this.store.setPublishParams(s.publishParams);let c=(null==(t=this.store.getConfig())?void 0:t.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"};yield this.publish(_e(Ae({},c),{isAudioMuted:!0,isVideoMuted:!0})),null==(i=this.listener)||i.onPeerUpdate(qe.ROLE_UPDATED,n)}))}removeLocalTracks(e){return De(this,arguments,(function*({removeVideo:e,removeAudio:t,removeScreen:i}){var n;let r=this.store.getLocalPeer();if(!r)return;let s=[];(null==r?void 0:r.videoTrack)&&e&&(s.push(r.videoTrack),r.videoTrack=void 0),(null==r?void 0:r.audioTrack)&&t&&(s.push(r.audioTrack),r.audioTrack=void 0),yield this.transport.unpublish(s);for(let o of s)null==(n=this.listener)||n.onTrackUpdate(ze.TRACK_REMOVED,o,r);if(r.auxiliaryTracks&&i){let e=[...r.auxiliaryTracks];for(let t of e)"screen"===t.source&&(yield this.removeAuxillaryTrack(t.trackId))}}))}}(this.store,this.transport,this.publish.bind(this),this.removeTrack.bind(this),this.listener),this.notificationManager.addEventListener("local-peer-role-update",this.roleChangeManager.handleLocalPeerRoleUpdate),Le.d(this.TAG,"SDK Store",this.store),Le.d(this.TAG,`\u23f3 Joining room ${r}`),Le.time(`join-room-${r}`),this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.initEndpoint,e.autoVideoSubscribe).then((()=>De(this,null,(function*(){Le.d(this.TAG,`\u2705 Joined room ${r}`),this.notifyJoin(),this.publishParams&&!this.sdkState.published&&!_t&&(yield this.publish(e.settings||nn))})))).catch((e=>{var t;null==(t=this.listener)||t.onError(e),Le.e(this.TAG,"Unable to join room",e)})).then((()=>{Le.timeEnd(`join-room-${r}`)}))}stringifyMetadata(e){e.metaData&&"string"!=typeof e.metaData&&JSON.stringify(e.metaData)}cleanUp(){var e,t;this.store.cleanUp(),this.cleanDeviceManagers(),ui.cleanup(),this.playlistManager.cleanup(),Le.cleanUp(),this.sdkState=Ae({},rn),this.localPeer&&(null==(e=this.localPeer.audioTrack)||e.cleanup(),this.localPeer.audioTrack=void 0,null==(t=this.localPeer.videoTrack)||t.cleanup(),this.localPeer.videoTrack=void 0),this.listener=void 0,this.roleChangeManager&&this.notificationManager.removeEventListener("local-peer-role-update",this.roleChangeManager.handleLocalPeerRoleUpdate)}leave(){return De(this,null,(function*(){var e;let t=this.store.getRoom();if(t){let i=t.id;Le.d(this.TAG,`\u23f3 Leaving room ${i}`),yield null==(e=this.transport)?void 0:e.leave(),this.cleanUp(),Le.d(this.TAG,`\u2705 Left room ${i}`)}}))}getLocalPeer(){return this.store.getLocalPeer()}getPeers(){let e=this.store.getPeers();return Le.d(this.TAG,"Got peers",e),e}getAudioOutput(){return this.audioOutput}sendMessage(e,t){this.sendMessageInternal({message:t,type:e})}sendBroadcastMessage(e,t){return De(this,null,(function*(){return yield this.sendMessageInternal({message:e,type:t})}))}sendGroupMessage(e,t,i){return De(this,null,(function*(){let n=this.store.getKnownRoles();if(0===(t.filter((e=>n[e.name]))||[]).length)throw je.GenericErrors.ValidationFailed("No valid role is present",t);return yield this.sendMessageInternal({message:e,recipientRoles:t,type:i})}))}sendDirectMessage(e,t,i){return De(this,null,(function*(){var n;if(!this.store.getPeerById(t.peerId))throw je.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);if((null==(n=this.localPeer)?void 0:n.peerId)===t.peerId)throw je.GenericErrors.ValidationFailed("Cannot send message to self");return yield this.sendMessageInternal({message:e,recipientPeer:t,type:i})}))}sendMessageInternal(e){return De(this,arguments,(function*({recipientRoles:e,recipientPeer:t,type:i="chat",message:n}){if(""===n.replace(/\u200b/g," ").trim())throw Le.w(this.TAG,"sendMessage","Ignoring empty message send"),je.GenericErrors.ValidationFailed("Empty message not allowed");let r=new Kt({sender:this.localPeer,type:i,message:n,recipientPeer:t,recipientRoles:e,time:new Date});return Le.d(this.TAG,"Sending Message:: ",r),yield this.transport.sendMessage(r),r}))}startScreenShare(e,t=!1){return De(this,null,(function*(){var i,n,r;let s=this.publishParams;if(!s)return;let{allowed:o}=s;if(!o||!o.includes("screen"))return void Le.e(this.TAG,`Role ${null==(i=this.localPeer)?void 0:i.role} cannot share screen`);if(null==(r=null==(n=this.localPeer)?void 0:n.auxiliaryTracks)?void 0:r.find((e=>"screen"===e.source)))throw Error("Cannot share multiple screens");let a=yield this.getScreenshareTracks(s,e,t);yield this.transport.publish(a),a.forEach((e=>{var t,i,n;e.peerId=null==(t=this.localPeer)?void 0:t.peerId,null==(i=this.localPeer)||i.auxiliaryTracks.push(e),null==(n=this.listener)||n.onTrackUpdate(ze.TRACK_ADDED,e,this.localPeer)}))}))}stopEndedScreenshare(e){return De(this,null,(function*(){Le.d(this.TAG,"\u2705 Screenshare ended natively"),yield this.stopScreenShare(),e()}))}stopScreenShare(){return De(this,null,(function*(){var e;Le.d(this.TAG,"\u2705 Screenshare ended from app");let t=null==(e=this.localPeer)?void 0:e.auxiliaryTracks.filter((e=>"screen"===e.source));if(t)for(let i of t)yield this.removeTrack(i.trackId)}))}addTrack(e,t="regular"){return De(this,null,(function*(){var i,n,r,s;if(!e)return void Le.w(this.TAG,"Please pass a valid MediaStreamTrack");if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot addTrack");if(this.localPeer.auxiliaryTracks.find((t=>t.trackId===e.id)))return;let o=e.kind,a=new MediaStream([e]),l=new ki(a),c=new("audio"===o?vi:Oi)(l,e,t,this.eventBus);this.setPlaylistSettings({track:e,hmsTrack:c,source:t}),yield null==(i=this.transport)?void 0:i.publish([c]),c.peerId=null==(n=this.localPeer)?void 0:n.peerId,null==(r=this.localPeer)||r.auxiliaryTracks.push(c),null==(s=this.listener)||s.onTrackUpdate(ze.TRACK_ADDED,c,this.localPeer)}))}removeTrack(e){return De(this,null,(function*(){var t;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot removeTrack");let i=this.localPeer.auxiliaryTracks.findIndex((t=>t.trackId===e));if(i>-1){let e=this.localPeer.auxiliaryTracks[i];yield this.transport.unpublish([e]),this.localPeer.auxiliaryTracks.splice(i,1),null==(t=this.listener)||t.onTrackUpdate(ze.TRACK_REMOVED,e,this.localPeer)}else Le.w(this.TAG,`No track found for ${e}`)}))}setAnalyticsLevel(e){ai.level=e}setLogLevel(e){Le.level=e}addAudioListener(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}changeRole(e,t,i=!1){return De(this,null,(function*(){var n;!e.role||e.role.name===t||(yield null==(n=this.transport)?void 0:n.changeRole(e,t,i))}))}acceptChangeRole(e){return De(this,null,(function*(){var t;yield null==(t=this.transport)?void 0:t.acceptRoleChange(e)}))}endRoom(e,t){return De(this,null,(function*(){var i;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot end room");yield null==(i=this.transport)?void 0:i.endRoom(e,t),yield this.leave()}))}removePeer(e,t){return De(this,null,(function*(){var i;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot remove peer");if(!this.store.getPeerById(e.peerId))throw je.GenericErrors.ValidationFailed("Invalid peer, given peer not present in room",e);yield null==(i=this.transport)?void 0:i.removePeer(e.peerId,t)}))}startRTMPOrRecording(e){return De(this,null,(function*(){var t;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot start streaming or recording");yield null==(t=this.transport)?void 0:t.startRTMPOrRecording(e)}))}stopRTMPAndRecording(){return De(this,null,(function*(){var e;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot stop streaming or recording");yield null==(e=this.transport)?void 0:e.stopRTMPOrRecording()}))}startHLSStreaming(e){return De(this,null,(function*(){var t;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot start HLS streaming");yield null==(t=this.transport)?void 0:t.startHLSStreaming(e)}))}stopHLSStreaming(e){return De(this,null,(function*(){var t;if(!this.localPeer)throw je.GenericErrors.NotConnected(xe.VALIDATION,"No local peer present, cannot stop HLS streaming");yield null==(t=this.transport)?void 0:t.stopHLSStreaming(e)}))}changeName(e){return De(this,null,(function*(){var t;this.validateJoined("changeName"),yield null==(t=this.transport)?void 0:t.changeName(e),this.notificationManager.updateLocalPeer({name:e})}))}changeMetadata(e){return De(this,null,(function*(){var t;this.validateJoined("changeMetadata"),yield null==(t=this.transport)?void 0:t.changeMetadata(e),this.notificationManager.updateLocalPeer({metadata:e})}))}getRoles(){return Object.values(this.store.getKnownRoles())}changeTrackState(e,t){return De(this,null,(function*(){var i;if(e.type===Tt.VIDEO&&"regular"!==e.source)return void Le.w(this.TAG,"Muting non-regular video tracks is currently not supported");if(e.enabled===t)return void Le.w(this.TAG,`Aborting change track state, track already has enabled - ${t}`,e);if(!this.store.getTrackById(e.trackId))throw je.GenericErrors.ValidationFailed("No track found for change track state",e);let n=this.store.getPeerByTrackId(e.trackId);if(!n)throw je.GenericErrors.ValidationFailed("No peer found for change track state",e);yield null==(i=this.transport)?void 0:i.changeTrackState({requested_for:n.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t})}))}changeMultiTrackState(e){return De(this,null,(function*(){var t;if("boolean"!=typeof e.enabled)throw je.GenericErrors.ValidationFailed("Pass a boolean for enabled");let{enabled:i,roles:n,type:r,source:s}=e;yield null==(t=this.transport)?void 0:t.changeMultiTrackState({value:!i,type:r,source:s,roles:null==n?void 0:n.map((e=>null==e?void 0:e.name))})}))}publish(e){return De(this,null,(function*(){let t=yield this.localTrackManager.getTracksToPublish(e);yield this.setAndPublishTracks(t),this.sdkState.published=!0}))}setAndPublishTracks(e){return De(this,null,(function*(){var t;for(let i of e)yield this.transport.publish([i]),this.setLocalPeerTrack(i),null==(t=this.listener)||t.onTrackUpdate(ze.TRACK_ADDED,i,this.localPeer);yield this.initDeviceManagers()}))}setLocalPeerTrack(e){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case Tt.AUDIO:this.localPeer.audioTrack=e;break;case Tt.VIDEO:this.localPeer.videoTrack=e}}initDeviceManagers(){return De(this,null,(function*(){var e,t,i;this.sdkState.deviceManagersInitialised||(this.sdkState.deviceManagersInitialised=!0,this.eventBus.deviceChange.subscribe(this.handleDeviceChange),yield this.deviceManager.init(),this.deviceManager.updateOutputDevice(null==(t=null==(e=ui.getSelection())?void 0:e.audioOutput)?void 0:t.deviceId),this.audioSinkManager.init(null==(i=this.store.getConfig())?void 0:i.audioSinkElementId))}))}cleanDeviceManagers(){this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.deviceManager.cleanUp(),this.audioSinkManager.removeEventListener($i,this.handleAutoplayError),this.audioSinkManager.cleanUp()}initPreviewTrackAudioLevelMonitor(){var e,t;null==(t=null==(e=this.localPeer)?void 0:e.audioTrack)||t.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe((e=>{var t,i,n,r;let s=e&&e.track.trackId===(null==(i=null==(t=this.localPeer)?void 0:t.audioTrack)?void 0:i.trackId)?[{audioLevel:e.audioLevel,peer:this.localPeer,track:null==(n=this.localPeer)?void 0:n.audioTrack}]:[];this.store.updateSpeakers(s),null==(r=this.audioListener)||r.onAudioLevelUpdate(s)}))}get publishParams(){var e;return null==(e=this.store)?void 0:e.getPublishParams()}notifyJoin(){var e;let t=this.store.getLocalPeer();(null==t?void 0:t.role)?null==(e=this.listener)||e.onJoin(this.store.getRoom()):this.notificationManager.once("policy-change",(()=>{var e;null==(e=this.listener)||e.onJoin(this.store.getRoom())}))}setUpPreview(e,t){this.listener=t,this.sdkState.isPreviewInProgress=!0;let{roomId:i,userId:n,role:r}=Wi(e.authToken);this.commonSetup(e,i,t),this.store.setConfig(e),this.createAndAddLocalPeerToStore(e,r,n),Le.d(this.TAG,"SDK Store",this.store)}setPlaylistSettings(e){return De(this,arguments,(function*({track:e,hmsTrack:t,source:i}){if("videoplaylist"===i){let i={};if("audio"===e.kind)i.maxBitrate=64;else{i.maxBitrate=1e3;let{width:t,height:n}=e.getSettings();i.width=t,i.height=n}yield t.setSettings(i)}else"audioplaylist"===i&&(yield t.setSettings({maxBitrate:64}))}))}createAndAddLocalPeerToStore(e,t,i){let n=this.store.getPolicyForRole(t),r=new qt({name:e.userName||"",customerUserId:i,metadata:e.metaData||"",role:n});this.store.addPeer(r)}commonSetup(e,t,i){this.stringifyMetadata(e),this.errorListener=i,this.deviceChangeListener=i,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new class{constructor(e,t){this.id=e,this.store=t,this.recording={server:{running:!1},browser:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}get localPeer(){return this.store.getLocalPeer()}get peers(){return this.store.getPeers()}}(t,this.store))}removeDevicesFromConfig(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}getScreenshareTracks(e,t,i){return De(this,null,(function*(){let{screen:n}=e,r=this.store.getSimulcastDimensions("screen"),[s,o]=yield this.transport.getLocalScreen((new Gt).maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth((null==r?void 0:r.width)||n.width).setHeight((null==r?void 0:r.height)||n.height).build(),(new Ut).build()),a=()=>{this.stopEndedScreenshare(t)},l=[];if(i){if(s.nativeTrack.stop(),!o)throw Error("Select share audio when sharing screen");l.push(o),o.nativeTrack.onended=a}else l.push(s),s.nativeTrack.onended=a,o&&l.push(o);return l}))}};Le.i("adapter",`${le.browserDetails.browser} v${le.browserDetails.version}`)},1704:function(e,t,i){"use strict";i.d(t,{dx:function(){return Ue},Bv:function(){return Ke},jS:function(){return Qe},cw:function(){return je},C1:function(){return Ve},_U:function(){return Fe},RY:function(){return He},ig:function(){return Ye}});var n=i(7294),r=i(6954);function s(e){let t;const i=new Set,n=(e,n)=>{const r="function"===typeof e?e(t):e;if(r!==t){const e=t;t=n?r:Object.assign({},t,r),i.forEach((i=>i(t,e)))}},r=()=>t,s={setState:n,getState:r,subscribe:(e,n,s)=>n||s?((e,n=r,s=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let o=n(t);function a(){const i=n(t);if(!s(o,i)){const t=o;e(o=i,t)}}return i.add(a),()=>i.delete(a)})(e,n,s):(i.add(e),()=>i.delete(e)),destroy:()=>i.clear()};return t=e(n,r,s),s}const o="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?n.useEffect:n.useLayoutEffect;function a(e){const t="function"===typeof e?s(e):e,i=(e=t.getState,i=Object.is)=>{const[,r]=(0,n.useReducer)((e=>e+1),0),s=t.getState(),a=(0,n.useRef)(s),l=(0,n.useRef)(e),c=(0,n.useRef)(i),d=(0,n.useRef)(!1),u=(0,n.useRef)();let h;void 0===u.current&&(u.current=e(s));let p=!1;(a.current!==s||l.current!==e||c.current!==i||d.current)&&(h=e(s),p=!i(u.current,h)),o((()=>{p&&(u.current=h),a.current=s,l.current=e,c.current=i,d.current=!1}));const f=(0,n.useRef)(s);o((()=>{const e=()=>{try{const e=t.getState(),i=l.current(e);c.current(u.current,i)||(a.current=e,u.current=i,r())}catch(e){d.current=!0,r()}},i=t.subscribe(e);return t.getState()!==f.current&&e(),i}),[]);const v=p?h:u.current;return(0,n.useDebugValue)(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[i,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},i}function l(e,t){if(Object.is(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;for(let n=0;n<i.length;n++)if(!Object.prototype.hasOwnProperty.call(t,i[n])||!Object.is(e[i[n]],t[i[n]]))return!1;return!0}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=new Map,h=new WeakMap,p=0,f=void 0;function v(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?function(e){return e?(h.has(e)||(p+=1,h.set(e,p.toString())),h.get(e)):"0"}(e.root):e[t])})).toString()}function g(e,t,i,n){if(void 0===i&&(i={}),void 0===n&&(n=f),"undefined"===typeof window.IntersectionObserver&&void 0!==n){var r=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:"number"===typeof i.threshold?i.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),function(){}}var s=function(e){var t=v(e),i=u.get(t);if(!i){var n,r=new Map,s=new IntersectionObserver((function(t){t.forEach((function(t){var i,s=t.isIntersecting&&n.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=s),null==(i=r.get(t.target))||i.forEach((function(e){e(s,t)}))}))}),e);n=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:r},u.set(t,i)}return i}(i),o=s.id,a=s.observer,l=s.elements,c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(t),a.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(l.delete(e),a.unobserve(e)),0===l.size&&(a.disconnect(),u.delete(o))}}var m=["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function y(e){return"function"!==typeof e.children}var T=function(e){var t,i;function r(t){var i;return(i=e.call(this,t)||this).node=null,i._unobserveCb=null,i.handleNode=function(e){i.node&&(i.unobserve(),e||i.props.triggerOnce||i.props.skip||i.setState({inView:!!i.props.initialInView,entry:void 0})),i.node=e||null,i.observeNode()},i.handleChange=function(e,t){e&&i.props.triggerOnce&&i.unobserve(),y(i.props)||i.setState({inView:e,entry:t}),i.props.onChange&&i.props.onChange(e,t)},i.state={inView:!!t.initialInView,entry:void 0},i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,d(t,i);var s=r.prototype;return s.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},s.componentWillUnmount=function(){this.unobserve(),this.node=null},s.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,i=e.root,n=e.rootMargin,r=e.trackVisibility,s=e.delay,o=e.fallbackInView;this._unobserveCb=g(this.node,this.handleChange,{threshold:t,root:i,rootMargin:n,trackVisibility:r,delay:s},o)}},s.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},s.render=function(){if(!y(this.props)){var e=this.state,t=e.inView,i=e.entry;return this.props.children({inView:t,entry:i,ref:this.handleNode})}var r=this.props,s=r.children,o=r.as,a=r.tag,l=function(e,t){if(null==e)return{};var i,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(r,m);return n.createElement(o||a||"div",c({ref:this.handleNode},l),s)},r}(n.Component);T.displayName="InView",T.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var E=i(3935),S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};function b(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var k=function(){return(k=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function P(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}var C="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof i.g?i.g:"undefined"!==typeof self?self:{};var w=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},R="object"==typeof C&&C&&C.Object===Object&&C,I="object"==typeof self&&self&&self.Object===Object&&self,A=R||I||Function("return this")(),_=A,D=function(){return _.Date.now()},O=/\s/;var M=function(e){for(var t=e.length;t--&&O.test(e.charAt(t)););return t},N=/^\s+/;var L=function(e){return e?e.slice(0,M(e)+1).replace(N,""):e},x=A.Symbol,U=x,F=Object.prototype,G=F.hasOwnProperty,j=F.toString,V=U?U.toStringTag:void 0;var B=function(e){var t=G.call(e,V),i=e[V];try{e[V]=void 0;var n=!0}catch(s){}var r=j.call(e);return n&&(t?e[V]=i:delete e[V]),r},K=Object.prototype.toString;var H=B,W=function(e){return K.call(e)},$=x?x.toStringTag:void 0;var q=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":$&&$ in Object(e)?H(e):W(e)},J=function(e){return null!=e&&"object"==typeof e};var z=L,Y=w,Q=function(e){return"symbol"==typeof e||J(e)&&"[object Symbol]"==q(e)},X=/^[-+]0x[0-9a-f]+$/i,Z=/^0b[01]+$/i,ee=/^0o[0-7]+$/i,te=parseInt;var ie=w,ne=D,re=function(e){if("number"==typeof e)return e;if(Q(e))return NaN;if(Y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=z(e);var i=Z.test(e);return i||ee.test(e)?te(e.slice(2),i?2:8):X.test(e)?NaN:+e},se=Math.max,oe=Math.min;var ae=function(e,t,i){var n,r,s,o,a,l,c=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,s=r;return n=r=void 0,c=t,o=e.apply(s,i)}function f(e){return c=e,a=setTimeout(g,t),d?p(e):o}function v(e){var i=e-l;return void 0===l||i>=t||i<0||u&&e-c>=s}function g(){var e=ne();if(v(e))return m(e);a=setTimeout(g,function(e){var i=t-(e-l);return u?oe(i,s-(e-c)):i}(e))}function m(e){return a=void 0,h&&n?p(e):(n=r=void 0,o)}function y(){var e=ne(),i=v(e);if(n=arguments,r=this,l=e,i){if(void 0===a)return f(l);if(u)return clearTimeout(a),a=setTimeout(g,t),p(l)}return void 0===a&&(a=setTimeout(g,t)),o}return t=re(t)||0,ie(i)&&(d=!!i.leading,s=(u="maxWait"in i)?se(re(i.maxWait)||0,t):s,h="trailing"in i?!!i.trailing:h),y.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=l=r=a=void 0},y.flush=function(){return void 0===a?o:m(ne())},y},le=ae,ce=w;var de=function(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ce(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),le(e,t,{leading:n,maxWait:t,trailing:r})},ue=function(e,t,i,n){switch(t){case"debounce":return ae(e,i,n);case"throttle":return de(e,i,n);default:return e}},he=function(e){return"function"===typeof e},pe=function(){return"undefined"===typeof window},fe=function(e){return e instanceof Element||e instanceof HTMLDocument},ve=function(e,t,i,n){return function(r){var s=r.width,o=r.height;t((function(t){return t.width===s&&t.height===o||t.width===s&&!n||t.height===o&&!i?t:(e&&he(e)&&e(s,o),{width:s,height:o})}))}};!function(e){function t(t){var i=e.call(this,t)||this;i.cancelHandler=function(){i.resizeHandler&&i.resizeHandler.cancel&&(i.resizeHandler.cancel(),i.resizeHandler=null)},i.attachObserver=function(){var e=i.props,t=e.targetRef,n=e.observerOptions;if(!pe()){t&&t.current&&(i.targetRef.current=t.current);var r=i.getElement();r&&(i.observableElement&&i.observableElement===r||(i.observableElement=r,i.resizeObserver.observe(r,n)))}},i.getElement=function(){var e=i.props,t=e.querySelector,n=e.targetDomEl;if(pe())return null;if(t)return document.querySelector(t);if(n&&fe(n))return n;if(i.targetRef&&fe(i.targetRef.current))return i.targetRef.current;var r=(0,E.findDOMNode)(i);if(!r)return null;switch(i.getRenderType()){case"renderProp":case"childFunction":case"child":case"childArray":return r;default:return r.parentElement}},i.createResizeHandler=function(e){var t=i.props,n=t.handleWidth,r=void 0===n||n,s=t.handleHeight,o=void 0===s||s,a=t.onResize;if(r||o){var l=ve(a,i.setState.bind(i),r,o);e.forEach((function(e){var t=e&&e.contentRect||{},n=t.width,r=t.height;!i.skipOnMount&&!pe()&&l({width:n,height:r}),i.skipOnMount=!1}))}},i.getRenderType=function(){var e=i.props,t=e.render,r=e.children;return he(t)?"renderProp":he(r)?"childFunction":(0,n.isValidElement)(r)?"child":Array.isArray(r)?"childArray":"parent"};var r=t.skipOnMount,s=t.refreshMode,o=t.refreshRate,a=void 0===o?1e3:o,l=t.refreshOptions;return i.state={width:void 0,height:void 0},i.skipOnMount=r,i.targetRef=(0,n.createRef)(),i.observableElement=null,pe()||(i.resizeHandler=ue(i.createResizeHandler,s,a,l),i.resizeObserver=new window.ResizeObserver(i.resizeHandler)),i}b(t,e),t.prototype.componentDidMount=function(){this.attachObserver()},t.prototype.componentDidUpdate=function(){this.attachObserver()},t.prototype.componentWillUnmount=function(){pe()||(this.resizeObserver.disconnect(),this.cancelHandler())},t.prototype.render=function(){var e,t=this.props,i=t.render,r=t.children,s=t.nodeType,o=void 0===s?"div":s,a=this.state,l={width:a.width,height:a.height,targetRef:this.targetRef};switch(this.getRenderType()){case"renderProp":return i&&i(l);case"childFunction":return(e=r)(l);case"child":if((e=r).type&&"string"===typeof e.type){var c=P(l,["targetRef"]);return(0,n.cloneElement)(e,c)}return(0,n.cloneElement)(e,l);case"childArray":return(e=r).map((function(e){return!!e&&(0,n.cloneElement)(e,l)}));default:return n.createElement(o,null)}}}(n.PureComponent);var ge=pe()?n.useEffect:n.useLayoutEffect;var me,ye,Te=Object.defineProperty,Ee=Object.defineProperties,Se=Object.getOwnPropertyDescriptors,be=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable,Ce=(e,t,i)=>t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,we=(e,t)=>{for(var i in t||(t={}))ke.call(t,i)&&Ce(e,i,t[i]);if(be)for(var i of be(t))Pe.call(t,i)&&Ce(e,i,t[i]);return e},Re=(e,t)=>Ee(e,Se(t)),Ie=(e,t,i)=>new Promise(((n,r)=>{var s=e=>{try{a(i.next(e))}catch(t){r(t)}},o=e=>{try{a(i.throw(e))}catch(t){r(t)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,o);a((i=i.apply(e,t)).next())}));(ye=me||(me={}))[ye.VERBOSE=0]="VERBOSE",ye[ye.DEBUG=1]="DEBUG",ye[ye.INFO=2]="INFO",ye[ye.WARN=3]="WARN",ye[ye.ERROR=4]="ERROR",ye[ye.NONE=5]="NONE";var Ae=class{static v(e,...t){this.log(0,e,...t)}static d(e,...t){this.log(1,e,...t)}static i(e,...t){this.log(2,e,...t)}static w(e,...t){this.log(3,e,...t)}static e(e,...t){this.log(4,e,...t)}static log(e,t,...i){if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:console.log("HMSui-components: ",t,...i);break;case 1:console.debug("HMSui-components: ",t,...i);break;case 2:console.info("HMSui-components: ",t,...i);break;case 3:console.warn("HMSui-components: ",t,...i);break;case 4:console.error("HMSui-components: ",t,...i)}}};Ae.level=0;var _e="It seems like you forgot to add your component within a top level HMSRoomProvider, please refer to 100ms react docs(https://docs.100ms.live/javascript/v2/features/integration#react-hooks) to check on the required steps for using this hook.";var De,Oe,Me,Ne,Le="undefined"!=typeof window,xe=(0,n.createContext)(null),Ue=({children:e,actions:t,store:i,notifications:s,stats:o,isHMSStatsOn:l=!1})=>{if(!De){let e=()=>{throw new Error("modifying store is not allowed")};if(t&&i)De={actions:t,store:a(Re(we({},i),{setState:e,destroy:e}))},s&&(De.notifications=s),o&&(De.statsStore=a({getState:o.getState,subscribe:o.subscribe,setState:e,destroy:e}));else{let t=new r.pE;if(De={actions:t.getActions(),store:a(Re(we({},t.getStore()),{setState:e,destroy:e})),notifications:t.getNotifications()},l){let i=t.getStats();De.statsStore=a({getState:i.getState,subscribe:i.subscribe,setState:e,destroy:e})}}}return(0,n.useEffect)((()=>{Le&&(window.addEventListener("beforeunload",(()=>De.actions.leave())),window.addEventListener("onunload",(()=>De.actions.leave())))}),[]),n.createElement(xe.Provider,{value:De},e)},Fe=(Oe=xe,(e,t=l)=>{e||Ae.w("fetching full store without passing any selector may have a heavy performance impact on your website.");let i=(0,n.useContext)(Oe);if(!i)throw new Error(_e);return i.store(e,t)}),Ge=(function(e){}(xe),()=>{let e=(0,n.useContext)(xe);if(!e)throw new Error(_e);return e.store}),je=()=>{let e=(0,n.useContext)(xe);if(!e)throw new Error(_e);return e.actions},Ve=()=>{let e=(0,n.useContext)(xe),[t,i]=(0,n.useState)(null);if(!e)throw new Error(_e);return(0,n.useEffect)((()=>e.notifications?e.notifications.onNotification((e=>i(e))):void 0),[e.notifications]),t},Be=(e,t)=>Ae.e("react-sdk",t,e),Ke=(e=Be)=>{let t=Fe(r.uX),i=Fe(r.um),s=Fe(r.xf),o=je(),a=(0,n.useCallback)((()=>Ie(void 0,null,(function*(){try{yield o.setLocalAudioEnabled(!t)}catch(i){e(i,"toggleAudio")}}))),[t,o]),l=(0,n.useCallback)((()=>Ie(void 0,null,(function*(){try{yield o.setLocalVideoEnabled(!i)}catch(t){e(t,"toggleVideo")}}))),[i,o]);return{isLocalAudioEnabled:t,isLocalVideoEnabled:i,toggleAudio:(null==s?void 0:s.audio)?a:void 0,toggleVideo:(null==s?void 0:s.video)?l:void 0}};(Ne=Me||(Me={})).videoInput="videoInput",Ne.audioInput="audioInput",Ne.audioOutput="audioOutput";var He=e=>{let t=je(),i=(0,n.useRef)(null),s=Fe((0,r.M)(e)),{ref:o,inView:a}=function(e){var t=void 0===e?{}:e,i=t.threshold,r=t.delay,s=t.trackVisibility,o=t.rootMargin,a=t.root,l=t.triggerOnce,c=t.skip,d=t.initialInView,u=t.fallbackInView,h=n.useRef(),p=n.useState({inView:!!d}),f=p[0],v=p[1],m=n.useCallback((function(e){void 0!==h.current&&(h.current(),h.current=void 0),c||e&&(h.current=g(e,(function(e,t){v({inView:e,entry:t}),t.isIntersecting&&l&&h.current&&(h.current(),h.current=void 0)}),{root:a,rootMargin:o,threshold:i,trackVisibility:s,delay:r},u))}),[Array.isArray(i)?i.toString():i,a,o,l,c,s,u,r]);(0,n.useEffect)((function(){h.current||!f.entry||l||c||v({inView:!!d})}));var y=[m,f.inView,f.entry];return y.ref=y[0],y.inView=y[1],y.entry=y[2],y}({threshold:.5}),l=(0,n.useCallback)((e=>{i.current=e,o(e)}),[o]);return(0,n.useEffect)((()=>{Ie(void 0,null,(function*(){i.current&&s&&(a&&s.enabled?yield t.attachVideo(s.id,i.current):yield t.detachVideo(s.id,i.current))}))}),[a,i,null==s?void 0:s.id,null==s?void 0:s.enabled,null==s?void 0:s.deviceID,null==s?void 0:s.plugins]),(0,n.useEffect)((()=>()=>{Ie(void 0,null,(function*(){if(i.current&&s)try{yield t.detachVideo(s.id,i.current)}catch(e){Ae.w("detach video error for track",s.id,e)}}))}),[]),l},We=({elements:e,tilesInFirstPage:t,onlyOnePage:i,isLastPageDifferentFromFirstPage:n,defaultWidth:r,defaultHeight:s,lastPageWidth:o,lastPageHeight:a})=>{let l=((e,t,i)=>e.reduce(((e,n,r)=>{let s=Math.floor(r/t);return s>0&&i||(e[s]||(e[s]=[]),e[s].push(n)),e}),[]))(e,t,i);return l.map(((e,t)=>e.map((e=>{let i=t===l.length-1,c=n&&i?o:r,d=n&&i?a:s;return Re(we({},e),{height:d,width:c})}))))};var $e=e=>function(e){if(0===e.length)return null;let t={},i=e[0],n=1;for(let r=0;r<e.length;r++){let s=e[r];null===t[s]?t[s]=1:t[s]++,t[s]>n&&(i=s,n=t[s])}return i}(e.filter((e=>{var t,i;return(null==(t=e.track)?void 0:t.width)&&(null==(i=e.track)?void 0:i.height)})).map((e=>{var t,i;return((null==(t=e.track)?void 0:t.width)||1)/((null==(i=e.track)?void 0:i.height)||1)}))),qe=(e,t,i,n,r)=>{if(e<0||t<0)throw new Error("Container must have a non-negative area");if(i<1||!Number.isInteger(i))throw new Error("Number of shapes to place must be a positive integer");let s=n&&r&&n/r;if(void 0!==s&&isNaN(s))throw new Error("Aspect ratio must be a number");let o={area:0,cols:0,rows:0,width:0,height:0};if(void 0!==s)for(let a=i;a>0;a+=-1){let n,r,l=Math.ceil(i/a);e/(a*s)<=t/l?(n=e/a,r=n/s):(r=t/l,n=r*s);let c=n*r;c>o.area&&(o={area:c,width:n,height:r,rows:l,cols:a})}return o};function Je({count:e,parentWidth:t,parentHeight:i,maxTileCount:n,maxRowCount:r,maxColCount:s,aspectRatio:o}){let a=0,l=0,c=0,d=0,u=!1,h=0;if(0===e)return{tilesInFirstPage:h,defaultWidth:a,defaultHeight:l,lastPageWidth:c,lastPageHeight:d,isLastPageDifferentFromFirstPage:u};if(n)({tilesInFirstPage:h,defaultWidth:a,defaultHeight:l,lastPageWidth:c,lastPageHeight:d,isLastPageDifferentFromFirstPage:u}=(({parentWidth:e,parentHeight:t,count:i,maxCount:n,aspectRatio:r})=>{let s=0,o=0,a=0,l=0,c=!1,d=0,u=0,{width:h,height:p}=qe(e,t,Math.min(i,n),r.width,r.height);if(s=h,o=p,d=Math.min(i,n),u=i%n,c=u>0&&i>n,c){let{width:i,height:n}=qe(e,t,u,r.width,r.height);a=i,l=n}return{tilesInFirstPage:d,defaultWidth:s,defaultHeight:o,lastPageWidth:a,lastPageHeight:l,isLastPageDifferentFromFirstPage:c}})({parentWidth:t,parentHeight:i,count:e,maxCount:n,aspectRatio:o}));else if(r)({tilesInFirstPage:h,defaultWidth:a,defaultHeight:l,lastPageWidth:c,lastPageHeight:d,isLastPageDifferentFromFirstPage:u}=(({parentWidth:e,parentHeight:t,count:i,maxCount:n,aspectRatio:r})=>{let s=0,o=0,a=0,l=0,c=!1,d=0,u=0,h=Math.min(Math.ceil(Math.sqrt(i*(r.width/r.height)/(e/t))),n),p=t/h,f=p*(r.width/r.height),v=Math.floor(e/f);if(s=f,o=p,d=Math.min(i,h*v),u=i%(h*v),c=u>0&&i>h*v,c){let i=t/Math.min(Math.ceil(Math.sqrt(u*(r.width/r.height)/(e/t))),n);l=i,a=i*(r.width/r.height)}return{tilesInFirstPage:d,defaultWidth:s,defaultHeight:o,lastPageWidth:a,lastPageHeight:l,isLastPageDifferentFromFirstPage:c}})({parentWidth:t,parentHeight:i,count:e,maxCount:r,aspectRatio:o}));else if(s)({tilesInFirstPage:h,defaultWidth:a,defaultHeight:l,lastPageWidth:c,lastPageHeight:d,isLastPageDifferentFromFirstPage:u}=(({parentWidth:e,parentHeight:t,count:i,maxCount:n,aspectRatio:r})=>{let s=0,o=0,a=0,l=0,c=!1,d=0,u=0,h=Math.min(Math.ceil(Math.sqrt(i*(e/t)/(r.width/r.height))),n),p=e/h,f=p/(r.width/r.height),v=Math.floor(t/f);if(o=f,s=p,d=Math.min(i,v*h),u=i%(v*h),c=u>0&&i>v*h,c){let i=e/Math.min(Math.ceil(Math.sqrt(u*(e/t)/(r.width/r.height))),n);l=i/(r.width/r.height),a=i}return{tilesInFirstPage:d,defaultWidth:s,defaultHeight:o,lastPageWidth:a,lastPageHeight:l,isLastPageDifferentFromFirstPage:c}})({parentWidth:t,parentHeight:i,count:e,maxCount:s,aspectRatio:o}));else{let{width:n,height:r}=qe(t,i,e,o.width,o.height);a=n,l=r,h=e}return{tilesInFirstPage:h,defaultWidth:a,defaultHeight:l,lastPageWidth:c,lastPageHeight:d,isLastPageDifferentFromFirstPage:u}}var ze={width:1,height:1},Ye=({maxTileCount:e,maxColCount:t,maxRowCount:i,showScreenFn:s=(()=>!1),peers:o,overflow:a="scroll-x",aspectRatio:l=ze,filterNonPublishingPeers:c=!0})=>{let{width:d=0,height:u=0,ref:h}=function(e){void 0===e&&(e={});var t=e.skipOnMount,i=void 0!==t&&t,r=e.refreshMode,s=e.refreshRate,o=void 0===s?1e3:s,a=e.refreshOptions,l=e.handleWidth,c=void 0===l||l,d=e.handleHeight,u=void 0===d||d,h=e.targetRef,p=e.observerOptions,f=e.onResize,v=(0,n.useRef)(i),g=(0,n.useRef)(null),m=null!==h&&void 0!==h?h:g,y=(0,n.useRef)(),T=(0,n.useState)({width:void 0,height:void 0}),E=T[0],S=T[1];return ge((function(){if(!pe()){var e=ve(f,S,c,u);y.current=ue((function(t){(c||u)&&t.forEach((function(t){var i=t&&t.contentRect||{},n=i.width,r=i.height;!v.current&&!pe()&&e({width:n,height:r}),v.current=!1}))}),r,o,a);var t=new window.ResizeObserver(y.current);return m.current&&t.observe(m.current,p),function(){t.disconnect();var e=y.current;e&&e.cancel&&e.cancel()}}}),[r,o,a,c,u,f,p,m.current]),k({ref:m},E)}(),p=((e,t,i,n=!0)=>{if(!e||!t||!i)return[];let r=[];for(let s of e)if(void 0===s.videoTrack&&s.audioTrack&&t[s.audioTrack])r.push({peer:s});else if(s.videoTrack&&t[s.videoTrack])r.push({track:t[s.videoTrack],peer:s});else if(i(s)&&s.auxiliaryTracks.length>0){let e=s.auxiliaryTracks.find((e=>{let i=t[e];return"video"===(null==i?void 0:i.type)&&"screen"===(null==i?void 0:i.source)}));e&&r.push({track:t[e],peer:s})}else n||r.push({peer:s});return r})(o,Ge().getState(r.zK),s,c),f=(0,n.useMemo)((()=>l||{width:$e(p)||1,height:1}),[l,p]),v=p.length,{tilesInFirstPage:g,defaultWidth:m,defaultHeight:y,lastPageWidth:T,lastPageHeight:E,isLastPageDifferentFromFirstPage:S}=(0,n.useMemo)((()=>Je({count:v,parentWidth:Math.floor(d),parentHeight:Math.floor(u),maxTileCount:e,maxRowCount:i,maxColCount:t,aspectRatio:f})),[v,d,u,e,i,t,f]);return{pagesWithTiles:(0,n.useMemo)((()=>We({elements:p,tilesInFirstPage:g,onlyOnePage:"hidden"===a,isLastPageDifferentFromFirstPage:S,defaultWidth:m,defaultHeight:y,lastPageWidth:T,lastPageHeight:E})),[p,g,a,S,m,y,T,E]),ref:h}};function Qe({trackId:e,getStyle:t,ref:i}){let s=Ge();(0,n.useEffect)((()=>s.subscribe((e=>{if(!i.current)return;let n=t(e);for(let t in n)i.current.style[t]=n[t]}),(0,r.f0)(e))),[e])}},7154:function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,t.apply(this,arguments)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},5318:function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},7354:function(e,t,i){"use strict";i.d(t,{r7:function(){return f},KK:function(){return S},Jz:function(){return N},L_:function(){return L},Fc:function(){return x},v5:function(){return G}});var n=i(7294),r=i(9815),s=i(3366),o=i(7462);let a="default",l="",c=new WeakMap;function d(e){(0,r.gn)()?("default"===a&&(l=document.documentElement.style.webkitUserSelect,document.documentElement.style.webkitUserSelect="none"),a="disabled"):e&&(c.set(e,e.style.userSelect),e.style.userSelect="none")}function u(e){if((0,r.gn)()){if("disabled"!==a)return;a="restoring",setTimeout((()=>{(0,r.QB)((()=>{"restoring"===a&&("none"===document.documentElement.style.webkitUserSelect&&(document.documentElement.style.webkitUserSelect=l||""),l="",a="default")}))}),300)}else if(e&&c.has(e)){let t=c.get(e);"none"===e.style.userSelect&&(e.style.userSelect=t),""===e.getAttribute("style")&&e.removeAttribute("style"),c.delete(e)}}function h(e){return!(0!==e.mozInputSource||!e.isTrusted)||0===e.detail&&!e.pointerType}const p=n.createContext(null);function f(e){let t=function(e){let t=(0,n.useContext)(p);if(t){let{register:i}=t,n=(0,s.Z)(t,["register"]);e=(0,r.dG)(n,e),i()}return(0,r.lE)(t,e.ref),e}(e),{onPress:i,onPressChange:o,onPressStart:a,onPressEnd:l,onPressUp:c,isDisabled:f,isPressed:S,preventFocusOnPress:b,shouldCancelOnPointerExit:k,allowTextSelectionOnPress:P}=t,C=(0,s.Z)(t,["onPress","onPressChange","onPressStart","onPressEnd","onPressUp","isDisabled","isPressed","preventFocusOnPress","shouldCancelOnPointerExit","allowTextSelectionOnPress","ref"]),w=(0,n.useRef)(null);w.current={onPress:i,onPressChange:o,onPressStart:a,onPressEnd:l,onPressUp:c,isDisabled:f,shouldCancelOnPointerExit:k};let[R,I]=(0,n.useState)(!1),A=(0,n.useRef)({isPressed:!1,ignoreEmulatedMouseEvents:!1,ignoreClickAfterPress:!1,didFirePressStart:!1,activePointerId:null,target:null,isOverTarget:!1,pointerType:null}),{addGlobalListener:_,removeAllGlobalListeners:D}=(0,r.xi)(),O=(0,n.useMemo)((()=>{let e=A.current,t=(t,i)=>{let{onPressStart:n,onPressChange:r,isDisabled:s}=w.current;s||e.didFirePressStart||(n&&n({type:"pressstart",pointerType:i,target:t.currentTarget,shiftKey:t.shiftKey,metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey}),r&&r(!0),e.didFirePressStart=!0,I(!0))},i=function(t,i,n){void 0===n&&(n=!0);let{onPressEnd:r,onPressChange:s,onPress:o,isDisabled:a}=w.current;e.didFirePressStart&&(e.ignoreClickAfterPress=!0,e.didFirePressStart=!1,r&&r({type:"pressend",pointerType:i,target:t.currentTarget,shiftKey:t.shiftKey,metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey}),s&&s(!1),I(!1),o&&n&&!a&&o({type:"press",pointerType:i,target:t.currentTarget,shiftKey:t.shiftKey,metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey}))},n=(e,t)=>{let{onPressUp:i,isDisabled:n}=w.current;n||i&&i({type:"pressup",pointerType:t,target:e.currentTarget,shiftKey:e.shiftKey,metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey})},s=t=>{e.isPressed&&(e.isOverTarget&&i(y(e.target,t),e.pointerType,!1),e.isPressed=!1,e.isOverTarget=!1,e.activePointerId=null,e.pointerType=null,D(),P||u(e.target))},o={onKeyDown(i){g(i.nativeEvent)&&i.currentTarget.contains(i.target)&&(i.preventDefault(),i.stopPropagation(),e.isPressed||i.repeat||(e.target=i.currentTarget,e.isPressed=!0,t(i,"keyboard"),_(document,"keyup",a,!1)))},onKeyUp(t){g(t.nativeEvent)&&!t.repeat&&t.currentTarget.contains(t.target)&&n(y(e.target,t),"keyboard")},onClick(s){s&&!s.currentTarget.contains(s.target)||s&&0===s.button&&(s.stopPropagation(),f&&s.preventDefault(),e.ignoreClickAfterPress||e.ignoreEmulatedMouseEvents||"virtual"!==e.pointerType&&!h(s.nativeEvent)||(f||b||(0,r.Ao)(s.currentTarget),t(s,"virtual"),n(s,"virtual"),i(s,"virtual")),e.ignoreEmulatedMouseEvents=!1,e.ignoreClickAfterPress=!1)}},a=t=>{if(e.isPressed&&g(t)){t.preventDefault(),t.stopPropagation(),e.isPressed=!1;let n=t.target;i(y(e.target,t),"keyboard",e.target.contains(n)),D(),(e.target.contains(n)&&v(e.target)||"link"===e.target.getAttribute("role"))&&e.target.click()}};if("undefined"!==typeof PointerEvent){o.onPointerDown=i=>{var n;0===i.button&&i.currentTarget.contains(i.target)&&(0===(n=i.nativeEvent).width&&0===n.height||1===n.width&&1===n.height&&0===n.pressure&&0===n.detail?e.pointerType="virtual":(E(i.target)&&i.preventDefault(),e.pointerType=i.pointerType,i.stopPropagation(),e.isPressed||(e.isPressed=!0,e.isOverTarget=!0,e.activePointerId=i.pointerId,e.target=i.currentTarget,f||b||(0,r.Ao)(i.currentTarget),P||d(e.target),t(i,e.pointerType),_(document,"pointermove",a,!1),_(document,"pointerup",l,!1),_(document,"pointercancel",c,!1))))},o.onMouseDown=e=>{e.currentTarget.contains(e.target)&&0===e.button&&(E(e.target)&&e.preventDefault(),e.stopPropagation())},o.onPointerUp=t=>{t.currentTarget.contains(t.target)&&"virtual"!==e.pointerType&&0===t.button&&T(t,t.currentTarget)&&n(t,e.pointerType||t.pointerType)};let a=n=>{n.pointerId===e.activePointerId&&(T(n,e.target)?e.isOverTarget||(e.isOverTarget=!0,t(y(e.target,n),e.pointerType)):e.isOverTarget&&(e.isOverTarget=!1,i(y(e.target,n),e.pointerType,!1),w.current.shouldCancelOnPointerExit&&s(n)))},l=t=>{t.pointerId===e.activePointerId&&e.isPressed&&0===t.button&&(T(t,e.target)?i(y(e.target,t),e.pointerType):e.isOverTarget&&i(y(e.target,t),e.pointerType,!1),e.isPressed=!1,e.isOverTarget=!1,e.activePointerId=null,e.pointerType=null,D(),P||u(e.target))},c=e=>{s(e)};o.onDragStart=e=>{e.currentTarget.contains(e.target)&&s(e)}}else{o.onMouseDown=i=>{0===i.button&&i.currentTarget.contains(i.target)&&(E(i.target)&&i.preventDefault(),i.stopPropagation(),e.ignoreEmulatedMouseEvents||(e.isPressed=!0,e.isOverTarget=!0,e.target=i.currentTarget,e.pointerType=h(i.nativeEvent)?"virtual":"mouse",f||b||(0,r.Ao)(i.currentTarget),t(i,e.pointerType),_(document,"mouseup",a,!1)))},o.onMouseEnter=i=>{i.currentTarget.contains(i.target)&&(i.stopPropagation(),e.isPressed&&!e.ignoreEmulatedMouseEvents&&(e.isOverTarget=!0,t(i,e.pointerType)))},o.onMouseLeave=t=>{t.currentTarget.contains(t.target)&&(t.stopPropagation(),e.isPressed&&!e.ignoreEmulatedMouseEvents&&(e.isOverTarget=!1,i(t,e.pointerType,!1),w.current.shouldCancelOnPointerExit&&s(t)))},o.onMouseUp=t=>{t.currentTarget.contains(t.target)&&(e.ignoreEmulatedMouseEvents||0!==t.button||n(t,e.pointerType))};let a=t=>{0===t.button&&(e.isPressed=!1,D(),e.ignoreEmulatedMouseEvents?e.ignoreEmulatedMouseEvents=!1:(T(t,e.target)?i(y(e.target,t),e.pointerType):e.isOverTarget&&i(y(e.target,t),e.pointerType,!1),e.isOverTarget=!1))};o.onTouchStart=i=>{if(!i.currentTarget.contains(i.target))return;i.stopPropagation();let n=function(e){const{targetTouches:t}=e;if(t.length>0)return t[0];return null}(i.nativeEvent);n&&(e.activePointerId=n.identifier,e.ignoreEmulatedMouseEvents=!0,e.isOverTarget=!0,e.isPressed=!0,e.target=i.currentTarget,e.pointerType="touch",f||b||(0,r.Ao)(i.currentTarget),P||d(e.target),t(i,e.pointerType),_(window,"scroll",l,!0))},o.onTouchMove=n=>{if(!n.currentTarget.contains(n.target))return;if(n.stopPropagation(),!e.isPressed)return;let r=m(n.nativeEvent,e.activePointerId);r&&T(r,n.currentTarget)?e.isOverTarget||(e.isOverTarget=!0,t(n,e.pointerType)):e.isOverTarget&&(e.isOverTarget=!1,i(n,e.pointerType,!1),w.current.shouldCancelOnPointerExit&&s(n))},o.onTouchEnd=t=>{if(!t.currentTarget.contains(t.target))return;if(t.stopPropagation(),!e.isPressed)return;let r=m(t.nativeEvent,e.activePointerId);r&&T(r,t.currentTarget)?(n(t,e.pointerType),i(t,e.pointerType)):e.isOverTarget&&i(t,e.pointerType,!1),e.isPressed=!1,e.activePointerId=null,e.isOverTarget=!1,e.ignoreEmulatedMouseEvents=!0,P||u(e.target),D()},o.onTouchCancel=t=>{t.currentTarget.contains(t.target)&&(t.stopPropagation(),e.isPressed&&s(t))};let l=t=>{e.isPressed&&t.target.contains(e.target)&&s({currentTarget:e.target,shiftKey:!1,ctrlKey:!1,metaKey:!1,altKey:!1})};o.onDragStart=e=>{e.currentTarget.contains(e.target)&&s(e)}}return o}),[_,f,b,D,P]);return(0,n.useEffect)((()=>()=>{P||u(A.current.target)}),[P]),{isPressed:S||R,pressProps:(0,r.dG)(C,O)}}function v(e){return"A"===e.tagName&&e.hasAttribute("href")}function g(e){const{key:t,code:i,target:n}=e,r=n,{tagName:s,isContentEditable:o}=r,a=r.getAttribute("role");return("Enter"===t||" "===t||"Spacebar"===t||"Space"===i)&&"INPUT"!==s&&"TEXTAREA"!==s&&!0!==o&&(!v(r)||"button"===a&&"Enter"!==t)&&!("link"===a&&"Enter"!==t)}function m(e,t){const i=e.changedTouches;for(let n=0;n<i.length;n++){const e=i[n];if(e.identifier===t)return e}return null}function y(e,t){return{currentTarget:e,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,altKey:t.altKey}}function T(e,t){let i=t.getBoundingClientRect(),n=function(e){let t=e.width/2||e.radiusX||0,i=e.height/2||e.radiusY||0;return{top:e.clientY-i,right:e.clientX+t,bottom:e.clientY+i,left:e.clientX-t}}(e);return s=n,!((r=i).left>s.right||s.left>r.right)&&!(r.top>s.bottom||s.top>r.bottom);var r,s}function E(e){return!e.closest('[draggable="true"]')}p.displayName="PressResponderContext";function S(e){if(e.isDisabled)return{focusProps:{}};let t,i;return(e.onFocus||e.onFocusChange)&&(t=t=>{t.target===t.currentTarget&&(e.onFocus&&e.onFocus(t),e.onFocusChange&&e.onFocusChange(!0))}),(e.onBlur||e.onFocusChange)&&(i=t=>{t.target===t.currentTarget&&(e.onBlur&&e.onBlur(t),e.onFocusChange&&e.onFocusChange(!1))}),{focusProps:{onFocus:t,onBlur:i}}}let b=null,k=new Set,P=!1,C=!1,w=!1;function R(e,t){for(let i of k)i(e,t)}function I(e){C=!0,function(e){return!(e.metaKey||!(0,r.V5)()&&e.altKey||e.ctrlKey||"Control"===e.key||"Shift"===e.key||"Meta"===e.key)}(e)&&(b="keyboard",R("keyboard",e))}function A(e){b="pointer","mousedown"!==e.type&&"pointerdown"!==e.type||(C=!0,R("pointer",e))}function _(e){h(e)&&(C=!0,b="virtual")}function D(e){e.target!==window&&e.target!==document&&(C||w||(b="virtual",R("virtual",e)),C=!1,w=!1)}function O(){C=!1,w=!0}function M(){if("undefined"===typeof window||P)return;let e=HTMLElement.prototype.focus;HTMLElement.prototype.focus=function(){C=!0,e.apply(this,arguments)},document.addEventListener("keydown",I,!0),document.addEventListener("keyup",I,!0),document.addEventListener("click",_,!0),window.addEventListener("focus",D,!0),window.addEventListener("blur",O,!1),"undefined"!==typeof PointerEvent?(document.addEventListener("pointerdown",A,!0),document.addEventListener("pointermove",A,!0),document.addEventListener("pointerup",A,!0)):(document.addEventListener("mousedown",A,!0),document.addEventListener("mousemove",A,!0),document.addEventListener("mouseup",A,!0)),P=!0}function N(){return b}function L(e){let t=(0,n.useRef)({isFocusWithin:!1}).current;if(e.isDisabled)return{focusWithinProps:{}};return{focusWithinProps:{onFocus:i=>{t.isFocusWithin||(e.onFocusWithin&&e.onFocusWithin(i),e.onFocusWithinChange&&e.onFocusWithinChange(!0),t.isFocusWithin=!0)},onBlur:i=>{t.isFocusWithin&&!i.currentTarget.contains(i.relatedTarget)&&(e.onBlurWithin&&e.onBlurWithin(i),e.onFocusWithinChange&&e.onFocusWithinChange(!1),t.isFocusWithin=!1)}}}}"undefined"!==typeof document&&("loading"!==document.readyState?M():document.addEventListener("DOMContentLoaded",M));function x(e){let{ref:t,onInteractOutside:i,isDisabled:r,onInteractOutsideStart:s}=e,o=(0,n.useRef)({isPointerDown:!1,ignoreEmulatedMouseEvents:!1,onInteractOutside:i,onInteractOutsideStart:s}).current;o.onInteractOutside=i,o.onInteractOutsideStart=s,(0,n.useEffect)((()=>{if(r)return;let e=e=>{U(e,t)&&o.onInteractOutside&&(o.onInteractOutsideStart&&o.onInteractOutsideStart(e),o.isPointerDown=!0)};if("undefined"!==typeof PointerEvent){let i=e=>{o.isPointerDown&&o.onInteractOutside&&U(e,t)&&(o.isPointerDown=!1,o.onInteractOutside(e))};return document.addEventListener("pointerdown",e,!0),document.addEventListener("pointerup",i,!0),()=>{document.removeEventListener("pointerdown",e,!0),document.removeEventListener("pointerup",i,!0)}}{let i=e=>{o.ignoreEmulatedMouseEvents?o.ignoreEmulatedMouseEvents=!1:o.isPointerDown&&o.onInteractOutside&&U(e,t)&&(o.isPointerDown=!1,o.onInteractOutside(e))},n=e=>{o.ignoreEmulatedMouseEvents=!0,o.onInteractOutside&&o.isPointerDown&&U(e,t)&&(o.isPointerDown=!1,o.onInteractOutside(e))};return document.addEventListener("mousedown",e,!0),document.addEventListener("mouseup",i,!0),document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",n,!0),()=>{document.removeEventListener("mousedown",e,!0),document.removeEventListener("mouseup",i,!0),document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",n,!0)}}}),[t,o,r])}function U(e,t){if(e.button>0)return!1;if(e.target){const t=e.target.ownerDocument;if(!t||!t.documentElement.contains(e.target))return!1}return t.current&&!t.current.contains(e.target)}function F(e){if(!e)return;let t=!0;return i=>{let n=(0,o.Z)({},i,{preventDefault(){i.preventDefault()},isDefaultPrevented:()=>i.isDefaultPrevented(),stopPropagation(){console.error("stopPropagation is now the default behavior for events in React Spectrum. You can use continuePropagation() to revert this behavior.")},continuePropagation(){t=!1}});e(n),t&&i.stopPropagation()}}function G(e){return{keyboardProps:e.isDisabled?{}:{onKeyDown:F(e.onKeyDown),onKeyUp:F(e.onKeyUp)}}}},8880:function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}i.d(t,{Xj:function(){return b},N3:function(){return S},dd:function(){return k},Ir:function(){return u},tk:function(){return f}});var r=i(3935),s=i(3366),o=i(7354),a=i(9815),l=i(7294),c=(i(9981),i(504),i(5770),i(7265),i(2565),i(162),i(7462));"undefined"!==typeof window&&window.visualViewport;new WeakMap;"undefined"!==typeof window&&window.visualViewport;const d=[];function u(e,t){let{onClose:i,shouldCloseOnBlur:n,isOpen:r,isDismissable:s=!1,isKeyboardDismissDisabled:a=!1,shouldCloseOnInteractOutside:u}=e;(0,l.useEffect)((()=>(r&&d.push(t),()=>{let e=d.indexOf(t);e>=0&&d.splice(e,1)})),[r,t]);let h=()=>{d[d.length-1]===t&&i&&i()};(0,o.Fc)({ref:t,onInteractOutside:s?e=>{u&&!u(e.target)||(d[d.length-1]===t&&(e.stopPropagation(),e.preventDefault()),h())}:null,onInteractOutsideStart:e=>{u&&!u(e.target)||d[d.length-1]===t&&(e.stopPropagation(),e.preventDefault())}});let{focusWithinProps:p}=(0,o.L_)({isDisabled:!n,onBlurWithin:e=>{u&&!u(e.relatedTarget)||i()}});return{overlayProps:(0,c.Z)({onKeyDown:e=>{"Escape"!==e.key||a||(e.preventDefault(),h())}},p),underlayProps:{onPointerDown:e=>{e.target===e.currentTarget&&e.preventDefault()}}}}const h="undefined"!==typeof window&&window.visualViewport,p=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function f(e){void 0===e&&(e={});let{isDisabled:t}=e;(0,a.bt)((()=>{if(!t)return(0,a.gn)()?function(){let e,t=0,i=i=>{e=(0,a.rP)(i.target),e===document.documentElement&&e===document.body||(t=i.changedTouches[0].pageY)},n=i=>{if(e===document.documentElement||e===document.body)return void i.preventDefault();let n=i.changedTouches[0].pageY,r=e.scrollTop,s=e.scrollHeight-e.clientHeight;(r<=0&&n>t||r>=s&&n<t)&&i.preventDefault(),t=n},r=e=>{let t=e.target;t instanceof HTMLInputElement&&!p.has(t.type)&&(e.preventDefault(),t.style.transform="translateY(-2000px)",t.focus(),requestAnimationFrame((()=>{t.style.transform=""})))},s=e=>{let t=e.target;t instanceof HTMLInputElement&&!p.has(t.type)&&(t.style.transform="translateY(-2000px)",requestAnimationFrame((()=>{t.style.transform="",h&&(h.height<window.innerHeight?requestAnimationFrame((()=>{m(t)})):h.addEventListener("resize",(()=>m(t)),{once:!0}))})))},o=()=>{window.scrollTo(0,0)},l=window.pageXOffset,c=window.pageYOffset,d=(0,a.tS)(v(document.documentElement,"paddingRight",window.innerWidth-document.documentElement.clientWidth+"px"),v(document.documentElement,"overflow","hidden"),v(document.body,"marginTop","-"+c+"px"));window.scrollTo(0,0);let u=(0,a.tS)(g(document,"touchstart",i,{passive:!1,capture:!0}),g(document,"touchmove",n,{passive:!1,capture:!0}),g(document,"touchend",r,{passive:!1,capture:!0}),g(document,"focus",s,!0),g(window,"scroll",o));return()=>{d(),u(),window.scrollTo(l,c)}}():(0,a.tS)(v(document.documentElement,"paddingRight",window.innerWidth-document.documentElement.clientWidth+"px"),v(document.documentElement,"overflow","hidden"))}),[t])}function v(e,t,i){let n=e.style[t];return e.style[t]=i,()=>{e.style[t]=n}}function g(e,t,i,n){return e.addEventListener(t,i,n),()=>{e.removeEventListener(t,i,n)}}function m(e){let t=(0,a.rP)(e);if(t!==document.documentElement&&t!==document.body){let i=t.getBoundingClientRect().top,n=e.getBoundingClientRect().top;n>i+e.clientHeight&&(t.scrollTop+=n-i)}}const y=l.createContext(null);function T(e){let{children:t}=e,i=(0,l.useContext)(y),[n,r]=(0,l.useState)(0),s=(0,l.useMemo)((()=>({parent:i,modalCount:n,addModal(){r((e=>e+1)),i&&i.addModal()},removeModal(){r((e=>e-1)),i&&i.removeModal()}})),[i,n]);return l.createElement(y.Provider,{value:s},t)}function E(e){let{modalProviderProps:t}=function(){let e=(0,l.useContext)(y);return{modalProviderProps:{"aria-hidden":!!(e&&e.modalCount>0)||null}}}();return l.createElement("div",(0,c.Z)({"data-overlay-container":!0},e,t))}function S(e){return l.createElement(T,null,l.createElement(E,e))}function b(e){let{portalContainer:t=document.body}=e,i=(0,s.Z)(e,["portalContainer"]);l.useEffect((()=>{if(t.closest("[data-overlay-container]"))throw new Error("An OverlayContainer must not be inside another container. Please change the portalContainer prop.")}),[t]);let n=l.createElement(S,i);return r.createPortal(n,t)}function k(e){let t=(0,l.useContext)(y);if(!t)throw new Error("Modal is not contained within a provider");return(0,l.useEffect)((()=>{if((null==e||!e.isDisabled)&&t&&t.parent)return t.parent.addModal(),()=>{t&&t.parent&&t.parent.removeModal()}}),[t,t.parent,null==e?void 0:e.isDisabled]),{modalProps:{"data-ismodal":!(null!=e&&e.isDisabled)}}}var P;P=JSON.parse('{"dismiss":"\u062a\u062c\u0627\u0647\u0644"}');var C;C=JSON.parse('{"dismiss":"\u041e\u0442\u0445\u0432\u044a\u0440\u043b\u044f\u043d\u0435"}');var w;w=JSON.parse('{"dismiss":"Odstranit"}');var R;R=JSON.parse('{"dismiss":"Luk"}');var I;I=JSON.parse('{"dismiss":"Schlie\xdfen"}');var A;A=JSON.parse('{"dismiss":"\u0391\u03c0\u03cc\u03c1\u03c1\u03b9\u03c8\u03b7"}');var _;_=JSON.parse('{"dismiss":"Dismiss"}');var D;D=JSON.parse('{"dismiss":"Descartar"}');var O;O=JSON.parse('{"dismiss":"L\xf5peta"}');var M;M=JSON.parse('{"dismiss":"Hylk\xe4\xe4"}');var N;N=JSON.parse('{"dismiss":"Rejeter"}');var L;L=JSON.parse('{"dismiss":"\u05d4\u05ea\u05e2\u05dc\u05dd"}');var x;x=JSON.parse('{"dismiss":"Odbaci"}');var U;U=JSON.parse('{"dismiss":"Elutas\xedt\xe1s"}');var F;F=JSON.parse('{"dismiss":"Ignora"}');var G;G=JSON.parse('{"dismiss":"\u9589\u3058\u308b"}');var j;j=JSON.parse('{"dismiss":"\ubb34\uc2dc"}');var V;V=JSON.parse('{"dismiss":"Atmesti"}');var B;B=JSON.parse('{"dismiss":"Ner\u0101d\u012bt"}');var K;K=JSON.parse('{"dismiss":"Lukk"}');var H;H=JSON.parse('{"dismiss":"Negeren"}');var W;W=JSON.parse('{"dismiss":"Zignoruj"}');var $;$=JSON.parse('{"dismiss":"Descartar"}');var q;q=JSON.parse('{"dismiss":"Dispensar"}');var J;J=JSON.parse('{"dismiss":"Revocare"}');var z;z=JSON.parse('{"dismiss":"\u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u044c"}');var Y;Y=JSON.parse('{"dismiss":"Zru\u0161i\u0165"}');var Q;Q=JSON.parse('{"dismiss":"Opusti"}');var X;X=JSON.parse('{"dismiss":"Odbaci"}');var Z;Z=JSON.parse('{"dismiss":"Avvisa"}');var ee;ee=JSON.parse('{"dismiss":"Kapat"}');var te;te=JSON.parse('{"dismiss":"\u0421\u043a\u0430\u0441\u0443\u0432\u0430\u0442\u0438"}');var ie;ie=JSON.parse('{"dismiss":"\u53d6\u6d88"}');var ne;ne=JSON.parse('{"dismiss":"\u95dc\u9589"}');n(P).default,n(C).default,n(w).default,n(R).default,n(I).default,n(A).default,n(_).default,n(D).default,n(O).default,n(M).default,n(N).default,n(L).default,n(x).default,n(U).default,n(F).default,n(G).default,n(j).default,n(V).default,n(B).default,n(K).default,n(H).default,n(W).default,n($).default,n(q).default,n(J).default,n(z).default,n(Y).default,n(Q).default,n(X).default,n(Z).default,n(ee).default,n(te).default,n(ie).default,n(ne).default;new WeakMap},8831:function(e,t,i){"use strict";i.d(t,{HK:function(){return o},gP:function(){return l}});var n=i(7294);const r={prefix:String(Math.round(1e10*Math.random())),current:0},s=n.createContext(r);function o(e){let t=(0,n.useContext)(s),i=(0,n.useMemo)((()=>({prefix:t===r?"":t.prefix+"-"+ ++t.current,current:0})),[t]);return n.createElement(s.Provider,{value:i},e.children)}let a=Boolean("undefined"!==typeof window&&window.document&&window.document.createElement);function l(e){let t=(0,n.useContext)(s);return t!==r||a||console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server."),(0,n.useMemo)((()=>e||"react-aria"+t.prefix+"-"+ ++t.current),[e])}},9815:function(e,t,i){"use strict";function n(e){var t,i,r="";if("string"===typeof e||"number"===typeof e)r+=e;else if("object"===typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(i=n(e[t]))&&(r&&(r+=" "),r+=i);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,i=0,r="";i<arguments.length;)(e=arguments[i++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}i.d(t,{tS:function(){return p},zL:function(){return y},Ao:function(){return T},rP:function(){return R},gn:function(){return D},V5:function(){return _},dG:function(){return f},QB:function(){return P},xi:function(){return C},bt:function(){return l},mp:function(){return h},lE:function(){return w}});var s=i(7462),o=i(8831),a=i(7294);const l="undefined"!==typeof window?a.useLayoutEffect:()=>{};let c=new Map;function d(e){let t=(0,a.useRef)(!0);t.current=!0;let[i,n]=(0,a.useState)(e),r=(0,a.useRef)(null),s=(0,o.gP)(i),d=e=>{t.current?r.current=e:n(e)};return c.set(s,d),l((()=>{t.current=!1}),[d]),l((()=>{let e=s;return()=>{c.delete(e)}}),[s]),(0,a.useEffect)((()=>{let e=r.current;e&&(n(e),r.current=null)}),[n,d]),s}function u(e,t){if(e===t)return e;let i=c.get(e);if(i)return i(t),t;let n=c.get(t);return n?(n(e),e):t}function h(e){void 0===e&&(e=[]);let t=d(),[i,n]=function(e){let[t,i]=(0,a.useState)(e),n=(0,a.useRef)(t),r=(0,a.useRef)(null);n.current=t;let s=(0,a.useRef)(null);s.current=()=>{let e=r.current.next();e.done?r.current=null:t===e.value?s.current():i(e.value)},l((()=>{r.current&&s.current()}));let o=(0,a.useCallback)((e=>{r.current=e(n.current),s.current()}),[r,s]);return[t,o]}(t),r=(0,a.useCallback)((()=>{n((function*(){yield t,yield document.getElementById(t)?t:null}))}),[t,n]);return l(r,[t,r,...e]),i}function p(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(){for(let e of t)"function"===typeof e&&e(...arguments)}}function f(){let e=(0,s.Z)({},arguments.length<=0?void 0:arguments[0]);for(let t=1;t<arguments.length;t++){let i=t<0||arguments.length<=t?void 0:arguments[t];for(let t in i){let n=e[t],s=i[t];"function"===typeof n&&"function"===typeof s&&"o"===t[0]&&"n"===t[1]&&t.charCodeAt(2)>=65&&t.charCodeAt(2)<=90?e[t]=p(n,s):"className"!==t&&"UNSAFE_className"!==t||"string"!==typeof n||"string"!==typeof s?"id"===t&&n&&s?e.id=u(n,s):e[t]=void 0!==s?s:n:e[t]=r(n,s)}}return e}const v=new Set(["id"]),g=new Set(["aria-label","aria-labelledby","aria-describedby","aria-details"]),m=/^(data-.*)$/;function y(e,t){void 0===t&&(t={});let{labelable:i,propNames:n}=t,r={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(v.has(s)||i&&g.has(s)||null!=n&&n.has(s)||m.test(s))&&(r[s]=e[s]);return r}function T(e){if(function(){if(null==E){E=!1;try{document.createElement("div").focus({get preventScroll(){return E=!0,!0}})}catch(e){}}return E}())e.focus({preventScroll:!0});else{let t=function(e){var t=e.parentNode,i=[],n=document.scrollingElement||document.documentElement;for(;t instanceof HTMLElement&&t!==n;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&i.push({element:t,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),t=t.parentNode;n instanceof HTMLElement&&i.push({element:n,scrollTop:n.scrollTop,scrollLeft:n.scrollLeft});return i}(e);e.focus(),function(e){for(let{element:t,scrollTop:i,scrollLeft:n}of e)t.scrollTop=i,t.scrollLeft=n}(t)}}let E=null;let S=new Map,b=new Set;function k(){if("undefined"===typeof window)return;let e=t=>{let i=S.get(t.target);if(i&&(i.delete(t.propertyName),0===i.size&&(t.target.removeEventListener("transitioncancel",e),S.delete(t.target)),0===S.size)){for(let e of b)e();b.clear()}};document.body.addEventListener("transitionrun",(t=>{let i=S.get(t.target);i||(i=new Set,S.set(t.target,i),t.target.addEventListener("transitioncancel",e)),i.add(t.propertyName)})),document.body.addEventListener("transitionend",e)}function P(e){requestAnimationFrame((()=>{0===S.size?e():b.add(e)}))}"undefined"!==typeof document&&("loading"!==document.readyState?k():document.addEventListener("DOMContentLoaded",k));function C(){let e=(0,a.useRef)(new Map),t=(0,a.useCallback)(((t,i,n,r)=>{let s=null!=r&&r.once?function(){e.current.delete(n),n(...arguments)}:n;e.current.set(n,{type:i,eventTarget:t,fn:s,options:r}),t.addEventListener(i,n,r)}),[]),i=(0,a.useCallback)(((t,i,n,r)=>{var s;let o=(null==(s=e.current.get(n))?void 0:s.fn)||n;t.removeEventListener(i,o,r),e.current.delete(n)}),[]),n=(0,a.useCallback)((()=>{e.current.forEach(((e,t)=>{i(e.eventTarget,e.type,t,e.options)}))}),[i]);return(0,a.useEffect)((()=>n),[n]),{addGlobalListener:t,removeGlobalListener:i,removeAllGlobalListeners:n}}function w(e,t){l((()=>{if(e&&e.ref&&t)return e.ref.current=t.current,()=>{e.ref.current=null}}),[e,t])}function R(e){for(;e&&!I(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}function I(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}"undefined"!==typeof window&&window.visualViewport;new Map;function A(e){return"undefined"!==typeof window&&null!=window.navigator&&e.test(window.navigator.platform)}function _(){return A(/^Mac/)}function D(){return A(/^iPhone/)||A(/^iPad/)||_()&&navigator.maxTouchPoints>1}},9981:function(e,t){"use strict";t.__esModule=!0,t.default=function(e){return e&&e.ownerDocument||document},e.exports=t.default},1629:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=void 0;var r=n(i(139)).default?function(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):s(e,t)}:s;function s(e,t){if(t)do{if(t===e)return!0}while(t=t.parentNode);return!1}t.default=r,e.exports=t.default},7624:function(e,t){"use strict";t.__esModule=!0,t.default=function(e){return e===e.window?e:9===e.nodeType&&(e.defaultView||e.parentWindow)},e.exports=t.default},2565:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e){var t=(0,o.default)(e),i=(0,s.default)(t),n=t&&t.documentElement,a={top:0,left:0,height:0,width:0};if(!t)return;if(!(0,r.default)(n,e))return a;void 0!==e.getBoundingClientRect&&(a=e.getBoundingClientRect());return a={top:a.top+(i.pageYOffset||n.scrollTop)-(n.clientTop||0),left:a.left+(i.pageXOffset||n.scrollLeft)-(n.clientLeft||0),width:(null==a.width?e.offsetWidth:a.width)||0,height:(null==a.height?e.offsetHeight:a.height)||0}};var r=n(i(1629)),s=n(i(7624)),o=n(i(9981));e.exports=t.default},2939:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e){var t=(0,r.default)(e),i=e&&e.offsetParent;for(;i&&"html"!==o(e)&&"static"===(0,s.default)(i,"position");)i=i.offsetParent;return i||t.documentElement};var r=n(i(9981)),s=n(i(162));function o(e){return e.nodeName&&e.nodeName.toLowerCase()}e.exports=t.default},7265:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e,t){var i,n={top:0,left:0};"fixed"===(0,c.default)(e,"position")?i=e.getBoundingClientRect():(t=t||(0,o.default)(e),i=(0,s.default)(e),"html"!==function(e){return e.nodeName&&e.nodeName.toLowerCase()}(t)&&(n=(0,s.default)(t)),n.top+=parseInt((0,c.default)(t,"borderTopWidth"),10)-(0,a.default)(t)||0,n.left+=parseInt((0,c.default)(t,"borderLeftWidth"),10)-(0,l.default)(t)||0);return(0,r.default)({},i,{top:i.top-n.top-(parseInt((0,c.default)(e,"marginTop"),10)||0),left:i.left-n.left-(parseInt((0,c.default)(e,"marginLeft"),10)||0)})};var r=n(i(7154)),s=n(i(2565)),o=n(i(2939)),a=n(i(504)),l=n(i(5770)),c=n(i(162));e.exports=t.default},5770:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e,t){var i=(0,r.default)(e);if(void 0===t)return i?"pageXOffset"in i?i.pageXOffset:i.document.documentElement.scrollLeft:e.scrollLeft;i?i.scrollTo(t,"pageYOffset"in i?i.pageYOffset:i.document.documentElement.scrollTop):e.scrollLeft=t};var r=n(i(7624));e.exports=t.default},504:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e,t){var i=(0,r.default)(e);if(void 0===t)return i?"pageYOffset"in i?i.pageYOffset:i.document.documentElement.scrollTop:e.scrollTop;i?i.scrollTo("pageXOffset"in i?i.pageXOffset:i.document.documentElement.scrollLeft,t):e.scrollTop=t};var r=n(i(7624));e.exports=t.default},7023:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e){if(!e)throw new TypeError("No Element passed to `getComputedStyle()`");var t=e.ownerDocument;return"defaultView"in t?t.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):window.getComputedStyle(e,null):{getPropertyValue:function(t){var i=e.style;"float"==(t=(0,r.default)(t))&&(t="styleFloat");var n=e.currentStyle[t]||null;if(null==n&&i&&i[t]&&(n=i[t]),o.test(n)&&!s.test(t)){var a=i.left,l=e.runtimeStyle,c=l&&l.left;c&&(l.left=e.currentStyle.left),i.left="fontSize"===t?"1em":n,n=i.pixelLeft+"px",i.left=a,c&&(l.left=c)}return n}}};var r=n(i(3497)),s=/^(top|right|bottom|left)$/,o=/^([+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|))(?!px)[a-z%]+$/i;e.exports=t.default},162:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e,t,i){var n="",d="",u=t;if("string"===typeof t){if(void 0===i)return e.style[(0,r.default)(t)]||(0,o.default)(e).getPropertyValue((0,s.default)(t));(u={})[t]=i}Object.keys(u).forEach((function(t){var i=u[t];i||0===i?(0,c.default)(t)?d+=t+"("+i+") ":n+=(0,s.default)(t)+": "+i+";":(0,a.default)(e,(0,s.default)(t))})),d&&(n+=l.transform+": "+d+";");e.style.cssText+=";"+n};var r=n(i(3497)),s=n(i(4403)),o=n(i(7023)),a=n(i(1760)),l=i(702),c=n(i(3293));e.exports=t.default},1760:function(e,t){"use strict";t.__esModule=!0,t.default=function(e,t){return"removeProperty"in e.style?e.style.removeProperty(t):e.style.removeAttribute(t)},e.exports=t.default},3293:function(e,t){"use strict";t.__esModule=!0,t.default=function(e){return!(!e||!i.test(e))};var i=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;e.exports=t.default},702:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=t.animationEnd=t.animationDelay=t.animationTiming=t.animationDuration=t.animationName=t.transitionEnd=t.transitionDuration=t.transitionDelay=t.transitionTiming=t.transitionProperty=t.transform=void 0;var r,s,o,a,l,c,d,u,h,p,f,v=n(i(139)),g="transform";if(t.transform=g,t.animationEnd=o,t.transitionEnd=s,t.transitionDelay=d,t.transitionTiming=c,t.transitionDuration=l,t.transitionProperty=a,t.animationDelay=f,t.animationTiming=p,t.animationDuration=h,t.animationName=u,v.default){var m=function(){for(var e,t,i=document.createElement("div").style,n={O:function(e){return"o"+e.toLowerCase()},Moz:function(e){return e.toLowerCase()},Webkit:function(e){return"webkit"+e},ms:function(e){return"MS"+e}},r=Object.keys(n),s="",o=0;o<r.length;o++){var a=r[o];if(a+"TransitionProperty"in i){s="-"+a.toLowerCase(),e=n[a]("TransitionEnd"),t=n[a]("AnimationEnd");break}}!e&&"transitionProperty"in i&&(e="transitionend");!t&&"animationName"in i&&(t="animationend");return i=null,{animationEnd:t,transitionEnd:e,prefix:s}}();r=m.prefix,t.transitionEnd=s=m.transitionEnd,t.animationEnd=o=m.animationEnd,t.transform=g=r+"-"+g,t.transitionProperty=a=r+"-transition-property",t.transitionDuration=l=r+"-transition-duration",t.transitionDelay=d=r+"-transition-delay",t.transitionTiming=c=r+"-transition-timing-function",t.animationName=u=r+"-animation-name",t.animationDuration=h=r+"-animation-duration",t.animationTiming=p=r+"-animation-delay",t.animationDelay=f=r+"-animation-timing-function"}var y={transform:g,end:s,property:a,timing:c,delay:d,duration:l};t.default=y},1908:function(e,t){"use strict";t.__esModule=!0,t.default=function(e){return e.replace(i,(function(e,t){return t.toUpperCase()}))};var i=/-(.)/g;e.exports=t.default},3497:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e){return(0,r.default)(e.replace(s,"ms-"))};var r=n(i(1908)),s=/^-ms-/;e.exports=t.default},1185:function(e,t){"use strict";t.__esModule=!0,t.default=function(e){return e.replace(i,"-$1").toLowerCase()};var i=/([A-Z])/g;e.exports=t.default},4403:function(e,t,i){"use strict";var n=i(5318);t.__esModule=!0,t.default=function(e){return(0,r.default)(e).replace(s,"-ms-")};var r=n(i(1185)),s=/^ms-/;e.exports=t.default},139:function(e,t){"use strict";t.__esModule=!0,t.default=void 0;var i=!("undefined"===typeof window||!window.document||!window.document.createElement);t.default=i,e.exports=t.default},6387:function(e,t,i){var n,r=i(3454);!function(s){var o=Object.hasOwnProperty,a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},l="object"==typeof r&&"function"==typeof r.nextTick,c="function"===typeof Symbol,d="object"===typeof Reflect,u="function"===typeof setImmediate?setImmediate:setTimeout,h=c?d&&"function"===typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function p(){this._events={},this._conf&&f.call(this,this._conf)}function f(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==s&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function v(e,t){var i="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(i+=" Event name: "+t+"."),"undefined"!==typeof r&&r.emitWarning){var n=new Error(i);n.name="MaxListenersExceededWarning",n.emitter=this,n.count=e,r.emitWarning(n)}else console.error(i),console.trace&&console.trace()}var g=function(e,t,i){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,i];default:for(var r=new Array(n);n--;)r[n]=arguments[n];return r}};function m(e,t){for(var i={},n=e.length,r=t?value.length:0,o=0;o<n;o++)i[e[o]]=o<r?t[o]:s;return i}function y(e,t,i){var n,r;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(i.on||i.off)&&(n=i.on,r=i.off),t.addEventListener?(n=t.addEventListener,r=t.removeEventListener):t.addListener?(n=t.addListener,r=t.removeListener):t.on&&(n=t.on,r=t.off),!n&&!r)throw Error("target does not implement any known event API");if("function"!==typeof n)throw TypeError("on method must be a function");if("function"!==typeof r)throw TypeError("off method must be a function");this._on=n,this._off=r;var s=e._observers;s?s.push(this):e._observers=[this]}function T(e,t,i,n){var r=Object.assign({},t);if(!e)return r;if("object"!==typeof e)throw TypeError("options must be an object");var a,l,c,d=Object.keys(e),u=d.length;function h(e){throw Error('Invalid "'+a+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<u;p++){if(a=d[p],!n&&!o.call(t,a))throw Error('Unknown "'+a+'" option');(l=e[a])!==s&&(c=i[a],r[a]=c?c(l,h):l)}return r}function E(e,t){return"function"===typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function S(e){var t="value must be type of "+e.join("|"),i=e.length,n=e[0],r=e[1];return 1===i?function(e,i){if(typeof e===n)return e;i(t)}:2===i?function(e,i){var s=typeof e;if(s===n||s===r)return e;i(t)}:function(n,r){for(var s=typeof n,o=i;o-- >0;)if(s===e[o])return n;r(t)}}Object.assign(y.prototype,{subscribe:function(e,t,i){var n=this,r=this._target,s=this._emitter,o=this._listeners,a=function(){var n=g.apply(null,arguments),o={data:n,name:t,original:e};if(i){var a=i.call(r,o);!1!==a&&s.emit.apply(s,[o.name].concat(n))}else s.emit.apply(s,[t].concat(n))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,s._newListener&&s._removeListener&&!n._onNewListener?(this._onNewListener=function(i){i===t&&null===o[e]&&(o[e]=a,n._on.call(r,e,a))},s.on("newListener",this._onNewListener),this._onRemoveListener=function(i){i===t&&!s.hasListeners(i)&&o[e]&&(o[e]=null,n._off.call(r,e,a))},o[e]=null,s.on("removeListener",this._onRemoveListener)):(o[e]=a,n._on.call(r,e,a))},unsubscribe:function(e){var t,i,n,r=this,s=this._listeners,o=this._emitter,a=this._off,l=this._target;if(e&&"string"!==typeof e)throw TypeError("event must be a string");function c(){r._onNewListener&&(o.off("newListener",r._onNewListener),o.off("removeListener",r._onRemoveListener),r._onNewListener=null,r._onRemoveListener=null);var e=C.call(o,r);o._observers.splice(e,1)}if(e){if(!(t=s[e]))return;a.call(l,e,t),delete s[e],--this._listenersCount||c()}else{for(n=(i=h(s)).length;n-- >0;)e=i[n],a.call(l,e,s[e]);this._listeners={},this._listenersCount=0,c()}}});var b=S(["function"]),k=S(["object","function"]);function P(e,t,i){var n,r,s,o=0,a=new e((function(l,c,d){function u(){r&&(r=null),o&&(clearTimeout(o),o=0)}i=T(i,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!==typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!i.overload&&"function"===typeof e.prototype.cancel&&"function"===typeof d;var h=function(e){u(),l(e)},p=function(e){u(),c(e)};n?t(h,p,d):(r=[function(e){p(e||Error("canceled"))}],t(h,p,(function(e){if(s)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!==typeof e)throw TypeError("onCancel callback must be a function");r.push(e)})),s=!0),i.timeout>0&&(o=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,a.cancel(e),c(e)}),i.timeout))}));return n||(a.cancel=function(e){if(r){for(var t=r.length,i=1;i<t;i++)r[i](e);r[0](e),r=null}}),a}function C(e){var t=this._observers;if(!t)return-1;for(var i=t.length,n=0;n<i;n++)if(t[n]._target===e)return n;return-1}function w(e,t,i,n,r){if(!i)return null;if(0===n){var s=typeof t;if("string"===s){var o,a,l=0,c=0,d=this.delimiter,u=d.length;if(-1!==(a=t.indexOf(d))){o=new Array(5);do{o[l++]=t.slice(c,a),c=a+u}while(-1!==(a=t.indexOf(d,c)));o[l++]=t.slice(c),t=o,r=l}else t=[t],r=1}else"object"===s?r=t.length:(t=[t],r=1)}var p,f,v,g,m,y,T,E=null,S=t[n],b=t[n+1];if(n===r)i._listeners&&("function"===typeof i._listeners?(e&&e.push(i._listeners),E=[i]):(e&&e.push.apply(e,i._listeners),E=[i]));else{if("*"===S){for(a=(y=h(i)).length;a-- >0;)"_listeners"!==(p=y[a])&&(T=w(e,t,i[p],n+1,r))&&(E?E.push.apply(E,T):E=T);return E}if("**"===S){for((m=n+1===r||n+2===r&&"*"===b)&&i._listeners&&(E=w(e,t,i,r,r)),a=(y=h(i)).length;a-- >0;)"_listeners"!==(p=y[a])&&("*"===p||"**"===p?(i[p]._listeners&&!m&&(T=w(e,t,i[p],r,r))&&(E?E.push.apply(E,T):E=T),T=w(e,t,i[p],n,r)):T=w(e,t,i[p],p===b?n+2:n,r),T&&(E?E.push.apply(E,T):E=T));return E}i[S]&&(E=w(e,t,i[S],n+1,r))}if((f=i["*"])&&w(e,t,f,n+1,r),v=i["**"])if(n<r)for(v._listeners&&w(e,t,v,r,r),a=(y=h(v)).length;a-- >0;)"_listeners"!==(p=y[a])&&(p===b?w(e,t,v[p],n+2,r):p===S?w(e,t,v[p],n+1,r):((g={})[p]=v[p],w(e,t,{"**":g},n+1,r)));else v._listeners?w(e,t,v,r,r):v["*"]&&v["*"]._listeners&&w(e,t,v["*"],r,r);return E}function R(e,t,i){var n,r,s=0,o=0,a=this.delimiter,l=a.length;if("string"===typeof e)if(-1!==(n=e.indexOf(a))){r=new Array(5);do{r[s++]=e.slice(o,n),o=n+l}while(-1!==(n=e.indexOf(a,o)));r[s++]=e.slice(o)}else r=[e],s=1;else r=e,s=e.length;if(s>1)for(n=0;n+1<s;n++)if("**"===r[n]&&"**"===r[n+1])return;var c,d=this.listenerTree;for(n=0;n<s;n++)if(d=d[c=r[n]]||(d[c]={}),n===s-1)return d._listeners?("function"===typeof d._listeners&&(d._listeners=[d._listeners]),i?d._listeners.unshift(t):d._listeners.push(t),!d._listeners.warned&&this._maxListeners>0&&d._listeners.length>this._maxListeners&&(d._listeners.warned=!0,v.call(this,d._listeners.length,c))):d._listeners=t,!0;return!0}function I(e,t,i,n){for(var r,s,o,a,l=h(e),c=l.length,d=e._listeners;c-- >0;)r=e[s=l[c]],o="_listeners"===s?i:i?i.concat(s):[s],a=n||"symbol"===typeof s,d&&t.push(a?o:o.join(this.delimiter)),"object"===typeof r&&I.call(this,r,t,o,a);return t}function A(e){for(var t,i,n,r=h(e),s=r.length;s-- >0;)(t=e[i=r[s]])&&(n=!0,"_listeners"===i||A(t)||delete e[i]);return n}function _(e,t,i){this.emitter=e,this.event=t,this.listener=i}function D(e,t,i){if(!0===i)o=!0;else if(!1===i)n=!0;else{if(!i||"object"!==typeof i)throw TypeError("options should be an object or true");var n=i.async,o=i.promisify,a=i.nextTick,c=i.objectify}if(n||a||o){var d=t,h=t._origin||t;if(a&&!l)throw Error("process.nextTick is not supported");o===s&&(o="AsyncFunction"===t.constructor.name),(t=function(){var e=arguments,t=this,i=this.event;return o?a?Promise.resolve():new Promise((function(e){u(e)})).then((function(){return t.event=i,d.apply(t,e)})):(a?r.nextTick:u)((function(){t.event=i,d.apply(t,e)}))})._async=!0,t._origin=h}return[t,c?new _(this,e,t):this]}function O(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,f.call(this,e)}_.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},O.EventEmitter2=O,O.prototype.listenTo=function(e,t,i){if("object"!==typeof e)throw TypeError("target musts be an object");var n=this;function r(t){if("object"!==typeof t)throw TypeError("events must be an object");var r,s=i.reducers,o=C.call(n,e);r=-1===o?new y(n,e,i):n._observers[o];for(var a,l=h(t),c=l.length,d="function"===typeof s,u=0;u<c;u++)a=l[u],r.subscribe(a,t[a]||a,d?s:s&&s[a])}return i=T(i,{on:s,off:s,reducers:s},{on:b,off:b,reducers:k}),a(t)?r(m(t)):r("string"===typeof t?m(t.split(/\s+/)):t),this},O.prototype.stopListeningTo=function(e,t){var i=this._observers;if(!i)return!1;var n,r=i.length,s=!1;if(e&&"object"!==typeof e)throw TypeError("target should be an object");for(;r-- >0;)n=i[r],e&&n._target!==e||(n.unsubscribe(t),s=!0);return s},O.prototype.delimiter=".",O.prototype.setMaxListeners=function(e){e!==s&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},O.prototype.getMaxListeners=function(){return this._maxListeners},O.prototype.event="",O.prototype.once=function(e,t,i){return this._once(e,t,!1,i)},O.prototype.prependOnceListener=function(e,t,i){return this._once(e,t,!0,i)},O.prototype._once=function(e,t,i,n){return this._many(e,1,t,i,n)},O.prototype.many=function(e,t,i,n){return this._many(e,t,i,!1,n)},O.prototype.prependMany=function(e,t,i,n){return this._many(e,t,i,!0,n)},O.prototype._many=function(e,t,i,n,r){var s=this;if("function"!==typeof i)throw new Error("many only accepts instances of Function");function o(){return 0===--t&&s.off(e,o),i.apply(this,arguments)}return o._origin=i,this._on(e,o,n,r)},O.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var e,t,i,n,r,s,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"===typeof o)){if(i=o.length,c)for(n=0;n<i;n++)if("symbol"===typeof o[n]){s=!0;break}s||(o=o.join(this.delimiter))}var l,d=arguments.length;if(this._all&&this._all.length)for(n=0,i=(l=this._all.slice()).length;n<i;n++)switch(this.event=o,d){case 1:l[n].call(this,o);break;case 2:l[n].call(this,o,arguments[1]);break;case 3:l[n].call(this,o,arguments[1],arguments[2]);break;default:l[n].apply(this,arguments)}if(a)l=[],w.call(this,l,e,this.listenerTree,0,i);else{if("function"===typeof(l=this._events[o])){switch(this.event=o,d){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(d-1),r=1;r<d;r++)t[r-1]=arguments[r];l.apply(this,t)}return!0}l&&(l=l.slice())}if(l&&l.length){if(d>3)for(t=new Array(d-1),r=1;r<d;r++)t[r-1]=arguments[r];for(n=0,i=l.length;n<i;n++)switch(this.event=o,d){case 1:l[n].call(this);break;case 2:l[n].call(this,arguments[1]);break;case 3:l[n].call(this,arguments[1],arguments[2]);break;default:l[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===o)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},O.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||p.call(this);var e,t,i,n,r,s,o=arguments[0],a=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"===typeof o)){if(n=o.length,c)for(r=0;r<n;r++)if("symbol"===typeof o[r]){t=!0;break}t||(o=o.join(this.delimiter))}var l,d=[],u=arguments.length;if(this._all)for(r=0,n=this._all.length;r<n;r++)switch(this.event=o,u){case 1:d.push(this._all[r].call(this,o));break;case 2:d.push(this._all[r].call(this,o,arguments[1]));break;case 3:d.push(this._all[r].call(this,o,arguments[1],arguments[2]));break;default:d.push(this._all[r].apply(this,arguments))}if(a?(l=[],w.call(this,l,e,this.listenerTree,0)):l=this._events[o],"function"===typeof l)switch(this.event=o,u){case 1:d.push(l.call(this));break;case 2:d.push(l.call(this,arguments[1]));break;case 3:d.push(l.call(this,arguments[1],arguments[2]));break;default:for(i=new Array(u-1),s=1;s<u;s++)i[s-1]=arguments[s];d.push(l.apply(this,i))}else if(l&&l.length){if(l=l.slice(),u>3)for(i=new Array(u-1),s=1;s<u;s++)i[s-1]=arguments[s];for(r=0,n=l.length;r<n;r++)switch(this.event=o,u){case 1:d.push(l[r].call(this));break;case 2:d.push(l[r].call(this,arguments[1]));break;case 3:d.push(l[r].call(this,arguments[1],arguments[2]));break;default:d.push(l[r].apply(this,i))}}else if(!this.ignoreErrors&&!this._all&&"error"===o)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(d)},O.prototype.on=function(e,t,i){return this._on(e,t,!1,i)},O.prototype.prependListener=function(e,t,i){return this._on(e,t,!0,i)},O.prototype.onAny=function(e){return this._onAny(e,!1)},O.prototype.prependAny=function(e){return this._onAny(e,!0)},O.prototype.addListener=O.prototype.on,O.prototype._onAny=function(e,t){if("function"!==typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},O.prototype._on=function(e,t,i,n){if("function"===typeof e)return this._onAny(e,t),this;if("function"!==typeof t)throw new Error("on only accepts instances of Function");this._events||p.call(this);var r,o=this;return n!==s&&(t=(r=D.call(this,e,t,n))[0],o=r[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(R.call(this,e,t,i),o):(this._events[e]?("function"===typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,v.call(this,this._events[e].length,e))):this._events[e]=t,o)},O.prototype.off=function(e,t){if("function"!==typeof t)throw new Error("removeListener only takes instances of Function");var i,n=[];if(this.wildcard){var r="string"===typeof e?e.split(this.delimiter):e.slice();if(!(n=w.call(this,null,r,this.listenerTree,0)))return this}else{if(!this._events[e])return this;i=this._events[e],n.push({_listeners:i})}for(var s=0;s<n.length;s++){var o=n[s];if(i=o._listeners,a(i)){for(var l=-1,c=0,d=i.length;c<d;c++)if(i[c]===t||i[c].listener&&i[c].listener===t||i[c]._origin&&i[c]._origin===t){l=c;break}if(l<0)continue;return this.wildcard?o._listeners.splice(l,1):this._events[e].splice(l,1),0===i.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&A(this.listenerTree),this},O.prototype.offAny=function(e){var t,i=0,n=0;if(e&&this._all&&this._all.length>0){for(i=0,n=(t=this._all).length;i<n;i++)if(e===t[i])return t.splice(i,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(i=0,n=t.length;i<n;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},O.prototype.removeListener=O.prototype.off,O.prototype.removeAllListeners=function(e){if(e===s)return!this._events||p.call(this),this;if(this.wildcard){var t,i=w.call(this,null,e,this.listenerTree,0);if(!i)return this;for(t=0;t<i.length;t++)i[t]._listeners=null;this.listenerTree&&A(this.listenerTree)}else this._events&&(this._events[e]=null);return this},O.prototype.listeners=function(e){var t,i,n,r,o,a=this._events;if(e===s){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!a)return[];for(r=(t=h(a)).length,n=[];r-- >0;)"function"===typeof(i=a[t[r]])?n.push(i):n.push.apply(n,i);return n}if(this.wildcard){if(!(o=this.listenerTree))return[];var l=[],c="string"===typeof e?e.split(this.delimiter):e.slice();return w.call(this,l,c,o,0),l}return a&&(i=a[e])?"function"===typeof i?[i]:i:[]},O.prototype.eventNames=function(e){var t=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,e):t?h(t):[]},O.prototype.listenerCount=function(e){return this.listeners(e).length},O.prototype.hasListeners=function(e){if(this.wildcard){var t=[],i="string"===typeof e?e.split(this.delimiter):e.slice();return w.call(this,t,i,this.listenerTree,0),t.length>0}var n=this._events,r=this._all;return!!(r&&r.length||n&&(e===s?h(n).length:n[e]))},O.prototype.listenersAny=function(){return this._all?this._all:[]},O.prototype.waitFor=function(e,t){var i=this,n=typeof t;return"number"===n?t={timeout:t}:"function"===n&&(t={filter:t}),P((t=T(t,{timeout:0,filter:s,handleError:!1,Promise:Promise,overload:!1},{filter:b,Promise:E})).Promise,(function(n,r,s){function o(){var s=t.filter;if(!s||s.apply(i,arguments))if(i.off(e,o),t.handleError){var a=arguments[0];a?r(a):n(g.apply(null,arguments).slice(1))}else n(g.apply(null,arguments))}s((function(){i.off(e,o)})),i._on(e,o,!1)}),{timeout:t.timeout,overload:t.overload})};var M=O.prototype;Object.defineProperties(O,{defaultMaxListeners:{get:function(){return M._maxListeners},set:function(e){if("number"!==typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");M._maxListeners=e},enumerable:!0},once:{value:function(e,t,i){return P((i=T(i,{Promise:Promise,timeout:0,overload:!1},{Promise:E})).Promise,(function(i,n,r){var s;if("function"===typeof e.addEventListener)return s=function(){i(g.apply(null,arguments))},r((function(){e.removeEventListener(t,s)})),void e.addEventListener(t,s,{once:!0});var o,a=function(){o&&e.removeListener("error",o),i(g.apply(null,arguments))};"error"!==t&&(o=function(i){e.removeListener(t,a),n(i)},e.once("error",o)),r((function(){o&&e.removeListener("error",o),e.removeListener(t,a)})),e.once(t,a)}),{timeout:i.timeout,overload:i.overload})},writable:!0,configurable:!0}}),Object.defineProperties(M,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(n=function(){return O}.call(t,i,t,e))===s||(e.exports=n)}()},3454:function(e,t,i){"use strict";var n,r;e.exports=(null===(n=i.g.process)||void 0===n?void 0:n.env)&&"object"===typeof(null===(r=i.g.process)||void 0===r?void 0:r.env)?i.g.process:i(7663)},6363:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return i(6882)}])},6882:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return g}});var n=i(5893),r=i(8831),s=i(8880),o=(i(7284),i(4157),i(5531),i(4865)),a=i.n(o),l=i(1163),c=i(7294);function d(){var e=(0,l.useRouter)();return(0,c.useEffect)((function(){var t,i=function(){t=setTimeout((function(){return a().start()}),100)},n=function(){clearTimeout(t),a().done()};return e.events.on("routeChangeStart",i),e.events.on("routeChangeComplete",n),e.events.on("routeChangeError",n),function(){e.events.off("routeChangeStart",i),e.events.off("routeChangeComplete",n),e.events.off("routeChangeError",n)}}),[e.events]),(0,n.jsx)(n.Fragment,{})}function u(){document.documentElement.style.setProperty("--100vh","".concat(window.innerHeight,"px"))}function h(){return(0,c.useEffect)((function(){return window.addEventListener("resize",u),u(),function(){window.removeEventListener("resize",u)}}),[]),(0,n.jsx)(n.Fragment,{})}var p=i(1704);function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},n=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),n.forEach((function(t){f(e,t,i[t])}))}return e}function g(e){var t=e.Component,i=e.pageProps;return(0,c.useEffect)((function(){var e;null===(e=document.body.classList)||void 0===e||e.remove("loading")}),[]),(0,n.jsx)(r.HK,{children:(0,n.jsx)(s.N3,{children:(0,n.jsxs)(p.dx,{children:[(0,n.jsx)(t,v({},i)),(0,n.jsx)(h,{}),(0,n.jsx)(d,{})]})})})}},5531:function(){},7284:function(){},4157:function(){},7663:function(e){!function(){var t={162:function(e){var t,i,n=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:r}catch(e){t=r}try{i="function"===typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var a,l=[],c=!1,d=-1;function u(){c&&a&&(c=!1,a.length?l=a.concat(l):d=-1,l.length&&h())}function h(){if(!c){var e=o(u);c=!0;for(var t=l.length;t;){for(a=l,l=[];++d<t;)a&&a[d].run();d=-1,t=l.length}a=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new p(e,t)),1!==l.length||c||o(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}},i={};function n(e){var r=i[e];if(void 0!==r)return r.exports;var s=i[e]={exports:{}},o=!0;try{t[e](s,s.exports,n),o=!1}finally{o&&delete i[e]}return s.exports}n.ab="//";var r=n(162);e.exports=r}()},1163:function(e,t,i){e.exports=i(387)},4865:function(e,t,i){var n,r;void 0===(r="function"===typeof(n=function(){var e={version:"0.2.0"},t=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function i(e,t,i){return e<t?t:e>i?i:e}function n(e){return 100*(-1+e)}function r(e,i,r){var s;return(s="translate3d"===t.positionUsing?{transform:"translate3d("+n(e)+"%,0,0)"}:"translate"===t.positionUsing?{transform:"translate("+n(e)+"%,0)"}:{"margin-left":n(e)+"%"}).transition="all "+i+"ms "+r,s}e.configure=function(e){var i,n;for(i in e)void 0!==(n=e[i])&&e.hasOwnProperty(i)&&(t[i]=n);return this},e.status=null,e.set=function(n){var a=e.isStarted();n=i(n,t.minimum,1),e.status=1===n?null:n;var l=e.render(!a),c=l.querySelector(t.barSelector),d=t.speed,u=t.easing;return l.offsetWidth,s((function(i){""===t.positionUsing&&(t.positionUsing=e.getPositioningCSS()),o(c,r(n,d,u)),1===n?(o(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){o(l,{transition:"all "+d+"ms linear",opacity:0}),setTimeout((function(){e.remove(),i()}),d)}),d)):setTimeout(i,d)})),this},e.isStarted=function(){return"number"===typeof e.status},e.start=function(){e.status||e.set(0);var i=function(){setTimeout((function(){e.status&&(e.trickle(),i())}),t.trickleSpeed)};return t.trickle&&i(),this},e.done=function(t){return t||e.status?e.inc(.3+.5*Math.random()).set(1):this},e.inc=function(t){var n=e.status;return n?("number"!==typeof t&&(t=(1-n)*i(Math.random()*n,.1,.95)),n=i(n+t,0,.994),e.set(n)):e.start()},e.trickle=function(){return e.inc(Math.random()*t.trickleRate)},function(){var t=0,i=0;e.promise=function(n){return n&&"resolved"!==n.state()?(0===i&&e.start(),t++,i++,n.always((function(){0===--i?(t=0,e.done()):e.set((t-i)/t)})),this):this}}(),e.render=function(i){if(e.isRendered())return document.getElementById("nprogress");l(document.documentElement,"nprogress-busy");var r=document.createElement("div");r.id="nprogress",r.innerHTML=t.template;var s,a=r.querySelector(t.barSelector),c=i?"-100":n(e.status||0),d=document.querySelector(t.parent);return o(a,{transition:"all 0 linear",transform:"translate3d("+c+"%,0,0)"}),t.showSpinner||(s=r.querySelector(t.spinnerSelector))&&u(s),d!=document.body&&l(d,"nprogress-custom-parent"),d.appendChild(r),r},e.remove=function(){c(document.documentElement,"nprogress-busy"),c(document.querySelector(t.parent),"nprogress-custom-parent");var e=document.getElementById("nprogress");e&&u(e)},e.isRendered=function(){return!!document.getElementById("nprogress")},e.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"};var s=function(){var e=[];function t(){var i=e.shift();i&&i(t)}return function(i){e.push(i),1==e.length&&t()}}(),o=function(){var e=["Webkit","O","Moz","ms"],t={};function i(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()}))}function n(t){var i=document.body.style;if(t in i)return t;for(var n,r=e.length,s=t.charAt(0).toUpperCase()+t.slice(1);r--;)if((n=e[r]+s)in i)return n;return t}function r(e){return e=i(e),t[e]||(t[e]=n(e))}function s(e,t,i){t=r(t),e.style[t]=i}return function(e,t){var i,n,r=arguments;if(2==r.length)for(i in t)void 0!==(n=t[i])&&t.hasOwnProperty(i)&&s(e,i,n);else s(e,r[1],r[2])}}();function a(e,t){return("string"==typeof e?e:d(e)).indexOf(" "+t+" ")>=0}function l(e,t){var i=d(e),n=i+t;a(i,t)||(e.className=n.substring(1))}function c(e,t){var i,n=d(e);a(e,t)&&(i=n.replace(" "+t+" "," "),e.className=i.substring(1,i.length-1))}function d(e){return(" "+(e.className||"")+" ").replace(/\s+/gi," ")}function u(e){e&&e.parentNode&&e.parentNode.removeChild(e)}return e})?n.call(t,i,t,e):n)||(e.exports=r)},6692:function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},766:function(e,t,i){var n=i(962),r=i(5776);t.cW=r,t.Qc=n.parse,n.parseParams,n.parseFmtpConfig,n.parsePayloads,n.parseRemoteCandidates,n.parseImageAttributes,n.parseSimulcastStreamList},962:function(e,t,i){var n=function(e){return String(Number(e))===e?Number(e):e},r=function(e,t,i){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var s=e.push?{}:r?t[e.name]:t;!function(e,t,i,r){if(r&&!i)t[r]=n(e[1]);else for(var s=0;s<i.length;s+=1)null!=e[s+1]&&(t[i[s]]=n(e[s+1]))}(i.match(e.reg),s,e.names,e.name),e.push&&t[e.push].push(s)},s=i(6692),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},i=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(o).forEach((function(e){var t=e[0],o=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),n=i[i.length-1]);for(var a=0;a<(s[t]||[]).length;a+=1){var l=s[t][a];if(l.reg.test(o))return r(l,n,o)}})),t.media=i,t};var a=function(e,t){var i=t.split(/=(.+)/,2);return 2===i.length?e[i[0]]=n(i[1]):1===i.length&&t.length>1&&(e[i[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],i=e.split(" ").map(n),r=0;r<i.length;r+=3)t.push({component:i[r],ip:i[r+1],port:i[r+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,i=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),i=!0),{scid:t,paused:i}}))}))}},5776:function(e,t,i){var n=i(6692),r=/%[sdv%]/g,s=function(e){var t=1,i=arguments,n=i.length;return e.replace(r,(function(e){if(t>=n)return e;var r=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},o=function(e,t,i){var n=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var r=0;r<t.names.length;r+=1){var o=t.names[r];t.name?n.push(i[t.name][o]):n.push(i[t.names[r]])}else n.push(i[t.name]);return s.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var i=t.outerOrder||a,r=t.innerOrder||l,s=[];return i.forEach((function(t){n[t].forEach((function(i){i.name in e&&null!=e[i.name]?s.push(o(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach((function(e){s.push(o(t,i,e))}))}))})),e.media.forEach((function(e){s.push(o("m",n.m[0],e)),r.forEach((function(t){n[t].forEach((function(i){i.name in e&&null!=e[i.name]?s.push(o(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach((function(e){s.push(o(t,i,e))}))}))}))})),s.join("\r\n")+"\r\n"}},7539:function(e){"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter((e=>0===e.indexOf(i)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const i={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1];break;case"ufrag":i.ufrag=t[n+1],i.usernameFragment=t[n+1];break;default:void 0===i[t[n]]&&(i[t[n]]=t[n+1])}return i},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let i;const n=e.substr(e.indexOf(" ")+1).split(";");for(let r=0;r<n.length;r++)i=n[r].trim().split("="),t[i[0].trim()]=i[1];return t},t.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const n=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");for(let r=3;r<n.length;r++){const s=n[r],o=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){const n=t.parseRtpMap(o),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(n.parameters=r.length?t.parseFmtp(r[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),i.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(n.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{i.headerExtensions.push(t.parseExtmap(e))})),i},t.writeRtpDescription=function(e,i){let n="";n+="m="+e+" ",n+=i.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=i.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach((e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));let r=0;return i.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(n+="a=maxptime:"+r+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach((e=>{n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){const i=[],n=t.parseRtpParameters(e),r=-1!==n.fecMechanisms.indexOf("RED"),s=-1!==n.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let l;const c=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));c.length>0&&c[0].length>1&&c[0][0]===a&&(l=c[0][1]),n.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(t.rtx={ssrc:l}),i.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},i.push(t))}})),0===i.length&&a&&i.push({ssrc:a});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,i.forEach((e=>{e.maxBitrate=d}))),i},t.parseRtcpParameters=function(e){const i={},n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return i.mux=s.length>0,i},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let i;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return i=n[0].substr(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(i=r[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let r;n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,i,n){let r;const s=void 0!==i?i:2;r=e||t.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,i){const n=t.splitLines(e);for(let t=0;t<n.length;t++)switch(n[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[t].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const i=t.splitLines(e)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const i=t.splitLines(e);for(let t=0;t<i.length;t++)if(i[t].length<2||"="!==i[t].charAt(1))return!1;return!0},e.exports=t},2238:function(e,t,i){var n;!function(r,s){"use strict";var o="function",a="undefined",l="object",c="string",d="model",u="name",h="type",p="vendor",f="version",v="architecture",g="console",m="mobile",y="tablet",T="smarttv",E="wearable",S="embedded",b="Amazon",k="Apple",P="ASUS",C="BlackBerry",w="Firefox",R="Google",I="Huawei",A="LG",_="Microsoft",D="Motorola",O="Opera",M="Samsung",N="Sony",L="Xiaomi",x="Zebra",U="Facebook",F=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},G=function(e,t){return typeof e===c&&-1!==j(t).indexOf(j(e))},j=function(e){return e.toLowerCase()},V=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===a?e:e.substring(0,255)},B=function(e,t){for(var i,n,r,a,c,d,u=0;u<t.length&&!c;){var h=t[u],p=t[u+1];for(i=n=0;i<h.length&&!c;)if(c=h[i++].exec(e))for(r=0;r<p.length;r++)d=c[++n],typeof(a=p[r])===l&&a.length>0?2===a.length?typeof a[1]==o?this[a[0]]=a[1].call(this,d):this[a[0]]=a[1]:3===a.length?typeof a[1]!==o||a[1].exec&&a[1].test?this[a[0]]=d?d.replace(a[1],a[2]):s:this[a[0]]=d?a[1].call(this,d,a[2]):s:4===a.length&&(this[a[0]]=d?a[3].call(this,d.replace(a[1],a[2])):s):this[a]=d||s;u+=2}},K=function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(G(t[i][n],e))return"?"===i?s:i}else if(G(t[i],e))return"?"===i?s:i;return e},H={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},W={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,f],[/opios[\/ ]+([\w\.]+)/i],[f,[u,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[f,[u,O]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[u,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[f,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[f,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure Browser"],f],[/\bfocus\/([\w\.]+)/i],[f,[u,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[f,[u,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[u,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[u,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[f,[u,w]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 Browser"],f],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,U],f],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,"Chrome WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[u,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,f],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[f,[u,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[f,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[f,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[u,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,j]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,"",j]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,j]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[p,M],[h,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[p,M],[h,m]],[/\((ip(?:hone|od)[\w ]*);/i],[d,[p,k],[h,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[p,k],[h,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[p,I],[h,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[d,[p,I],[h,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[p,L],[h,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[p,L],[h,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[p,"OPPO"],[h,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[p,"Vivo"],[h,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[p,"Realme"],[h,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[p,D],[h,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[p,D],[h,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[p,A],[h,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[p,A],[h,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[p,"Lenovo"],[h,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[p,"Nokia"],[h,m]],[/(pixel c)\b/i],[d,[p,R],[h,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[p,R],[h,m]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[p,N],[h,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[p,N],[h,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[p,"OnePlus"],[h,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[p,b],[h,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[p,b],[h,m]],[/(playbook);[-\w\),; ]+(rim)/i],[d,p,[h,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[p,C],[h,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[p,P],[h,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[p,P],[h,m]],[/(nexus 9)/i],[d,[p,"HTC"],[h,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[p,[d,/_/g," "],[h,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[p,"Acer"],[h,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[p,"Meizu"],[h,m]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[p,"Sharp"],[h,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[p,d,[h,m]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,d,[h,y]],[/(surface duo)/i],[d,[p,_],[h,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[p,"Fairphone"],[h,m]],[/(u304aa)/i],[d,[p,"AT&T"],[h,m]],[/\bsie-(\w*)/i],[d,[p,"Siemens"],[h,m]],[/\b(rct\w+) b/i],[d,[p,"RCA"],[h,y]],[/\b(venue[\d ]{2,7}) b/i],[d,[p,"Dell"],[h,y]],[/\b(q(?:mv|ta)\w+) b/i],[d,[p,"Verizon"],[h,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[p,"Barnes & Noble"],[h,y]],[/\b(tm\d{3}\w+) b/i],[d,[p,"NuVision"],[h,y]],[/\b(k88) b/i],[d,[p,"ZTE"],[h,y]],[/\b(nx\d{3}j) b/i],[d,[p,"ZTE"],[h,m]],[/\b(gen\d{3}) b.+49h/i],[d,[p,"Swiss"],[h,m]],[/\b(zur\d{3}) b/i],[d,[p,"Swiss"],[h,y]],[/\b((zeki)?tb.*\b) b/i],[d,[p,"Zeki"],[h,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],d,[h,y]],[/\b(ns-?\w{0,9}) b/i],[d,[p,"Insignia"],[h,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[p,"NextBook"],[h,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],d,[h,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],d,[h,m]],[/\b(ph-1) /i],[d,[p,"Essential"],[h,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[p,"Envizen"],[h,y]],[/\b(trio[-\w\. ]+) b/i],[d,[p,"MachSpeed"],[h,y]],[/\btu_(1491) b/i],[d,[p,"Rotor"],[h,y]],[/(shield[\w ]+) b/i],[d,[p,"Nvidia"],[h,y]],[/(sprint) (\w+)/i],[p,d,[h,m]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[p,_],[h,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[p,x],[h,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[p,x],[h,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,d,[h,g]],[/droid.+; (shield) bui/i],[d,[p,"Nvidia"],[h,g]],[/(playstation [345portablevi]+)/i],[d,[p,N],[h,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[p,_],[h,g]],[/smart-tv.+(samsung)/i],[p,[h,T]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[p,M],[h,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,A],[h,T]],[/(apple) ?tv/i],[p,[d,"Apple TV"],[h,T]],[/crkey/i],[[d,"Chromecast"],[p,R],[h,T]],[/droid.+aft(\w)( bui|\))/i],[d,[p,b],[h,T]],[/\(dtv[\);].+(aquos)/i],[d,[p,"Sharp"],[h,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[p,V],[d,V],[h,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,T]],[/((pebble))app/i],[p,d,[h,E]],[/droid.+; (glass) \d/i],[d,[p,R],[h,E]],[/droid.+; (wt63?0{2,3})\)/i],[d,[p,x],[h,E]],[/(quest( 2)?)/i],[d,[p,U],[h,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[h,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[h,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[h,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,y]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[h,m]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[f,K,H]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[f,K,H]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[f,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,f],[/\(bb(10);/i],[f,[u,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[u,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[u,"webOS"]],[/crkey\/([\d\.]+)/i],[f,[u,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[u,"Chromium OS"],f],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,f],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,f]]},$=function(e,t){if(typeof e===l&&(t=e,e=s),!(this instanceof $))return new $(e,t).getResult();var i=e||(typeof r!==a&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:""),n=t?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2===0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(W,t):W;return this.getBrowser=function(){var e,t={};return t.name=s,t.version=s,B.call(t,i,n.browser),t.major=typeof(e=t.version)===c?e.replace(/[^\d\.]/g,"").split(".")[0]:s,t},this.getCPU=function(){var e={};return e.architecture=s,B.call(e,i,n.cpu),e},this.getDevice=function(){var e={};return e.vendor=s,e.model=s,e.type=s,B.call(e,i,n.device),e},this.getEngine=function(){var e={};return e.name=s,e.version=s,B.call(e,i,n.engine),e},this.getOS=function(){var e={};return e.name=s,e.version=s,B.call(e,i,n.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===c&&e.length>255?V(e,255):e,this},this.setUA(i),this};$.VERSION="1.0.2",$.BROWSER=F([u,f,"major"]),$.CPU=F([v]),$.DEVICE=F([d,p,h,g,m,T,y,E,S]),$.ENGINE=$.OS=F([u,f]),typeof t!==a?(e.exports&&(t=e.exports=$),t.UAParser=$):i.amdO?(n=function(){return $}.call(t,i,t,e))===s||(e.exports=n):typeof r!==a&&(r.UAParser=$);var q=typeof r!==a&&(r.jQuery||r.Zepto);if(q&&!q.ua){var J=new $;q.ua=J.getResult(),q.ua.get=function(){return J.getUA()},q.ua.set=function(e){J.setUA(e);var t=J.getResult();for(var i in t)q.ua[i]=t[i]}}}("object"===typeof window?window:this)},7462:function(e,t,i){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}i.d(t,{Z:function(){return n}})},3366:function(e,t,i){"use strict";function n(e,t){if(null==e)return{};var i,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}i.d(t,{Z:function(){return n}})}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],(function(){return t(6363),t(387)}));var i=e.O();_N_E=i}]);